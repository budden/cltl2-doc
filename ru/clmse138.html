<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Проверка завершения</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-03-12 14:38:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse139.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse137.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse137.html#tailclmse137.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse138.html">В-конец</a>&#x003E;&#x003C;<a 
href="clmch26.html#clmse138.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">26.14
</span> <a 
href="clm.html#QQ2-169-288" id="x169-24700026.14">Проверка завершения</a></h3>
<!--l. 1375--><p class="noindent" >The loop keywords <b><a 
href="symbols.html#x200-396097r97">always</a></b>, <b><a 
href="symbols.html#x200-396668r668">never</a></b>, <b><a 
href="symbols.html#x200-396959r959">thereis</a></b>, <b><a 
href="symbols.html#x200-396984r984">until</a></b>, and <b><a 
href="symbols.html#x200-397010r1010">while</a></b> designate
constructs that use a single test condition to determine when loop iteration should
terminate.
<!--l. 1379--><p class="indent" >   Ключевые символы <b><a 
href="symbols.html#x200-396097r97">always</a></b>, <b><a 
href="symbols.html#x200-396668r668">never</a></b>, <b><a 
href="symbols.html#x200-396959r959">thereis</a></b>, <b><a 
href="symbols.html#x200-396984r984">until</a></b> и <b><a 
href="symbols.html#x200-397010r1010">while</a></b> обозначают
конструкции, которые с помощью условия проверяют должен ли быть
завершён цикл.
<!--l. 1383--><p class="indent" >   The constructs <b><a 
href="symbols.html#x200-396097r97">always</a></b>, <b><a 
href="symbols.html#x200-396668r668">never</a></b>, and <b><a 
href="symbols.html#x200-396959r959">thereis</a></b> provide speciﬁc values to be
returned when a loop terminates. Using <b><a 
href="symbols.html#x200-396097r97">always</a></b>, <b><a 
href="symbols.html#x200-396668r668">never</a></b>, or <b><a 
href="symbols.html#x200-396959r959">thereis</a></b> with
value-returning accumulation clauses can produce unpredictable results.
In all other respects these constructs behave like the <b><a 
href="symbols.html#x200-397010r1010">while</a></b> and <b><a 
href="symbols.html#x200-396984r984">until</a></b>
constructs.
<!--l. 1390--><p class="indent" >   The macro <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> can be used at any time to cause normal termination.
In normal termination, <b><a 
href="symbols.html#x200-396412r412">ﬁnally</a></b> clauses are executed and default return values are
returned.
<!--l. 1394--><p class="indent" >   End-test control constructs can be used anywhere within the loop
body. The termination conditions are tested in the order in which they
appear.
<div class="defloop">
<div class="defmacheader">
<!--l. 1399--><p class="indent" >   <div class="tabbing">
 <em>[Выражение цикла]</em> <b>while</b> <a 
 id="dx169-247001"></a>expr
   <br>
<!--l. 1399--><p class="noindent" ></div>
</div>
<div class="defmacheader">
<!--l. 1399--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <em>[Выражение цикла]</em> <b>until</b> <a 
 id="dx169-247002"></a>expr
   <br>
<!--l. 1401--><p class="noindent" ></div>
</div>
<!--l. 1402--><p class="indent" >   The <b><a 
href="symbols.html#x200-397010r1010">while</a></b> construct allows iteration to continue until the speciﬁed expression
<em>expr</em> evaluates to <b><a 
href="symbols.html#x200-396670r670">nil</a></b>. The expression is re-evaluated at the location of the <b><a 
href="symbols.html#x200-397010r1010">while</a></b>
clause.
<!--l. 1406--><p class="indent" >   The <b><a 
href="symbols.html#x200-396984r984">until</a></b> construct is equivalent to <b><a 
href="symbols.html#x200-397010r1010">while</a></b> (<b><a 
href="symbols.html#x200-396676r676">not</a></b> <em>expr</em>). If the value of the
speciﬁed expression is non-<b><a 
href="symbols.html#x200-396670r670">nil</a></b>, iteration terminates.
<!--l. 1410--><p class="indent" >   You can use <b><a 
href="symbols.html#x200-397010r1010">while</a></b> and <b><a 
href="symbols.html#x200-396984r984">until</a></b> at any point in a loop. If a <b><a 
href="symbols.html#x200-397010r1010">while</a></b> or <b><a 
href="symbols.html#x200-396984r984">until</a></b>
clause causes termination, any clauses that precede it in the source are still
evaluated.
<!--l. 1415--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; A classic &#x0022;while-loop&#x0022;.
   <br>                                                     (loop while (hungry-p) do (eat))<br>
<br>                                  ;;; UNTIL NOT is equivalent to WHILE.<br>
(loop until (not (hungry-p)) do (eat))<br>                                     <br>
;;; Collect the length and the items of STACK.<br>   (let ((stack &#x2019;(a b c d e f)))<br>
  (loop while stack<br>            for item = (length stack) then (pop stack)<br>
        collect item))<br>                              <span class="math"> ⇒</span> (6 A B C D E F)<br>
<br>                ;;; Use WHILE to terminate a loop that otherwise wouldn&#x2019;t<br>
;;; terminate. Note that WHILE occurs after the WHEN.<br>
(loop for i ﬁxnum from 3<br>      when (oddp i) collect i<br>      while (&#x003C; i 5))<br>
   <span class="math"> ⇒</span> (3 5)<br>
<!--l. 1436--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defloop">
<div class="defmacheader">
<!--l. 1441--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <em>[Выражение цикла]</em> <b>always</b> <a 
 id="dx169-247003"></a>expr
   <br>
<!--l. 1441--><p class="noindent" ></div>
</div>
<div class="defmacheader">
<!--l. 1441--><p class="indent" >   <div class="tabbing">
 <em>[Выражение цикла]</em> <b>never</b> <a 
 id="dx169-247004"></a>expr
   <br>
<!--l. 1442--><p class="noindent" ></div>
</div>
<div class="defmacheader">
<!--l. 1442--><p class="indent" >   <div class="tabbing">
 <em>[Выражение цикла]</em> <b>thereis</b> <a 
 id="dx169-247005"></a>expr
   <br>
<!--l. 1444--><p class="noindent" ></div>
</div>
<!--l. 1445--><p class="indent" >   The <b><a 
href="symbols.html#x200-396097r97">always</a></b> construct takes one form and terminates the loop if the form ever
evaluates to <b><a 
href="symbols.html#x200-396670r670">nil</a></b>; in this case, it returns <b><a 
href="symbols.html#x200-396670r670">nil</a></b>. Otherwise, it provides a default return
value of <b><a 
href="symbols.html#x200-396951r951">t</a></b>.
<!--l. 1449--><p class="indent" >   The <b><a 
href="symbols.html#x200-396668r668">never</a></b> construct takes one form and terminates the loop if the form ever
evaluates to non-<b><a 
href="symbols.html#x200-396670r670">nil</a></b>; in this case, it returns <b><a 
href="symbols.html#x200-396670r670">nil</a></b>. Otherwise, it provides a default
return value of <b><a 
href="symbols.html#x200-396951r951">t</a></b>.
<!--l. 1453--><p class="indent" >   The <b><a 
href="symbols.html#x200-396959r959">thereis</a></b> construct takes one form and terminates the loop if the form ever
evaluates to non-<b><a 
href="symbols.html#x200-396670r670">nil</a></b>; in this case, it returns that value.
<!--l. 1457--><p class="indent" >   If the <b><a 
href="symbols.html#x200-397010r1010">while</a></b> or <b><a 
href="symbols.html#x200-396984r984">until</a></b> construct causes termination, control is passed to the
loop epilogue, where any <b><a 
href="symbols.html#x200-396412r412">ﬁnally</a></b> clauses will be executed. Since <b><a 
href="symbols.html#x200-396097r97">always</a></b>, <b><a 
href="symbols.html#x200-396668r668">never</a></b>,
and <b><a 
href="symbols.html#x200-396959r959">thereis</a></b> use the Common Lisp macro <b><a 
href="symbols.html#x200-396816r816">return</a></b> to terminate iteration, any
<b><a 
href="symbols.html#x200-396412r412">ﬁnally</a></b> clause that is speciﬁed is not evaluated.
<!--l. 1464--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; Make sure I is always less than 11 (two ways).
   <br>                                   ;;; The FOR construct terminates these loops.<br>
                                                                          

                                                                          
<!--l. 1468--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1469--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                      always (&#x003C; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1473--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1474--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                        never (&#x003E; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1478--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1479--><p class="indent" >   <div class="tabbing">
;;; If I exceeds 10, return I; otherwise, return NIL.
   <br>                               ;;; The THEREIS construct terminates this loop.<br>
<!--l. 1482--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<div class="lisp">
<tt>
<!--l. 1483--><p class="indent" >   <div class="tabbing">
(loop for i from 0
   <br>                                                         thereis (when (&#x003E; i 10) i) )<br>
   <span class="math"> ⇒</span> 11<br>
<!--l. 1487--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1488--><p class="indent" >   <div class="tabbing">
;;; The FINALLY clause is not evaluated in these examples.
   <br>
<!--l. 1490--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1491--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>           always (&#x003C; i 9)<br>           ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1496--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
                                                                          

                                                                          
<tt>
<!--l. 1497--><p class="indent" >   <div class="tabbing">
(loop never t
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1501--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1502--><p class="indent" >   <div class="tabbing">
(loop thereis &#x0022;Here is my value&#x0022;
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> &#x0022;Here is my value&#x0022;<br>
<!--l. 1506--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1507--><p class="indent" >   <div class="tabbing">
;;; The FOR construct terminates this loop,
   <br>                                           ;;; so the FINALLY clause is evaluated.<br>
<!--l. 1510--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1511--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop for i from 1 to 10
   <br>                                                                       thereis (&#x003E; i 11)<br>
      ﬁnally (print i))                                       ;Prints 1 line<br>
11<br>                                                                <span class="math"> ⇒</span> NIL<br>
<!--l. 1517--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1519--><p class="indent" >   <div class="tabbing">
(defstruct mountain height diﬃculty (why &#x0022;because it is there&#x0022;))
   <br>                   (setq everest (make-mountain :height &#x2019;(2.86e-13 parsecs)))<br>
(setq chocorua (make-mountain :height &#x2019;(1059180001 microns)))<br>
(defstruct desert area (humidity 0))<br>(setq sahara (make-desert :area &#x2019;(212480000 square furlongs)))<br>
       ;First there is a mountain, then there is no mountain, then there is <span class="math">…</span><br>
(loop for x in (list everest sahara chocorua)                        ; —GLS<br>
      thereis (and (mountain-p x) (mountain-height x)))<br>
   <span class="math"> ⇒</span> (2.86E-13 PARSECS)<br>                                             <br>
;;; If you could use this code to ﬁnd a counterexample to<br>
;;; Fermat&#x2019;s last theorem, it would still not return the value<br>
;;; of the counterexample because all of the THEREIS clauses<br>
;;; in this example return only T.   Of course, this code has<br>
;;; never been observed to terminate.<br>                                      <br>
(loop for z upfrom 2<br>                                               thereis<br>
        (loop for n upfrom 3 below (log z 2)<br>                    thereis<br>
                (loop for x below z<br>                          thereis<br>
                        (loop for y below z<br>
                              thereis (= (+ (expt x n)<br>
                                            (expt y n))<br>
                                         (expt z n))))))<br>
<!--l. 1546--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 1550--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>loop-ﬁnish</b> <a 
 id="dx169-247006"></a><b></b>
   <br>
<!--l. 1551--><p class="noindent" ></div>
</div>
<!--l. 1552--><p class="indent" >   The macro <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> terminates iteration normally and returns any
accumulated result. If speciﬁed, a <b><a 
href="symbols.html#x200-396412r412">ﬁnally</a></b> clause is evaluated.
<!--l. 1556--><p class="indent" >   In most cases it is not necessary to use <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> because other loop control
clauses terminate the loop. Use <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> to provide a normal exit from a
nested condition inside a loop.
<!--l. 1561--><p class="indent" >   You can use <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> inside nested Lisp code to provide a normal exit from
a loop. Since <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b> transfers control to the loop epilogue, using <b><a 
href="symbols.html#x200-396578r578">loop-ﬁnish</a></b>
within a <b><a 
href="symbols.html#x200-396412r412">ﬁnally</a></b> expression can cause inﬁnite looping.
<!--l. 1567--><p class="indent" >   Implementations are allowed to provide this construct as a local macro by
using <b><a 
href="symbols.html#x200-396587r587">macrolet</a></b>.
<!--l. 1570--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; Print a date in February, but exclude leap day.
   <br>
;;; LOOP-FINISH exits from the nested condition.<br>(loop for date in date-list<br>
      do (case date<br>                     (29 (when (eq month &#x2019;february)<br>
                     (loop-ﬁnish))<br>
             (format t &#x0022;~:@(~A~) ~A&#x0022; month date))))<br>
<br>                  ;;; Terminate the loop, but return the accumulated count.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>
      when (symbolp i) do (loop-ﬁnish)<br>           count i)<br>        <span class="math"> ⇒</span> 3<br>
<br>                   ;;; This loop works just as well as the previous example.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>      until (symbolp i)<br>      count i)<br>
   <span class="math"> ⇒</span> 3<br>
                                                                          

                                                                          
<!--l. 1591--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
                                                                          

                                                                          
<!--l. 1594--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse139.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse137.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse137.html#tailclmse137.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse138.html" >В-начало</a>&#x003E;&#x003C;<a 
href="clmch26.html#clmse138.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse138.html"></a>
 
</body></html> 
