<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Программный интерфейс системы условий</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-01-10 13:49:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse149.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse147.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse147.html#tailclmse147.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse148.html">В-конец</a>&#x003E;&#x003C;<a 
href="condition.html#clmse148.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">28.4
</span> <a 
href="clm.html#QQ2-181-369" id="x181-32500028.4">Программный интерфейс системы условий</a></h3>
<!--l. 3894--><p class="noindent" >Данный раздел описывает функции, макросы, переменные и типы условий
для Системы Условий Common Lisp&#x2019;а.
<!--l. 3897--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.1   </span> <a 
href="frontmatter.html#QQ2-181-370" id="x181-32600028.4.1">Сигнализирование условий</a></h4>
<!--l. 3900--><p class="noindent" >Функции из этого раздела предоставляют различные механизмы для
сигнализирования предупреждений, остановок, исправимых и неисправимых
ошибок.
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-326001"></a>
<em>
<!--l. 3904--><p class="noindent" >[Функция]</em> <b>error</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 3906--><p class="indent" >   Функция сигнализирует условие. Если условие не было обработано,
вызывается <b>(invoke-debugger <em>condition</em>)</b>. В следствие данного вызова
<b><a 
href="symbols.html#x188-380383r383">error</a></b> никогда напрямую не возвращает управление вызвавшему её.
Выход из данной функции осуществляется с помощью нелокальной
передачи управления в обработчике или командой в интерактивном
отладчике.
<!--l. 3912--><p class="indent" >   Если <em>datum</em> является условием, тогда это условие и используется. В этом
случае непустой список аргументов <em>arguments</em> является ошибкой,
то есть <b><a 
href="symbols.html#x188-380383r383">error</a></b> должна быть вызвана только с одним аргументом —
условием.
<!--l. 3916--><p class="indent" >   Если <em>datum</em> является типом условия (классом или именем класса),
используется экземпляр созданный с помощью <b>(apply #&#x2019;make-condition
<em>datum</em> <em>arguments</em>)</b>.
                                                                          

                                                                          
<!--l. 3920--><p class="indent" >   Если <em>datum</em> является строкой, тогда условие создаётся с помощью
команды <div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 3925--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-326002"></a>
<em>
<!--l. 3929--><p class="noindent" >[Функция]</em> <b>cerror</b> <i>continue-format-string</i> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 3931--><p class="indent" >   Функция <b><a 
href="symbols.html#x188-380213r213">cerror</a></b> сигнализирует условие. Если условие не было
обработано, вызывается <b>(invoke-debugger <em>condition</em>)</b>. Во время работы
механизма сигнализирования и, одновременно, работы отладчика (если он
был запущен) существует возможность продолжения выполнения
программы (то есть локального возврата из <b><a 
href="symbols.html#x188-380213r213">cerror</a></b> с помощью перезапуска
<b><a 
href="symbols.html#x188-380288r288">continue</a></b>.
<!--l. 3937--><p class="indent" >   Если аргумент <em>datum</em> является условием, тогда оно и используется. В
этом случае, список аргументов <em>arguments</em> не обязан быть пустым, и
используется только для строки <em>continue-format-string</em>.
<!--l. 3941--><p class="indent" >   Если <em>datum</em> является типом условия (классом или именем класса), тогда
объект условия будет создаваться с помощью <b>(apply #&#x2019;make-condition
<em>datum</em> <em>arguments</em>)</b>.
<!--l. 3945--><p class="indent" >   Если <em>datum</em> является строкой, тогда создание объекта условия происходит
так: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 3950--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3952--><p class="indent" >   Аргумент <em>continue-format-string</em> должен быть строкой. Необходимо
отметить, что если <em>datum</em> не является строкой, тогда остальные аргументы
используются для строки форматирования <em>continue-format-string</em> как обычно
(если <em>datum</em> задаёт тип условия, остальные аргументы должны выглядеть
как пары: ключевой символ, значение). В этом случае для корректной
установки параметров в <em>continue-format-string</em> может быть использована
директива форматирования <b>~*</b>, которая игнорирует и пропускает
аргументы.
<!--l. 3960--><p class="indent" >   Функция <b><a 
href="symbols.html#x188-380213r213">cerror</a></b> возвращает значение <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-326003"></a>
<em>
<!--l. 3964--><p class="noindent" >[Функция]</em> <b>signal</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 3966--><p class="indent" >   Запускает механизм сигнализирования условия. Если условие не было
обработано, <b><a 
href="symbols.html#x188-380854r854">signal</a></b> возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 3969--><p class="indent" >   Если <em>datum</em> является условием, тогда это условие и используется. В этом
случае аргументов <em>arguments</em> быть не должно, то есть <b><a 
href="symbols.html#x188-380854r854">signal</a></b> должна быть
вызвана только с одним аргументом, условием.
<!--l. 3973--><p class="indent" >   Если <em>datum</em> является типом условия (классом или именем класса), тогда
объект условия создаётся с помощью <b>(apply #&#x2019;make-condition <em>datum</em>
<em>arguments</em>)</b>.
<!--l. 3977--><p class="indent" >   Если <em>datum</em> является строкой, тогда объект условия создаётся так:
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
                                                                          

                                                                          
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 3982--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3984--><p class="indent" >   Необходимо отметить, что если <b>(typep <em>condition</em> *break-on-signals*)</b>
является истиной, тогда отладчик вступит в действие раньше процесса
сигнализирования. Для продолжения процесса сигнализирования может быть
использована функция перезапуска <b><a 
href="symbols.html#x188-380288r288">continue</a></b>. Перезапуск связан с
сигнализируемым условием, как если с помощью <b><a 
href="symbols.html#x188-381015r1015">with-condition-restarts</a></b>. Это
верно также для всех других функций и макросов, которые сигнализируют
условия: <b><a 
href="symbols.html#x188-381007r1007">warn</a></b>, <b><a 
href="symbols.html#x188-380383r383">error</a></b>, <b><a 
href="symbols.html#x188-380213r213">cerror</a></b>, <b><a 
href="symbols.html#x188-380127r127">assert</a></b> и <b><a 
href="symbols.html#x188-380236r236">check-type</a></b>.
<!--l. 3993--><p class="indent" >   В время динамической продолжительности вызова <b><a 
href="symbols.html#x188-380854r854">signal</a></b> с некоторым
условием, результат вызова <b><a 
href="symbols.html#x188-380854r854">signal</a></b> вновь с тем же объектом условия не
предсказуем. Например, не смотря на то, что обработчик <em>может</em>
ресигнализировать условие для передачи его внешним обработчикам, два
различных асинхронных события от клавиатуры не могут сигнализировать
одинаковые (<b><a 
href="symbols.html#x188-380378r378">eq</a></b>) объекты условия в одинаковое время.
<!--l. 4000--><p class="indent" >   Для подробного описания смотрите раздел <a 
href="clmse147.html#x180-32300028.3.17">28.3.17<!--tex4ht:ref: CONDITION-HANDLERS --></a>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-326004"></a>
<em>
<!--l. 4005--><p class="noindent" >[Переменная]</em> <b>*break-on-signals*</b>
</div>
<!--l. 4007--><p class="indent" >   Данная переменная используется, когда пользователь отлаживает
программы, которые сигнализируют ошибки. Значением <b>*break-on-signals*</b>
должно быть подходящее значение для второго аргумента в <b><a 
href="symbols.html#x188-380976r976">typep</a></b>, то есть
тип или спецификатор типа.
<!--l. 4011--><p class="indent" >   Когда выражение <b>(typep <em>condition</em> *break-on-signals*)</b> истинно, тогда
вызовы функции <b><a 
href="symbols.html#x188-380854r854">signal</a></b> (или других функций-обёрток над данной) будут
неявно вызывать отладчик перед сигнализированием <em>условия</em>. Для
продолжения процесса сигнализирования может быть использована функция
перезапуска <b><a 
href="symbols.html#x188-380288r288">continue</a></b>. Перезапуск связан с сигнализируемым условием, как
если с помощью <b><a 
href="symbols.html#x188-381015r1015">with-condition-restarts</a></b>.
                                                                          

                                                                          
<!--l. 4018--><p class="indent" >   Следует отметить, что <b><a 
href="symbols.html#x188-380670r670">nil</a></b> является корректным спецификатором типа.
Если значение <b><a 
href="symbols.html#x188-380015r15">*break-on-signals*</a></b> равно <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, тогда <b><a 
href="symbols.html#x188-380854r854">signal</a></b> никогда не
вызовет отладчик в этой неявной форме.
<!--l. 4022--><p class="indent" >   При установке этой переменной, пользователь может выбрать наиболее
специфичный тип для перехвата. Установка этого флага нарушает
модульность обработки сигналов, В некоторых случаях это приводит к
непредсказуемым последствиям, так как пользователь может не знать
количество и места вызовов <b><a 
href="symbols.html#x188-380854r854">signal</a></b>.
<!--l. 4027--><p class="indent" >   По-умолчанию—и, конечно, в любом «промышленном» использовании—значением
этой переменной должно быть <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, как по соображениям производительности,
так и модульности и абстрагированности.
<hr></div>
<!--l. 4033--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.2   </span> <a 
href="frontmatter.html#QQ2-181-371" id="x181-32700028.4.2">Проверка ошибок</a></h4>
<!--l. 4036--><p class="noindent" >Данные функции используются для удобной проверки ошибок в коде.
<div class="defmac">
<div class="defmacheader">
<!--l. 4039--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>check-type</b> <a 
 id="dx181-327001"></a>place typespec [string]
   <br>
<!--l. 4040--><p class="noindent" ></div>
</div>
<!--l. 4041--><p class="indent" >   Форма <b><a 
href="symbols.html#x188-380236r236">check-type</a></b> сигнализирует ошибку типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>, если
содержимое <em>place</em> не принадлежит указанному типу.
<!--l. 4044--><p class="indent" >   Если условие было сигнализировано, обработчики данного условия могут
использовать функции <b><a 
href="symbols.html#x188-380972r972">type-error-datum</a></b> и <b><a 
href="symbols.html#x188-380973r973">type-error-expected-type</a></b> для
доступа к содержимому <em>place</em> и <em>typespec</em>, соответственно.
<!--l. 4048--><p class="indent" >   Данная функция возвращает управление, только если был вызван
перезапуск <b><a 
href="symbols.html#x188-380902r902">store-value</a></b> или явно из обработчика, или неявно как одна из
команд отладчика. Перезапуск связан с сигнализируемым условием, как если
бы с помощью функции <b><a 
href="symbols.html#x188-381015r1015">with-condition-restarts</a></b>.
<!--l. 4053--><p class="indent" >   Если вызывается <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>, <b><a 
href="symbols.html#x188-380236r236">check-type</a></b> сохраняет новое значение из
аргумента <b><a 
href="symbols.html#x188-380902r902">store-value</a></b> (или из пользовательского ввода в отладчике) в место
                                                                          

                                                                          
<em>place</em> и заново проверяет тип нового значения и сигнализирует другую
ошибку, если тип всё ещё не удовлетворяет условию. Подформы <em>place</em> могут
вычисляться много раз, потому что происходит неявный цикл вызовов.
<b><a 
href="symbols.html#x188-380236r236">check-type</a></b> возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<em>
<!--l. 4060--><p class="indent" >   place</em> должен быть обобщённой переменной, которая может использоваться в
<b><a 
href="symbols.html#x188-380844r844">setf</a></b>. <em>typespec</em> должен быть спецификатором типа, данный аргумент не
вычисляется. <b><a 
href="symbols.html#x188-380908r908">string</a></b> должен быть описанием типа на английском,
начинающемся с артикля («a» или «an»), данный аргумент вычисляется.
Если аргумент <em>string</em> не был указан, то он вычисляется автоматически
исходя из спецификатора <em>typespec</em>. Аргумент <em>string</em> предусмотрен для
тех программ, которые хотят вывести некоторую дополнительную
информацию.
<!--l. 4068--><p class="indent" >   Сообщение об ошибке будет ссылаться на <em>place</em>, его содержимое и
указанный тип.
__________________________________________________________<div class="implementation">
<!--l. 4071--><p class="noindent" ><b>Заметка для реализации:</b> An implementation may choose to generate
a somewhat diﬀerently worded error message if it recognizes that <em>place</em> is of
a particular form, such as one of the arguments to the function that called
<b><a 
href="symbols.html#x188-380236r236">check-type</a></b>.
</div>___________________________________________________________________________________________________________
<div class="lisp">
<tt>
<!--l. 4078--><p class="indent" >     <div class="tabbing">
Lisp&#x003E; (setq aardvarks &#x2019;(sam harry fred))
     <br>  <span class="math"> ⇒</span> (SAM HARRY FRED)<br> Lisp&#x003E; (check-type aardvarks (array * (3)))<br>
Error: The value of AARDVARKS, (SAM HARRY FRED),<br>
       is not a 3-long array.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>                   2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 1<br>           Use Value: #(sam fred harry)<br>            <span class="math"> ⇒</span> NIL<br>
Lisp&#x003E; aardvarks<br>                                           <span class="math"> ⇒</span> #&#x003C;ARRAY-3 13571&#x003E;<br>
Lisp&#x003E; (map &#x2019;list #&#x2019;identity aardvarks)<br>            <span class="math"> ⇒</span> (SAM FRED HARRY)<br>
Lisp&#x003E; (setq aacount &#x2019;foo)<br>                                                     <span class="math"> ⇒</span> FOO<br>
Lisp&#x003E; (check-type aacount (integer 0 *) &#x0022;a non-negative integer&#x0022;)<br>
                                                                          

                                                                          
Error: The value of AACOUNT, FOO, is not a non-negative integer.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>              2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 2<br>                                                 Lisp&#x003E;<br>
<!--l. 4103--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4107--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>assert</b> <a 
 id="dx181-327002"></a>test-form [({place}*) [datum {argument}*]]
   <br>
<!--l. 4108--><p class="noindent" ></div>
</div>
<!--l. 4109--><p class="indent" >   Форма <b><a 
href="symbols.html#x188-380127r127">assert</a></b> сигнализирует ошибку, если значение формы <em>test-form</em>
равно <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. Исправление данной ошибки с помощью перезапуска <b><a 
href="symbols.html#x188-380288r288">continue</a></b>
позволяет пользователю изменить значения некоторых переменных, и <b><a 
href="symbols.html#x188-380127r127">assert</a></b>
будет вновь перепроверять <em>test-form</em>. Перезапуск связан с сигнализируемым
условием, как если бы с помощью функции <b><a 
href="symbols.html#x188-381015r1015">with-condition-restarts</a></b>. <b><a 
href="symbols.html#x188-380127r127">assert</a></b>
возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 4116--><p class="indent" >   Форма <em>test-form</em> может быть любой. Каждый <em>place</em> (может быть любой
количество, в том числе ноль) должен быть обобщённой переменной, которая
может использоваться в <b><a 
href="symbols.html#x188-380844r844">setf</a></b>. Эти переменные должны использоваться в
форме <em>test-form</em>, чтобы пользователь мог попытаться изменить их во время
исправления ошибки. Подформы каждого аргумента <em>place</em> вычисляются,
только если сигнализирует ошибка. Они также перевычисляются, если
ошибка была сгенерирована вновь (после коррекции, которая не привела к
положительному результату).
<!--l. 4125--><p class="indent" >   Аргументы <em>datum</em> и <em>argument</em> вычисляются, только если сигнализируется
ошибка, и перевычисляются, если ошибка сигнализируется вновь.
<!--l. 4128--><p class="indent" >   Если аргумент <em>datum</em> является условием, то это условие и используется. В
этом случае указание других аргументов <em>argument</em> является ошибкой.
<!--l. 4131--><p class="indent" >   Если <em>datum</em> является типом условия (классом или именем класса), тогда
                                                                          

                                                                          
условие создаётся с помощью формы <b>(apply #&#x2019;make-condition <em>datum</em> (list
{<i>argument</i>}* ))</b>.
<!--l. 4135--><p class="indent" >   Если <em>datum</em> является строкой, тогда условие создаётся так: <div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments (list  {<i>argument</i>}* ))<br>
<!--l. 4140--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4142--><p class="indent" >   Если <em>datum</em> не указан, тогда создаётся условие типа <b><a 
href="symbols.html#x188-380860r860">simple-error</a></b> с
указанием <em>test-form</em> в качестве данных. Например: <div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                         :format-string &#x0022;The assertion ~S failed.&#x0022;<br>
  :format-arguments &#x2019;(<em>test-form</em>))<br>
<!--l. 4148--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4149--><p class="indent" >   Следует отметить, что <em>test-form</em> для строки ошибки используется сама по
себе, а не её значение.
____________________________________________________<div class="implementation">
<!--l. 4153--><p class="noindent" ><b>Заметка для реализации:</b> The debugger need not include the <em>test-form</em> in the error
message, and any <em>places</em> should not be included in the message, but they should be
made available for the user&#x2019;s perusal. If the user gives the “continue” command, an
opportunity should be presented to alter the values of any or all of the references.
The details of this depend on the implementation&#x2019;s style of user interface, of
course.
</div>___________________________________________________________________________________________________________
<!--l. 4163--><p class="indent" >     Простой пример использования <b><a 
href="symbols.html#x188-380127r127">assert</a></b>: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(setq x (make-array &#x2019;(3 5) :initial-element 3))
   <br>                  (setq y (make-array &#x2019;(3 5) :initial-element 7))<br>                  <br>
(defun matrix-multiply (a b)<br>                      (let ((*print-array* nil))<br>
    (assert (and (= (array-rank a) (array-rank b) 2)<br>
                 (= (array-dimension a 1)<br>                    (array-dimension b 0)))<br>
            (a b)<br>                    &#x0022;Cannot multiply ~S by ~S.&#x0022; a b)<br>
    (really-matrix-multiply a b)))<br>          <br>             (matrix-multiply x y)<br>
Error: Cannot multiply #&#x003C;ARRAY-3-5 12345&#x003E; by #&#x003C;ARRAY-3-5 12364&#x003E;.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify new values.<br>   2: Return to Lisp Toplevel.<br>  Debug&#x003E; :continue 1<br>
Value for A: x<br>            Value for B: (make-array &#x2019;(5 3) :initial-element 6)<br>
 <span class="math"> ⇒</span>#2A((54 54 54 54 54)<br>                                 (54 54 54 54 54)<br>
          (54 54 54 54 54)<br>                                 (54 54 54 54 54)<br>
          (54 54 54 54 54))<br>
<!--l. 4190--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<!--l. 4193--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.3   </span> <a 
href="frontmatter.html#QQ2-181-372" id="x181-32800028.4.3">Проверка значение на соответствие</a></h4>
<!--l. 4196--><p class="noindent" >Синтаксис для <b><a 
href="symbols.html#x188-380384r384">etypecase</a></b> и <b><a 
href="symbols.html#x188-380303r303">ctypecase</a></b> такой же как и для <b><a 
href="symbols.html#x188-380975r975">typecase</a></b>, за
исключением отсутствия выражения <b>otherwise</b>. Аналогично, синтаксис для
<b><a 
href="symbols.html#x188-380361r361">ecase</a></b> и <b><a 
href="symbols.html#x188-380194r194">ccase</a></b> такой же как и для <b><a 
href="symbols.html#x188-380194r194">ccase</a></b>, за исключением выражения
<b>otherwise</b>.
<b>
<!--l. 4201--><p class="indent" >   <a 
href="symbols.html#x188-380384r384">etypecase</a></b> и <b><a 
href="symbols.html#x188-380361r361">ecase</a></b> похожи на <b><a 
href="symbols.html#x188-380975r975">typecase</a></b> и <b><a 
href="symbols.html#x188-380192r192">case</a></b>, соответственно, однако,
при отсутствии подходящего выражения, сигнализируют невосстановимую
ошибку вместо того, чтобы вернуть <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<b>
<!--l. 4205--><p class="indent" >   <a 
href="symbols.html#x188-380303r303">ctypecase</a></b> и <b><a 
href="symbols.html#x188-380194r194">ccase</a></b> также похожи на <b><a 
href="symbols.html#x188-380975r975">typecase</a></b> и <b><a 
href="symbols.html#x188-380192r192">case</a></b>, соответственно, и
при отсутствии подходящего выражения, сигнализируют восстановимую
ошибку вместо того, чтобы вернуть <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
                                                                          

                                                                          
<div class="defmac">
<div class="defmacheader">
<!--l. 4210--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>etypecase</b> <a 
 id="dx181-328001"></a>keyform {(type {form}*)}*
   <br>
<!--l. 4211--><p class="noindent" ></div>
</div>
<!--l. 4212--><p class="indent" >   Данная управляющая конструкция похожа на <b><a 
href="symbols.html#x188-380975r975">typecase</a></b>, но без явных
<b>otherwise</b> или <b><a 
href="symbols.html#x188-380951r951">t</a></b> выражений. Если ни одно выражение не подошло под
условие, <b><a 
href="symbols.html#x188-380361r361">ecase</a></b> сигнализирует ошибку (типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>) со строкой, которая
будет создана на основе этих выражений. Исправить данную ошибку
невозможно. Для указания сообщения, пользователь должен использовать
<b><a 
href="symbols.html#x188-380975r975">typecase</a></b> с выражением <b>otherwise</b>, содержащим вызов <b><a 
href="symbols.html#x188-380383r383">error</a></b>. Имя данной
функции образовано от «exhaustive type case» или «error-checking type
case».
<!--l. 4221--><p class="indent" >   Например: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                              <span class="math"> ⇒</span> 1/3<br>                             Lisp&#x003E; (etypecase x<br>
        (integer (* x 4))<br>                     (symbol (symbol-value x)))<br>
Error: The value of X, 1/3, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Return to Lisp Toplevel.<br>                                       Debug&#x003E;<br>
<!--l. 4232--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4236--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <em>[Макрос]</em> <b>ctypecase</b> <a 
 id="dx181-328002"></a>keyplace {(type {form}*)}*
   <br>
<!--l. 4237--><p class="noindent" ></div>
</div>
<!--l. 4238--><p class="indent" >   Данная управляющая конструкция похожа на <b><a 
href="symbols.html#x188-380975r975">typecase</a></b>, но без явных
<b>otherwise</b> или <b><a 
href="symbols.html#x188-380951r951">t</a></b> выражений.
<!--l. 4241--><p class="indent" >   Аргумент <em>keyplace</em> должен быть обобщённой переменной, которая может
использоваться в <b><a 
href="symbols.html#x188-380844r844">setf</a></b>. Если ни одно выражение не соответствовало
типу <em>keyplace</em>, <b><a 
href="symbols.html#x188-380303r303">ctypecase</a></b> сигнализирует ошибку (типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>) с
сообщением, которое генерируется с использованием выражение. Данная
ошибка может быть исправлена с помощью перезапуска <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>.
Аргумент для <b><a 
href="symbols.html#x188-380902r902">store-value</a></b> сохраняется в <em>keyplace</em> и затем <b><a 
href="symbols.html#x188-380303r303">ctypecase</a></b>
вновь проверяет тип выражения. Таким образом подформы <em>keyplace</em>
могут быть выполнены несколько раз. Если перезапуск <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>
был запущен интерактивно, у пользователя будет запрошено новое
значение.
<!--l. 4251--><p class="indent" >   Имя данной функции расшифровывается «continuable (exhaustive) type
case».
<!--l. 4254--><p class="indent" >   Например: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                              <span class="math"> ⇒</span> 1/3<br>                             Lisp&#x003E; (ctypecase x<br>
        (integer (* x 4))<br>                     (symbol (symbol-value x)))<br>
Error: The value of X, 1/3, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>
 2: Return to Lisp Toplevel.<br>                           Debug&#x003E; :continue 1<br>
Use value: 3.7<br>Error: The value of X, 3.7, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>              2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 1<br>                                          Use value: 12<br>
 <span class="math"> ⇒</span> 48<br>
<!--l. 4274--><p class="noindent" ></div>
</tt>
</div>
<hr>
                                                                          

                                                                          
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4279--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ecase</b> <a 
 id="dx181-328003"></a>keyform {({({key}*) | key} {form}*)}*
   <br>
<!--l. 4280--><p class="noindent" ></div>
</div>
<!--l. 4281--><p class="indent" >   Данная управляющая конструкция похожа на <b><a 
href="symbols.html#x188-380192r192">case</a></b>, но без явных
<b>otherwise</b> или <b><a 
href="symbols.html#x188-380951r951">t</a></b> выражений. Если ни одно выражение не подошло под
условие, <b><a 
href="symbols.html#x188-380361r361">ecase</a></b> сигнализирует ошибку (типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>) со строкой,
которая будет создана на основе этих выражений. Исправить данную
ошибку невозможно. Для указания сообщения, пользователь должен
использовать <b><a 
href="symbols.html#x188-380192r192">case</a></b> с выражением <b>otherwise</b>, содержащим вызов <b><a 
href="symbols.html#x188-380383r383">error</a></b>. Имя
данной функции образовано от «exhaustive case» или «error-checking
case».
<!--l. 4289--><p class="indent" >   Например: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                                                                                     <span class="math"> ⇒</span> 1/3<br>
Lisp&#x003E; (ecase x<br>                                              (alpha (foo))<br>
        (omega (bar))<br>                                ((zeta phi) (baz)))<br>
Error: The value of X, 1/3, is not ALPHA, OMEGA, ZETA, or PHI.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Return to Lisp Toplevel.<br>                                       Debug&#x003E;<br>
<!--l. 4301--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4305--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <em>[Макрос]</em> <b>ccase</b> <a 
 id="dx181-328004"></a>keyplace {({({key}*) | key} {form}*)}*
   <br>
<!--l. 4306--><p class="noindent" ></div>
</div>
<!--l. 4307--><p class="indent" >   Данная управляющая конструкция похожа на <b><a 
href="symbols.html#x188-380192r192">case</a></b>, но без явных
<b>otherwise</b> или <b><a 
href="symbols.html#x188-380951r951">t</a></b> выражений.
<!--l. 4310--><p class="indent" >   Аргумент <em>keyplace</em> должен быть обобщённой переменной, которая может
использоваться в <b><a 
href="symbols.html#x188-380844r844">setf</a></b>. Если ни одно выражение не соответствовало типу
<em>keyplace</em>, <b><a 
href="symbols.html#x188-380194r194">ccase</a></b> сигнализирует ошибку (типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>) с сообщением,
которое генерируется с использованием выражений. Данная ошибка может
быть исправлена с помощью перезапуска <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>. Аргумент для
<b><a 
href="symbols.html#x188-380902r902">store-value</a></b> сохраняется в <em>keyplace</em> и затем <b><a 
href="symbols.html#x188-380303r303">ctypecase</a></b> вновь проверяет тип
выражения. Таким образом подформы <em>keyplace</em> могут быть выполнены
несколько раз. Если перезапуск <b><a 
href="symbols.html#x188-380902r902">store-value</a></b> был запущен интерактивно, у
пользователя будет запрошено новое значение.
<!--l. 4320--><p class="indent" >   Имя функции образовано от «continuable (exhaustive) case».
_________<div class="implementation">
<!--l. 4323--><p class="noindent" ><b>Заметка для реализации:</b> The <b><a 
href="symbols.html#x188-380971r971">type-error</a></b> signaled by <b><a 
href="symbols.html#x188-380194r194">ccase</a></b> and <b><a 
href="symbols.html#x188-380361r361">ecase</a></b>
is free to choose any representation of the acceptable argument type that it
wishes for placement in the expected-type slot. It will always work to use type
<b>(member . <em>keys</em>)</b>, but in some cases it may be more eﬃcient, for example, to use a
type that represents an integer subrange or a type composed using the <b><a 
href="symbols.html#x188-380703r703">or</a></b> type
speciﬁer.
</div>___________________________________________________________________________________________________________
<hr>
</div>
<!--l. 4334--><p class="noindent" >
     <h4 class="subsectionHead"><span class="titlemark">28.4.4   </span> <a 
href="frontmatter.html#QQ2-181-373" id="x181-32900028.4.4">Обработка условий</a></h4>
<!--l. 4336--><p class="noindent" >Данные макросы позволяют программе контролировать ситуацию в случае
сигнализирования условия.
<div class="defmac">
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 4340--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>handler-case</b> <a 
 id="dx181-329001"></a>expression {(typespec ([var]) {form}*)}*
   <br>
<!--l. 4341--><p class="noindent" ></div>
</div>
<!--l. 4342--><p class="indent" >   Форма выполняет заданное выражение <em>expression</em> в контексте указанных
обработчиков условий.
<!--l. 4345--><p class="indent" >   Каждый <em>typespec</em> может быть любым спецификатором типа. Если во
время выполнения <em>expression</em> было сигнализировано условие, для которого
указан соответствующий обработчик—то есть, одно из выражений <b>(typep
<em>condition</em> &#x2019;<em>typespec</em>)</b> истинно—и если внутри выражения не было других
обработчиков для этого типа условия, тогда выполнение переносится в
тело соответствующего обработчика (должным образом раскручивая
динамические состояния) и заданная переменная <em>var</em> связывается с
сгенерированным объектом условия. Если условия сигнализировано не было,
форма <b><a 
href="symbols.html#x188-380479r479">handler-case</a></b> возвращает значение(я) формы <em>expression</em>.
<!--l. 4355--><p class="indent" >   Если указано более одного обработчика, то они делаются доступными
параллельно. То есть в выражении <div class="lisp"><tt><div class="tabbing">
(handler-case <em>expression</em>
   <br>                                                                (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) <em>form<span class="math"><sub>1</sub></span></em>)<br>
  (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) <em>form<span class="math"><sub>2</sub></span></em>))<br>
<!--l. 4361--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4362--><p class="indent" >   если будет выбрано первое выражение (содержащие <em>form<span class="math"><sub>1</sub></span></em>, то второй
обработчик для первого виден не будет.
<!--l. 4365--><p class="indent" >   Обработчики ищутся последовательно сверху вниз. Если сигнализированное
условие подходит более чем одному обработчику (возможно при пересечении
типов), то выбран будет наиболее верхний (или наиболее ранее
встретившийся).
<!--l. 4369--><p class="indent" >   Если в переменной <em>var</em> нет необходимости, она может быть опущена. То
есть, такое выражение как <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(<em>type</em> (<em>var</em>) (declare (ignore <em>var</em>)) <em>form</em>)
   <br>
<!--l. 4373--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4374--><p class="indent" >   может быть записано так <div class="lisp"><tt><div class="tabbing">
(<em>type</em> () <em>form</em>)
   <br>
<!--l. 4377--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4379--><p class="indent" >   Если для условия не было найдено соответствующего обработчика,
<b><a 
href="symbols.html#x188-380479r479">handler-case</a></b> возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. Следует отметить, что <div class="lisp"><tt><div class="tabbing">
(handler-case <em>expression</em>
   <br>                  (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                   (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...)<br>
<!--l. 4386--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4387--><p class="indent" >   приблизительно эквивалентно <div class="lisp"><tt><div class="tabbing">
(block #1=#:block-1
   <br>                                                                      (let (#2=#:var-2)<br>
    (tagbody<br>                    (handler-bind ((<em>type<span class="math"><sub>1</sub></span></em> #&#x2019;(lambda (temp)<br>
                                (setq #2# temp)<br>
                                (go #3=#:tag-3)))<br>
                     (<em>type<span class="math"><sub>2</sub></span></em> #&#x2019;(lambda (temp)<br>
                                                                          

                                                                          
                                   (setq #2# temp)<br>
                                   (go #4=#:tag-4)))<br>
                     ...)<br>               (return-from #1# <em>expression</em>))<br>
      #3# (return-from #1# (let ((<em>var<span class="math"><sub>1</sub></span></em> #2#)) . <em>body<span class="math"><sub>1</sub></span></em>))<br>
      #4# (return-from #1# (let ((<em>var<span class="math"><sub>2</sub></span></em> #2#)) . <em>body<span class="math"><sub>2</sub></span></em>))<br>           ...)))<br>
<!--l. 4403--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4404--><p class="indent" >   [Note the use of “gensyms” such as <b>#:block-1</b> as block names, variables, and
<b><a 
href="symbols.html#x188-380952r952">tagbody</a></b> tags in this example, and the use of <b>#<em>n</em>=</b> and <b>#<em>n</em>#</b> read-macro
syntax to indicate that the very same gensym appears in multiple places.—GLS]
<!--l. 4409--><p class="indent" >   В исключительном случае в последнем обработчике спецификатор
<em>typespec</em> может быть символом <b>:no-error</b>. Тогда, данный обработчик получит
управление, если вычисление <em>expression</em> завершилось нормально. В
этом случае, после символа <b>:no-error</b> может следовать полноценный
лямбда-список, и данный лямбда-список будет связан с значениями
выражения <em>expression</em>, как если бы с помощью <b><a 
href="symbols.html#x188-380657r657">multiple-value-call</a></b>.
Например, <div class="lisp"><tt><div class="tabbing">
(handler-case <em>expression</em>
   <br>                  (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                   (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...<br>                                                 (<em>type<span class="math"><sub>n</sub></span></em> (<em>var<span class="math"><sub>n</sub></span></em>) . <em>body<span class="math"><sub>n</sub></span></em>)<br>
  (:no-error (<em>nvar<span class="math"><sub>1</sub></span></em> <em>nvar<span class="math"><sub>2</sub></span></em> ... <em>nvar<span class="math"><sub>m</sub></span></em>) . <em>nbody</em>))<br>
<!--l. 4422--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4423--><p class="indent" >   примерно эквивалентно <div class="lisp"><tt><div class="tabbing">
(block #1=#:error-return
   <br>           (multiple-value-call #&#x2019;(lambda (<em>nvar<span class="math"><sub>1</sub></span></em> <em>nvar<span class="math"><sub>2</sub></span></em> ... <em>nvar<span class="math"><sub>m</sub></span></em>) . <em>nbody</em>)<br>
    (block #2=#:normal-return<br>                       (return-from #1#<br>
        (handler-case (return-from #2# <em>expression</em>)<br>
          (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                    (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
          ...<br>                                  (<em>type<span class="math"><sub>n</sub></span></em> (<em>var<span class="math"><sub>n</sub></span></em>) . <em>body<span class="math"><sub>n</sub></span></em>))))))<br>
                                                                          

                                                                          
<!--l. 4434--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4436--><p class="indent" >   Примеры использования <b><a 
href="symbols.html#x188-380479r479">handler-case</a></b>: <div class="lisp"><tt><div class="tabbing">
(handler-case (/ x y)
   <br>                                                              (division-by-zero () nil))<br>
<br>                            (handler-case (open *the-ﬁle* :direction :input)<br>
  (ﬁle-error (condition) (format t &#x0022;~&#x0026;Fooey: ~A~%&#x0022; condition)))<br>
<br>                                        (handler-case (some-user-function)<br>
  (ﬁle-error (condition) condition)<br>                   (division-by-zero () 0)<br>
  ((or unbound-variable undeﬁned-function) () &#x2019;unbound))<br>                <br>
(handler-case (intern x y)<br>                     (error (condition) condition)<br>
  (:no-error (symbol status)<br>                     (declare (ignore symbol))<br>
    status))<br>
<!--l. 4454--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4458--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ignore-errors</b> <a 
 id="dx181-329002"></a>{form}*
   <br>
<!--l. 4459--><p class="noindent" ></div>
</div>
<!--l. 4460--><p class="indent" >   Выполняет тело <em>forms</em> при этом обрабатывая условия типа <b><a 
href="symbols.html#x188-380383r383">error</a></b> тем,
что просто возвращаем управление из этой формы. Если не было
сигнализировано условий, в качестве результата выступает значение(я)
последней формы. Иначе возвращается два значения: <b><a 
href="symbols.html#x188-380670r670">nil</a></b> и <b><a 
href="symbols.html#x188-380383r383">error</a></b> условие,
которое было сигнализировано.
<b>
<!--l. 4466--><p class="indent" >   ignore-error</b> может быть определено следующим образом: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(defmacro ignore-errors (&#x0026;body forms)
   <br>                                                     ‘(handler-case (progn ,@forms)<br>
     (error (c) (values nil c))))<br>
<!--l. 4471--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4475--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>handler-bind</b> <a 
 id="dx181-329003"></a>({(typespec handler)}*) {form}*
   <br>
<!--l. 4476--><p class="noindent" ></div>
</div>
<!--l. 4477--><p class="indent" >   Выполняет тело в динамическом контексте, в котором установлены
заданные обработчики. Каждый <em>typespec</em> может быть любым спецификатором
типа. Каждый форма <em>handler</em> должна вернуть функцию, которая будет
использоваться для обработки условия заданного типа, если такое условие
будет сигнализировано в формах <em>form</em>. Эта функция должна принимать один
аргумент — сигнализируемое условие.
<!--l. 4484--><p class="indent" >   Если указано более одного обработчика, то поиск подходящего
осуществляется последовательно сверху вниз (по визуальной аналогии с
<b><a 
href="symbols.html#x188-380975r975">typecase</a></b>). Если соответствующий спецификатор типа <em>typespec</em> найден, то
связанный обработчик выполняется в контексте, в котором больше нет
обработчиков, чтобы избежать ошибки рекурсии. Например в случае:
<div class="lisp"><tt><div class="tabbing">
(handler-bind ((unbound-variable #&#x2019;(lambda ...))
   <br>                                                         (error #&#x2019;(lambda ...)))<br>
  ...)<br>
                                                                          

                                                                          
<!--l. 4493--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4494--><p class="indent" >   если в теле сигнализируется ошибка «несвязанной переменной» (и в этом
же теле она не обрабатывается), выполняется первая функция. Если
сигнализируется какой-либо другой тип ошибки, вызывается вторая
функция. В любом случае ни один из перечисленных обработчиков не
доступен в теле другого.
<hr></div>
<!--l. 4500--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.5   </span> <a 
href="frontmatter.html#QQ2-181-374" id="x181-33000028.4.5">Определение типов условий</a></h4>
<!--l. 4502--><p class="noindent" >[The contents of this section are still a subject of some debate within X3J13. The
reader may wish to take this section with a grain of salt, two aspirin tablets, and
call a hacker in the morning.—GLS]
<div class="defmac">
<div class="defmacheader">
<!--l. 4507--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>deﬁne-condition</b> <a 
 id="dx181-330001"></a>name ({parent-type}*)[({slot-speciﬁer}*) {option}*]
   <br>
<!--l. 4509--><p class="noindent" ></div>
</div>
<!--l. 4510--><p class="indent" >   Определяет новый тип условия с именем <em>name</em> и родительским
типом <em>parent-type</em>. Аргументы формы не вычисляются, если не указано
иное.
<!--l. 4513--><p class="indent" >   Объекты данного типа условия будут содержать все заданные слоты <em>slot</em>,
а также дополнительные слоты, унаследованные от родительских
типов. Если список слотов не указан, то используется пустой список
слотов.
<!--l. 4517--><p class="indent" >   Аргумент <em>slot</em> должен иметь форму <div class="tabbing">
<em>slot-speciﬁer</em> ::= <em>slot-name</em> | (<em>slot-name</em> <span class="math">[[↓<em>slot-option</em> ]]</span>)
   <br>
                                                                          

                                                                          
<!--l. 4520--><p class="noindent" ></div>Для синтаксиса параметра <em>slot-option</em>, смотрите <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>. Слоты объекта
условия являются обычными CLOS слотами. Следует отметить, что вместо
функций доступа к слотам может использоваться <b><a 
href="symbols.html#x188-381023r1023">with-slots</a></b>.
<b>
<!--l. 4526--><p class="indent" >   <a 
href="symbols.html#x188-380591r591">make-condition</a></b> будет принимать ключевые символы (из пакета
ключевых символов) с выводимыми именами соответствующие слотам, и
инициализировать данные слоты указанными значениями.
<!--l. 4530--><p class="indent" >   Функции доступа к слотам (аксессоры) создаются в соответствие с теми
же правилами, как и для <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.
<!--l. 4533--><p class="indent" >   Корректные параметры <em>options</em> перечислены ниже:
<div class="flushdesc">
      <ul><li><b>
<b>(:documentation <em>doc-string</em>)</b> </b></li>
<em>
      <!--l. 4539--><p class="noindent" >doc-string</em> должен быть или <b><a 
href="symbols.html#x188-380670r670">nil</a></b> или строкой, которая описывает
      смысл данного типа условия. Если данный параметр не указан,
      то  используется  значение  <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.  Для  получения  значения  данного
      параметра служит форма <b>(documentation &#x2019;<em>name</em> &#x2019;type)</b>
      <li><b>
<b>(:report <em>exp</em>)</b> </b></li>
      <!--l. 4546--><p class="noindent" >Если  <em>exp</em>  не  является  литеральной  строкой,  она  должна  быть
      подходящим  аргументом  для  специального  оператора  <b><a 
href="symbols.html#x188-380446r446">function</a></b>.
      В текущем лексическом окружении будет выполнено выражение
      <b>(function <em>exp</em>)</b>.  Данная  форма  должна  вернуть  функцию  двух
      аргументов:  условия  и  потока,  которая  будет  выводить  в  поток
      описание  данного  условия.  Данная  функция  вызывается  всякий
      раз, когда выводится условие, пока <b><a 
href="symbols.html#x188-380037r37">*print-escape*</a></b> равно <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      <!--l. 4553--><p class="noindent" >Если <em>exp</em> является литеральной строкой, она заменяется <div class="lisp"><tt><div class="tabbing">
      (lambda (c s)
      <br>                                                                  (declare (ignore c))<br>
             (write-string <em>exp</em> s))<br>
                                                                          

                                                                          
      <!--l. 4558--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4559--><p class="noindent" >[That is, a function is provided that will simply write the given string
      literally to the stream, regardless of the particular condition object
      supplied.—GLS]
      <!--l. 4563--><p class="noindent" >Параметр <b>:report</b> обрабатывается <em>после</em> того, как будет создан новый
      тип условия, таким образом, в функции вывода можно использовать
      аксессоры слотов. Если данный параметр не указан, информация о том,
      как выводить данный тип условия будет унаследована от родительского
      типа.
      </ul>
</div>
<!--l. 4570--><p class="indent" >   Вот несколько примеров использования <b><a 
href="symbols.html#x188-380314r314">deﬁne-condition</a></b>.
<!--l. 4572--><p class="indent" >   Следующая форма определяет тип условия <b>peg/hole-mismatch</b>, который
наследует тип <b>blocks-world-error</b>: <div class="lisp"><tt><div class="tabbing">
(deﬁne-condition peg/hole-mismatch (blocks-world-error)
   <br>                                                      (peg-shape hole-shape)<br>
  (:report<br>                                     (lambda (condition stream)<br>
      (with-slots (peg-shape hole-shape) condition<br>
        (format stream &#x0022;A ~A peg cannot go in a ~A hole.&#x0022;<br>
                peg-shape hole-shape))))<br>
<!--l. 4582--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4583--><p class="indent" >   Новый тип содержит слоты <b>peg-shape</b> и <b>hole-shape</b>, таким <b><a 
href="symbols.html#x188-380591r591">make-condition</a></b>
будет принимать именованные параметры <b>:peg-shape</b> и <b>:hole-shape</b>. Как
показано в <b>:report</b>, для доступа к слотам <b>peg-shape</b> и<b>hole-shape</b> может
использовать макрос <b><a 
href="symbols.html#x188-381023r1023">with-slots</a></b>.
<!--l. 4588--><p class="indent" >   Вот другой пример. В нем определяется условие <b>machine-error</b>
унаследованное от <b><a 
href="symbols.html#x188-380383r383">error</a></b>: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(deﬁne-condition machine-error (error)
   <br>                                                                ((machine-name<br>
                    :reader machine-error-machine-name))<br>
  (:report (lambda (condition stream)<br>
             (format stream &#x0022;There is a problem with ~A.&#x0022;<br>
                     (machine-error-machine-name condition)))))<br>
<!--l. 4597--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4598--><p class="indent" >   После выполнения этой формы, мы можем определить новый тип ошибки,
которые будет являться подтипом <b>machine-error</b> для использования когда
компьютер не доступен: <div class="lisp"><tt><div class="tabbing">
(deﬁne-condition machine-not-available-error (machine-error) ()
   <br>                                               (:report (lambda (condition stream)<br>
             (format stream &#x0022;The machine ~A is not available.&#x0022;<br>
                     (machine-error-machine-name condition)))))<br>
<!--l. 4605--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4606--><p class="indent" >   Теперь можно определить ещё более специфичный тип условия,
который содержит для слота <b>machine-name</b> значение по-умолчанию.
<div class="lisp"><tt><div class="tabbing">
(deﬁne-condition my-favorite-machine-not-available-error
   <br>                                               (machine-not-available-error)<br>
                  ((machine-name :initform &#x0022;MC.LCS.MIT.EDU&#x0022;)))<br>
<!--l. 4612--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4613--><p class="indent" >   Следует отметить, что параметр <b>:report</b> не был указан, поэтому способ
вывода объекта условия будет унаследован от <b>machine-not-available-error</b>.
<hr></div>
                                                                          

                                                                          
<!--l. 4617--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.6   </span> <a 
href="frontmatter.html#QQ2-181-375" id="x181-33100028.4.6">Создание условий</a></h4>
<!--l. 4619--><p class="noindent" >Для создания объектов условий используется функция <b><a 
href="symbols.html#x188-380591r591">make-condition</a></b>.
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-331001"></a>
<em>
<!--l. 4622--><p class="noindent" >[Функция]</em> <b>make-condition</b> <i>type</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>slot-initializations</i>
</div>
<!--l. 4624--><p class="indent" >   Создаёт объект условия заданного типа <em>type</em> с использованием
значений для слотов из <em>slot-initializations</em>. Функция возвращает созданный
объект.
<!--l. 4627--><p class="indent" >   Аргументы <em>slot-initializations</em> представлены в виде пар: ключевой символ,
значение. Например: <div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;peg/hole-mismatch
   <br>                                   :peg-shape &#x2019;square :hole-shape &#x2019;round)<br>
<!--l. 4632--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<!--l. 4635--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.7   </span> <a 
href="frontmatter.html#QQ2-181-376" id="x181-33200028.4.7">Установка перезапусков</a></h4>
<!--l. 4637--><p class="noindent" >Базовая форма, которая создаёт точки перезапусков, называется <b><a 
href="symbols.html#x188-380813r813">restart-bind</a></b>.
Макрос <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b> является абстракцией, которая решает большинство
задач <b><a 
href="symbols.html#x188-380813r813">restart-bind</a></b>, и имеет более приятный синтаксис. Смотрите также
<b><a 
href="symbols.html#x188-381022r1022">with-simple-restart</a></b>. Функция, которая передаёт управление в точку
перезапуска, установленную одним из этих макросов, называется
<b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b>.
<!--l. 4644--><p class="indent" >   Все перезапуски имеют динамическую продолжительность видимости.
Перезапуск не оставляет в живых форму, которая его установила.
                                                                          

                                                                          
<div class="defmac">
<div class="defmacheader">
<!--l. 4648--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>with-simple-restart</b> <a 
 id="dx181-332001"></a>(name format-string {format-argument}*){form}*
   <br>
<!--l. 4650--><p class="noindent" ></div>
</div>
<!--l. 4651--><p class="indent" >   Это сокращение для одного из наиболее распространённых применений
<b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>.
<!--l. 4654--><p class="indent" >   Если перезапуск с именем <em>name</em> во время исполнения форм <em>form</em> не
вызывался, то <em>with-simple-restart</em> возвращает все значения, которые вернула
последняя форма <em>form</em>. Если перезапуск запускался, управление передаётся в
форму <b><a 
href="symbols.html#x188-381022r1022">with-simple-restart</a></b>, которая немедленно возвращает два значения
<b><a 
href="symbols.html#x188-380670r670">nil</a></b> и <b><a 
href="symbols.html#x188-380951r951">t</a></b>.
<!--l. 4660--><p class="indent" >   Аргумент <em>name</em> может быть <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. В этом случае устанавливается
анонимный перезапуск.
<b>
<!--l. 4663--><p class="indent" >   <a 
href="symbols.html#x188-381022r1022">with-simple-restart</a></b> может быть определён так <div class="lisp"><tt><div class="tabbing">
(defmacro with-simple-restart ((restart-name format-string
   <br>                                            &#x0026;rest format-arguments)<br>
                               &#x0026;body forms)<br>
  ‘(restart-case (progn ,@forms)<br>                         (,restart-name ()<br>
       :report<br>                                         (lambda (stream)<br>
           (format stream format-string ,@format-arguments))<br>
       (values nil t))))<br>
<!--l. 4674--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4676--><p class="indent" >   Пример использования <b><a 
href="symbols.html#x188-381022r1022">with-simple-restart</a></b>. <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (defun read-eval-print-loop (level)
                                                                          

                                                                          
   <br>                                                                (with-simple-restart<br>
            (abort &#x0022;Exit command level ~D.&#x0022; level)<br>
          (loop<br>                                    (with-simple-restart<br>
                (abort &#x0022;Return to command level ~D.&#x0022; level)<br>
              (let ((form (prog2 (fresh-line)<br>
                                 (read)<br>
                                 (fresh-line))))<br>
                (prin1 (eval form)))))))<br>
 <span class="math"> ⇒</span> READ-EVAL-PRINT-LOOP<br>           Lisp&#x003E; (read-eval-print-loop 1)<br>
(+ &#x2019;a 3)<br> Error: The argument, A, to the function + was of the wrong type.<br>
       The function expected a number.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use this time.<br>         2: Return to command level 1.<br>
 3: Exit command level 1.<br>                      4: Return to Lisp Toplevel.<br>
Debug&#x003E;<br>
<!--l. 4699--><p class="noindent" ></div>
</tt>
</div>
__________________________________________________________________________
<!--l. 4702--><p class="noindent" ><b>Примечание:</b> Some readers may wonder what ought to be done by the “abort” key (or
whatever the implementation&#x2019;s interrupt key is—Control-C or Control-G, for example).
Such interrupts, whether synchronous or asynchronous in nature, are beyond the scope
of this chapter and indeed are not currently addressed by Common Lisp at all. This may
be a topic worth standardizing under separate cover. Here is some speculation about
some possible things that might happen.
<!--l. 4710--><p class="indent" >     An implementation might simply call <b><a 
href="symbols.html#x188-380081r81">abort</a></b> or <b><a 
href="symbols.html#x188-380168r168">break</a></b> directly without signaling any
condition.
<!--l. 4713--><p class="indent" >     Another implementation might signal some condition related to the fact that a key
had been pressed rather than to the action that should be taken. This is one way to
allow user customization. Perhaps there would be an implementation-dependent
<b>keyboard-interrupt</b> condition type with a slot containing the key that was
pressed—or perhaps there would be such a condition type, but rather than its
having slots, diﬀerent subtypes of that type with names like <b>keyboard-abort</b>,
<b>keyboard-break</b>, and so on might be signaled. That implementation would
then document the action it would take if user programs failed to handle the
condition, and perhaps ways for user programs to usefully dismiss the interrupt.__
<div class="implementation">
                                                                          

                                                                          
<!--l. 4725--><p class="noindent" ><b>Заметка для реализации:</b> Implementors are encouraged to make sure that there is
always a restart named <b><a 
href="symbols.html#x188-380081r81">abort</a></b> around any user code so that user code can
call <b><a 
href="symbols.html#x188-380081r81">abort</a></b> at any time and expect something reasonable to happen; exactly
what the reasonable thing is may vary somewhat. Typically, in an interactive
program, invoking <b><a 
href="symbols.html#x188-380081r81">abort</a></b> should return the user to top level, though in some
batch or multi-processing situations killing the running process might be more
appropriate.
</div>
___________________________________________________________________________________
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4738--><p class="indent" >     <div class="tabbing">
  <em>[Макрос]</em> <b>restart-case</b> <a 
 id="dx181-332002"></a>expression {(case-name arglist{keyword value}*{form}*)}*
     <br>
<!--l. 4741--><p class="noindent" ></div>
</div>
<!--l. 4742--><p class="indent" >     Аргумент <em>expression</em> вычисляется в динамическом контексте, в
котором выражения рассматриваются как точки, в которые может
быть передано управление. Если <em>expression</em> завершает выполнение и
возвращает некоторые значения, все эти значения просто возвращаются из
формы <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>. При выполнении <em>expression</em>, любой код может
передать управление в одно из выражений (смотрите <b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b>).
Если передача состоялась, формы из тела данного выражения будут
вычислены и значения последней из них станут результатом формы
<b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>.
<!--l. 4751--><p class="indent" >     Как частный случай, если <em>expression</em> является списком, в котором <em>car</em>
равен <b><a 
href="symbols.html#x188-380854r854">signal</a></b>, <b><a 
href="symbols.html#x188-380383r383">error</a></b>, <b><a 
href="symbols.html#x188-380213r213">cerror</a></b> или <b><a 
href="symbols.html#x188-381007r1007">warn</a></b>, тогда <b><a 
href="symbols.html#x188-381015r1015">with-condition-restarts</a></b> неявно
используется для связывания перезапусков с сигнализируемым условием.
Например, <div class="lisp"><tt><div class="tabbing">
(restart-case (signal weird-error)
     <br>                 (become-confused ...)<br>                 (rewind-line-printer ...)<br>
  (halt-and-catch-ﬁre ...))<br>
                                                                          

                                                                          
<!--l. 4760--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4761--><p class="indent" >   эквивалентно <div class="lisp"><tt><div class="tabbing">
(restart-case (with-condition-restarts
   <br>                                                                       weird-error<br>
                (list (ﬁnd-restart &#x2019;become-confused)<br>
                      (ﬁnd-restart &#x2019;rewind-line-printer)<br>
                      (ﬁnd-restart &#x2019;halt-and-catch-ﬁre))<br>
                (signal weird-error))<br>               (become-confused ...)<br>
  (rewind-line-printer ...)<br>                          (halt-and-catch-ﬁre ...))<br>
<!--l. 4772--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4774--><p class="indent" >   Если форм <em>form</em> в выбранном выражении нет, <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b> просто
возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<em>
<!--l. 4777--><p class="indent" >   case-name</em> может быть <b><a 
href="symbols.html#x188-380670r670">nil</a></b> или символом, который именует перезапуск.
<!--l. 4779--><p class="indent" >   Возможно использовать более одного выражения с одинаковым именем
<em>case-name</em>. В этом случае, <b><a 
href="symbols.html#x188-380421r421">ﬁnd-restart</a></b> вернёт первое выражение с этим
именем. Остальные выражения доступны с помощью <b><a 
href="symbols.html#x188-380277r277">compute-restarts</a></b>.
<!--l. 4783--><p class="indent" >   Каждый аргумент <em>arglist</em> является обычным лямбда-списком содержащим
параметры для связываний в которых будет выполнены формы <em>form</em>. Данные
параметры используются для передачи любых необходимых данных из
вызова <b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b> в выражение <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>.
<!--l. 4788--><p class="indent" >   По-умолчанию, <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> будет вызывать перезапуски
без аргументов и все параметры должны быть необязательными для связи с
интерактивным перезапуском. Однако, параметры параметры могут быть
обязательными, если ключевой символ <b>:interactive</b> будет использоваться для
указания <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> о том, как вычислить необходимый
список аргументов.
<!--l. 4795--><p class="indent" >   Доступные пары <em>keyword value</em> перечислены ниже: <div class="flushdesc">
      <ul><li><b>
<b>:test <em>fn</em></b> </b></li>
                                                                          

                                                                          
      <!--l. 4800--><p class="noindent" >Аргумент <em>fn</em> должен быть подходящим аргументом для специального
      оператора <b><a 
href="symbols.html#x188-380446r446">function</a></b>. Выражение <b>(function <em>fn</em>)</b> будет вычислено в
      текущем лексическом окружении. Оно должно вернуть функцию одного
      аргумента: условия. Если полученная функция возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b> для
      заданного условия, функции <b><a 
href="symbols.html#x188-380421r421">ﬁnd-restart</a></b>, <b>compute-restart</b> и
      <b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b> при поиске данных перезапуск рассматривать не будут.
      Если эта пара не указана, то используется значение по-умолчанию
      <div class="lisp"><tt><div class="tabbing">
      (lambda (c) (declare (ignore c)) t)
      <br>
      <!--l. 4810--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>:interactive <em>fn</em></b> </b></li>
      <!--l. 4814--><p class="noindent" >Аргумент <em>fn</em> должен быть подходящим аргументом для специального
      оператора <b><a 
href="symbols.html#x188-380446r446">function</a></b>. Выражение <b>(function <em>fn</em>)</b> будет вычислено в
      текущем лексическом окружении. Оно должно вернуть функцию без
      аргументов, которая возвращает аргументы, которые используются
      <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> при вызове данной функции. Эта
      функция будет вызываться в динамическом окружении доступном
      при любой попытке перезапуска. Если необходимо функция
      может интерактивно запрашивать значения с использованием
      <b><a 
href="symbols.html#x188-380048r48">*query-io*</a></b>.
      <!--l. 4824--><p class="noindent" >Если перезапуск был вызван интерактивно, но параметр <b>:interactive</b> не
      был указан, список аргументов будет пустым.
      <li><b>
<b>:report <em>exp</em></b> </b></li>
      <!--l. 4829--><p class="noindent" >Если выражение <em>exp</em> не является литеральной строкой, оно должно
      быть подходящим аргументом для специального оператора <b><a 
href="symbols.html#x188-380446r446">function</a></b>.
      Выражение <b>(function <em>exp</em>)</b> будет вычисляться в текущем лексическом
                                                                          

                                                                          
      окружении. Оно должно вернуть функцию одного аргумента: потока,
      которая выводит в данный поток описание определяемого перезапуска.
      Полученная функция вызывается каждый раз при выводе перезапуска
      при <b><a 
href="symbols.html#x188-380037r37">*print-escape*</a></b> равном <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      <!--l. 4837--><p class="noindent" >Если <em>exp</em> является литеральной строкой, то используется следующая
      функция: <div class="lisp"><tt><div class="tabbing">
      (lambda (s) (write-string <em>exp</em> s))
      <br>
      <!--l. 4841--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4843--><p class="noindent" >Если именованный перезапуск должен быть выведен, но доступной о
      нём информации нет, тогда используется его имя в умолчательном
      выводимом тексте.
      <!--l. 4846--><p class="noindent" >When <b><a 
href="symbols.html#x188-380037r37">*print-escape*</a></b> is <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, the printer will use the report information for
      a restart. For example, a debugger might announce the action of typing
      “<b>:continue</b>” by executing the equivalent of <div class="lisp"><tt><div class="tabbing">
      (format *debug-io* &#x0022;~&#x0026;~S – ~A~%&#x0022; &#x2019;:continue some-restart)
      <br>
      <!--l. 4851--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4852--><p class="noindent" >which might then display as something like <div class="lisp"><tt><div class="tabbing">
      :CONTINUE – Return to command level.
      <br>
                                                                          

                                                                          
      <!--l. 4855--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4857--><p class="noindent" >Указание анонимного перезапуска и отсутствие информации о нём
      является ошибкой.
_________________________________________________<div class="rationale">
        <!--l. 4859--><p class="noindent" ><b>Обоснование:</b> Unnamed restarts are required to have report information on the
        grounds that they are generally only useful interactively, and an interactive option
        that has no description is of little value.
        </div>___________________________________________________________________________________________________<div class="implementation">
        <!--l. 4865--><p class="noindent" ><b>Заметка для реализации:</b> Implementations are encouraged to warn about this
        error at compilation time.
        <!--l. 4869--><p class="noindent" >At run time, this error might be noticed when entering the debugger. Since
        signaling an error would probably cause recursive entry into the debugger (causing
        yet another recursive error, and so on), it is suggested that the debugger print
        some indication of such problems when they occur, but not actually signal
        errors.
        </div>___________________________________________________________________________________________________
        </ul>
</div>
<!--l. 4878--><p class="noindent" >Следует отметить, что <div class="lisp"><tt><div class="tabbing">
(restart-case <em>expression</em>
    <br>    (<em>name<span class="math"><sub>1</sub></span></em> <em>arglist<span class="math"><sub>1</sub></span></em> <em>options<span class="math"><sub>1</sub></span></em> . <em>body<span class="math"><sub>1</sub></span></em>)<br>    (<em>name<span class="math"><sub>2</sub></span></em> <em>arglist<span class="math"><sub>2</sub></span></em> <em>options<span class="math"><sub>2</sub></span></em> . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...)<br>
<!--l. 4884--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4885--><p class="indent" >     в сущности эквивалентно <div class="lisp"><tt><div class="tabbing">
(block #1=#:block-1
                                                                          

                                                                          
   <br>                                                               (let ((#2=#:var-2 nil))<br>
    (tagbody<br>              (restart-bind ((<em>name<span class="math"><sub>1</sub></span></em> #&#x2019;(lambda (&#x0026;rest temp)<br>
                                 (setq #2# temp)<br>
                                 (go #3=#:tag-3))<br>
                             <span class="math">⟨</span>slightly transformed <em>options<span class="math"><sub>1</sub></span></em><span class="math">⟩</span>)<br>
                     (<em>name<span class="math"><sub>2</sub></span></em> #&#x2019;(lambda (&#x0026;rest temp)<br>
                                     (setq #2# temp)<br>
                                     (go #4=#:tag-4))<br>
                                 <span class="math">⟨</span>slightly transformed <em>options<span class="math"><sub>2</sub></span></em><span class="math">⟩</span>)<br>
                     ...)<br>
        (return-from #1# expression))<br>          #3# (return-from #1#<br>
                (apply #&#x2019;(lambda <em>arglist<span class="math"><sub>1</sub></span></em> . <em>body<span class="math"><sub>1</sub></span></em>) #2#))<br>
      #4# (return-from #1#<br>
                (apply #&#x2019;(lambda <em>arglist<span class="math"><sub>2</sub></span></em> . <em>body<span class="math"><sub>2</sub></span></em>) #2#))<br>         ...)))<br>
<!--l. 4905--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4906--><p class="indent" >   [Note the use of “gensyms” such as <b>#:block-1</b> as block names, variables, and
<b><a 
href="symbols.html#x188-380952r952">tagbody</a></b> tags in this example, and the use of <b>#<em>n</em>=</b> and <b>#<em>n</em>#</b> read-macro
syntax to indicate that the very same gensym appears in multiple places.—GLS]
<!--l. 4911--><p class="indent" >   Несколько примеров использования <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>. <div class="lisp"><tt><div class="tabbing">
(loop
   <br>                              (restart-case (return (apply function some-args))<br>
    (new-function (new-function)<br>
        :report &#x0022;Use a diﬀerent function.&#x0022;<br>
        :interactive<br>                                          (lambda ()<br>
            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))<br>
      (setq function new-function))))<br>                                     <br>
(loop<br>                     (restart-case (return (apply function some-args))<br>
    (nil (new-function)<br>                :report &#x0022;Use a diﬀerent function.&#x0022;<br>
        :interactive<br>                                          (lambda ()<br>
            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))<br>
      (setq function new-function))))<br>                                     <br>
(restart-case (a-command-loop)<br>             (return-from-command-level ()<br>
      :report<br>                  (lambda (s)     ;Argument <b>s</b> is a stream<br>
                                                                          

                                                                          
          (format s &#x0022;Return from command level ~D.&#x0022; level))<br>     nil))<br> <br>
(loop<br>                          (restart-case (another-random-computation)<br>
    (continue () nil)))<br>
<!--l. 4941--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4942--><p class="indent" >   Первый и второй пример эквивалентны если рассматривать их с точки
зрения интерактивной отладки, но они отличаются в одном важном аспекте в
неинтерактивной обработке. Если обработчик «знает о» именованных
перезапусках, как например в: <div class="lisp"><tt><div class="tabbing">
(when (ﬁnd-restart &#x2019;new-function)
   <br>                                (invoke-restart &#x2019;new-function the-replacement))<br>
<!--l. 4949--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4950--><p class="indent" >   тогда только первый пример будет содержать передачу управления в
корректирующее выражение, так как только первый пример использует
перезапуск с именем <b>new-function</b>.
<!--l. 4954--><p class="indent" >   Более полный пример: <div class="lisp"><tt><div class="tabbing">
(let ((my-food &#x2019;milk)
   <br>                                                          (my-color &#x2019;greenish-blue))<br>
  (do ()<br>                      ((not (bad-food-color-p my-food my-color)))<br>
    (restart-case (error &#x2019;bad-food-color<br>
                         :food my-food :color my-color)<br>
      (use-food (new-food)<br>
          :report &#x0022;Use another food.&#x0022;<br>         (setq my-food new-food))<br>
      (use-color (new-color)<br>                 :report &#x0022;Use another color.&#x0022;<br>
        (setq my-color new-color))))<br>
  ;; We won&#x2019;t get to here until MY-FOOD<br>
  ;; and MY-COLOR are compatible.<br>             (list my-food my-color))<br>
                                                                          

                                                                          
<!--l. 4971--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4972--><p class="indent" >   Предполагая, что <b>use-food</b> и <b>use-color</b> были определены так:
<div class="lisp"><tt><div class="tabbing">
(defun use-food (new-food)
   <br>                                               (invoke-restart &#x2019;use-food new-food))<br>
<br>                                               (defun use-color (new-color)<br>
  (invoke-restart &#x2019;use-color new-color))<br>
<!--l. 4979--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4980--><p class="indent" >   затем обработчик может исправить ошибку одним из способов. Может
исправить color или исправить food. Например: <div class="lisp"><tt><div class="tabbing">
#&#x2019;(lambda (c) ... (use-color &#x2019;white) ...)   ;Corrects <b>color</b>
   <br>                                                                                   <br>
#&#x2019;(lambda (c) ... (use-food &#x2019;cheese) ...)   ;Corrects <b>food</b><br>
<!--l. 4986--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4988--><p class="indent" >   Пример использования <b><a 
href="symbols.html#x188-380478r478">handler-bind</a></b> и <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>, который
ссылается на тип условия <b>foo-error</b>, который был определён ранее.
<div class="lisp"><tt><div class="tabbing">
(handler-bind ((foo-error #&#x2019;(lambda (ignore) (use-value 7))))
   <br>          (restart-case (error &#x2019;foo-error)<br>            (use-value (x) (* x x))))<br>
 <span class="math"> ⇒</span> 49<br>
<!--l. 4995--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 5000--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>restart-bind</b> <a 
 id="dx181-332003"></a>({(name function {keyword value}*)}*) {form}*
   <br>
<!--l. 5001--><p class="noindent" ></div>
</div>
<!--l. 5002--><p class="indent" >   Выполняет формы тела в динамическом контексте, в котором
установлены заданные перезапуски.
<!--l. 5005--><p class="indent" >   Любое имя перезапуска <em>name</em> может быть символом <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, указывая на
анонимный перезапуск, или любым другим символом, указывая на
именованный перезапуск.
<!--l. 5009--><p class="indent" >   Каждый аргумент <em>function</em> является формой, которая должна вернуть
функцию, которая будет использоваться для выполнения перезапуска.
Будучи вызванной, эта функция может либо выполнить нелокальную
передачу управления, либо нормально завершиться. Функция может
принимать столько аргументов, сколько программист сочтёт нужным
указать. Она будет вызвана, только если в программе используется
<b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b>, или если пользователь интерактивно указывает отладчику
запустить её. В случае интерактивного вызова, используется параметр
<b>:interactive-function</b>.
<!--l. 5018--><p class="indent" >   Возможные пары <em>keyword value</em> перечислены ниже: <div class="flushdesc">
      <ul><li><b>
<b>:test-function <em>form</em></b> </b></li>Форма <em>form</em> будет вычислена в текущем лексическом
      окружении и должна вернуть функцию одного аргумента: условия.
      Если при получении аргумента эта функция возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, такие
      функции как <b><a 
href="symbols.html#x188-380421r421">ﬁnd-restart</a></b>, <b>compute-restart</b> и <b><a 
href="symbols.html#x188-380510r510">invoke-restart</a></b> не
      рассматривают данный перезапуск, при поиске по заданному условию.
      Если эта пара не указана, то используется значение по-умолчанию
      <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
      #&#x2019;(lambda (c) (declare (ignore c)) t)
      <br>
      <!--l. 5030--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>:interactive-function <em>form</em></b> </b></li>
      <!--l. 5034--><p class="noindent" >Форма <em>form</em> будет вычислена в текущем лексическом окружении и
      должна возвращать функцию без аргументов, которая создаёт список
      аргументов для использования в <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b>,
      при запуске данного перезапуска. Если необходимо функция
      может интерактивно запрашивать значения с использованием
      <b><a 
href="symbols.html#x188-380048r48">*query-io*</a></b>.
      <li><b>
<b>:report-function <em>form</em></b> </b></li>
      <!--l. 5042--><p class="noindent" >Форма <em>form</em> будет вычислена в текущем лексическом окружении и
      должна возвращать функцию одного аргумента: потока, которая
      должна выводить в данный поток информацию о действиях данного
      перезапуска. Данная функция вызывается всякий раз при выводе
      перезапуска, при <b><a 
href="symbols.html#x188-380037r37">*print-escape*</a></b> равном <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.</ul>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 5050--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>with-condition-restarts</b> <a 
 id="dx181-332004"></a>condition-form restarts-form{declaration}* {form}*
   <br>
<!--l. 5052--><p class="noindent" ></div>
</div>
                                                                          

                                                                          
<!--l. 5053--><p class="indent" >   Значение <em>condition-form</em> должно быть условием <em>C</em> и значение <em>restarts-form</em>
должно быть списком перезапусков <b>(<em>R1</em> <em>R2</em> ...)</b>. Формы тела <em>form</em>
вычисляются как неявный <b><a 
href="symbols.html#x188-380761r761">progn</a></b>. Во время динамического контекста
тела попытка найти перезапуск, связанный с конкретным условием
<span class="math">C′</span>, будет рассматривать перезапуски <em>R1</em>, <em>R2</em>, <span class="math">…</span>, если <span class="math">C′</span> равен <b><a 
href="symbols.html#x188-380378r378">eq</a></b>
<em>С</em>.
<!--l. 5060--><p class="indent" >   Обычно этот макрос не используется в коде явно, потому что <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b>
предоставляет решение для наиболее частых задач, имея при этом более
краткий синтаксис.
<hr></div>
<!--l. 5065--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.8   </span> <a 
href="frontmatter.html#QQ2-181-377" id="x181-33300028.4.8">Поиск и управление перезапусками</a></h4>
<!--l. 5067--><p class="noindent" >Следующие функции определяют и вызывают активные перезапуски.
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-333001"></a>
<em>
<!--l. 5070--><p class="noindent" >[Функция]</em> <b>compute-restarts</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5072--><p class="indent" >   Использует динамическое состояние программы для вычисления списка
перезапусков, которые в данный момент активны.
<!--l. 5075--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<!--l. 5079--><p class="indent" >   Каждый перезапуск представляет функцию, которая может быть вызвана
для выполнения некоторых форм, исправляющих ситуацию, обычно
передавая управление во внешнюю точку в запущенной программе.
Реализации могут создавать эти объекты как им наиболее удобно.
Эти объекты нуждаются только в динамической продолжительности
видимости (относительно области формы связывания, которая их
создала).
<!--l. 5086--><p class="indent" >   Полученный от <b><a 
href="symbols.html#x188-380277r277">compute-restarts</a></b> список отсортирован так, что
внутренние (то есть, ранее установленные) перезапуски находятся ближе к
началу списка.
                                                                          

                                                                          
<!--l. 5089--><p class="indent" >   Также отмечается, что <b><a 
href="symbols.html#x188-380277r277">compute-restarts</a></b> возвращает все корректные
перезапуски, включая анонимные, даже если некоторые из них имеют
одинаковые имена и не могли бы быть найдены с помощью <b>ﬁnd-restarts</b>.
<!--l. 5093--><p class="indent" >   Реализация может, но не обязательно, в одинаковых окружениях
возвращать разные (то есть не равные <b><a 
href="symbols.html#x188-380378r378">eq</a></b>) списки для повторяющихся
вызовов <b><a 
href="symbols.html#x188-380277r277">compute-restarts</a></b>. Модификация списка, возвращённого функцией,
является ошибкой.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-333002"></a>
<em>
<!--l. 5101--><p class="noindent" >[Функция]</em> <b>restart-name</b> <i>restart</i>
</div>
<!--l. 5103--><p class="indent" >   Возвращает имя заданного перезапуска <em>restart</em> и <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, если у перезапуска
нет имени.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-333003"></a>
<em>
<!--l. 5108--><p class="noindent" >[Функция]</em> <b>ﬁnd-restart</b> <i>restart-identiﬁer</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5110--><p class="indent" >   Ищет конкретный перезапуск в текущем динамическом окружении.
<!--l. 5112--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<!--l. 5116--><p class="indent" >   Если аргумент <em>restart-identiﬁer</em> является не-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> символом, тогда
возвращается самый внутренний (то есть установленный наиболее поздно)
перезапуск с этим именем. Если перезапуск не был найден возвращается
<b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5120--><p class="indent" >   Если <em>restart-identiﬁer</em> является объектом перезапуска, тогда, если он
активен, то он и возвращается. Иначе возвращается <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
                                                                          

                                                                          
<!--l. 5123--><p class="indent" >   Несмотря на то, что анонимные перезапуски именуются символом
<b><a 
href="symbols.html#x188-380670r670">nil</a></b>, передача данного символа в аргументе <em>restart-identiﬁer</em> является
ошибкой. Приложения, которые так делают, должны быть переписаны с
использованием <b><a 
href="symbols.html#x188-380277r277">compute-restarts</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-333004"></a>
<em>
<!--l. 5130--><p class="noindent" >[Функция]</em> <b>invoke-restart</b> <i>restart-identiﬁer</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 5132--><p class="indent" >   Вызывает функцию связанную с заданным перезапуском <em>restart-identiﬁer</em>,
и передаёт в неё остальные аргументы <em>arguments</em>. Аргумент <em>restart-identiﬁer</em>
должен быть перезапуском или не-null именем перезапуска, который
доступен в данном динамическом контексте.
____________________________<div class="implementation">
<!--l. 5138--><p class="noindent" ><b>Заметка для реализации:</b> Функции перезапуска вызывают эту функцию, а не
наоборот.
</div>___________________________________________________________________________________________________________
<hr>
</div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-333005"></a>
<em>
<!--l. 5145--><p class="noindent" >[Функция]</em> <b>invoke-restart-interactively</b> <i>restart-identiﬁer</i>
</div>
<!--l. 5147--><p class="indent" >    Вызывает функцию, связанную с заданным идентификатором
перезапуска <em>restart-identiﬁer</em>, запрашивая при этом необходимые аргументы.
<em>restart-identiﬁer</em> должен быть перезапуском или не-null именем перезапуска,
доступное в текущем динамическом контексте. Если аргумент не корректен,
сигнализируется ошибка типа <b><a 
href="symbols.html#x188-380289r289">control-error</a></b>.
                                                                          

                                                                          
<!--l. 5153--><p class="indent" >   Функция <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> запрашивает аргументы с помощью
кода указанного в <b>:interactive</b> в <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b> или <b>:interactive-function</b> в
<b><a 
href="symbols.html#x188-380813r813">restart-bind</a></b>.
<!--l. 5157--><p class="indent" >   Если в соответствующей форме <b><a 
href="symbols.html#x188-380814r814">restart-case</a></b> или <b><a 
href="symbols.html#x188-380813r813">restart-bind</a></b> не были
указаны параметры <b>:interactive</b> или <b>:interactive-function</b>, тогда если
перезапуск требует обязательных аргументов, это является ошибкой. В
случае если все аргументы необязательные, будет использоваться пустой
список аргументов.
<!--l. 5162--><p class="indent" >   После того как <b><a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> получила аргумент,
она выполняет форму <b>(apply #&#x2019;invoke-restart <em>restart-identi er</em>
<em>arguments</em>)</b>.
<b>
<!--l. 5166--><p class="indent" >   <a 
href="symbols.html#x188-380511r511">invoke-restart-interactively</a></b> используется внутри отладчика и
может быть полезной при реализации других переносимых отладочных
инструментов.
<hr></div>
<!--l. 5170--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.9   </span> <a 
href="frontmatter.html#QQ2-181-378" id="x181-33400028.4.9">Предупреждения</a></h4>
<!--l. 5173--><p class="noindent" >Предупреждения являются подклассом ошибок, которые условно называются
«мягкими».
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-334001"></a>
<em>
<!--l. 5176--><p class="noindent" >[Функция]</em> <b>warn</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 5178--><p class="indent" >   Предупреждает о ситуации с помощью сигнализирования условия типа
<b><a 
href="symbols.html#x188-381008r1008">warning</a></b>.
<!--l. 5180--><p class="indent" >   Если <em>datum</em> является условием, тогда это условие и используется. В этом
случае, если условие не принадлежит типу <b><a 
href="symbols.html#x188-381008r1008">warning</a></b> или аргументы не равны
<b><a 
href="symbols.html#x188-380670r670">nil</a></b>, сигнализируется ошибка типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>.
<!--l. 5184--><p class="indent" >   Если <em>datum</em> является типом условия (классом или именем класса), тогда
условие создаётся с помощью формы <b>(apply #&#x2019;make-condition <em>datum</em>
<em>arguments</em>)</b>. Результат должен принадлежать типу <b><a 
href="symbols.html#x188-381008r1008">warning</a></b>, иначе будет
                                                                          

                                                                          
сигнализирована ошибка типа <b><a 
href="symbols.html#x188-380971r971">type-error</a></b>.
<!--l. 5189--><p class="indent" >   Если <em>datum</em> является строкой, тогда условие создаётся с помощью формы
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 5194--><p class="noindent" ></div>
</tt>
</div>
<!--l. 5195--><p class="indent" >   Точный механизм для предупреждения заключается в следующем.
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x181-334003x1">Сигнализируется предупреждение.
      <!--l. 5199--><p class="noindent" >В то время как сигнализируется условие <b><a 
href="symbols.html#x188-381008r1008">warning</a></b>, устанавливается
      <b><a 
href="symbols.html#x188-380654r654">muﬄe-warning</a></b>                                                        для
      использования обработчика для последующего перехвата <b><a 
href="symbols.html#x188-381007r1007">warn</a></b> (то
      есть, заставляя <b><a 
href="symbols.html#x188-381007r1007">warn</a></b> немедленно возвращать <b><a 
href="symbols.html#x188-380670r670">nil</a></b>)
      <!--l. 5203--><p class="noindent" >В  рамках  процесса  сигнализирования,  если  <b>(typep  <em>condition</em>
      *break-on-signals*)</b>   является   истиной,   тогда   <b><a 
href="symbols.html#x188-380168r168">break</a></b>   будет
      происходить до начала процесса сигнализирования.
      </li>
      <li 
  class="enumerate" id="x181-334005x2">Если                  для                  предупреждения                  не
      найдены обработчики, или если все обработчики неактивны, тогда
      условие выводится в <b><a 
href="symbols.html#x188-380023r23">*error-output*</a></b> с помощью функции <b><a 
href="symbols.html#x188-381007r1007">warn</a></b>.
      </li>
      <li 
  class="enumerate" id="x181-334007x3">Если <b><a 
href="symbols.html#x188-381007r1007">warn</a></b> по-обычному возвращает управление, то её значением
      является <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      </li></ol>
<hr>
</div>
                                                                          

                                                                          
<!--l. 5217--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.10   </span> <a 
href="frontmatter.html#QQ2-181-379" id="x181-33500028.4.10">Функции перезапусков</a></h4>
<!--l. 5219--><p class="noindent" >Common Lisp содержит следующие встроенные функции перезапусков.
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-335001"></a>
<em>
<!--l. 5222--><p class="noindent" >[Функция]</em> <b>abort</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5224--><p class="indent" >   Данная функция передаёт управление в перезапуск с именем <b><a 
href="symbols.html#x188-380081r81">abort</a></b>. Если
данного перезапуска нет, <b><a 
href="symbols.html#x188-380288r288">continue</a></b> возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5227--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-335002"></a>
<em>
<!--l. 5233--><p class="noindent" >[Функция]</em> <b>continue</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5235--><p class="indent" >   Данная функция передаёт управление в перезапуск с именем <b><a 
href="symbols.html#x188-380288r288">continue</a></b>.
Если данного перезапуска нет, <b><a 
href="symbols.html#x188-380288r288">continue</a></b> возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5238--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<!--l. 5242--><p class="indent" >   Перезапуск <b><a 
href="symbols.html#x188-380288r288">continue</a></b> является частью простого протокола, в котором
существует единственный «очевидный» способ продолжить выполнение
программы, как в <b><a 
href="symbols.html#x188-380168r168">break</a></b> и <b><a 
href="symbols.html#x188-380213r213">cerror</a></b>. Некоторые определённые пользователем
протокол по схожим причинам могут также хотеть включить его. В целом,
однако, более удобно определить свой специальный перезапуск с некоторым
именем, которое более подходит для данного приложения.
<hr></div>
<div class="defun">
                                                                          

                                                                          
<div class="defunheader">
<a 
 id="dx181-335003"></a>
<em>
<!--l. 5251--><p class="noindent" >[Функция]</em> <b>muﬄe-warning</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5253--><p class="indent" >   Данная функция передаёт управление (а также одно значение) в
перезапуск с именем <b><a 
href="symbols.html#x188-380654r654">muﬄe-warning</a></b>. Если данного перезапуска нет,
<b><a 
href="symbols.html#x188-380654r654">muﬄe-warning</a></b> сигнализирует ошибку <b><a 
href="symbols.html#x188-380289r289">control-error</a></b>.
<!--l. 5257--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<b>
<!--l. 5261--><p class="indent" >   <a 
href="symbols.html#x188-381007r1007">warn</a></b> устанавливает данный перезапуск, таким образом, что обработчики
условий <b><a 
href="symbols.html#x188-381008r1008">warning</a></b> могут сообщить функции <b><a 
href="symbols.html#x188-381007r1007">warn</a></b>, что <b><a 
href="symbols.html#x188-381008r1008">warning</a></b> уже быть
обработана, и что никакие дальнейшие действия не требуются.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-335004"></a>
<em>
<!--l. 5267--><p class="noindent" >[Функция]</em> <b>store-value</b> <i>value</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5269--><p class="indent" >   Данная функция передаёт управление (а также одно значение) в
перезапуск с именем <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>. Если данного перезапуска нет, <b><a 
href="symbols.html#x188-380902r902">store-value</a></b>
возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5273--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<!--l. 5277--><p class="indent" >   Перезапуск <b><a 
href="symbols.html#x188-380996r996">use-value</a></b> обычно используется обработчиками, которые
пытаются восстановить ситуацию из ошибок таких типов, как <b><a 
href="symbols.html#x188-380211r211">cell-error</a></b> или
<b><a 
href="symbols.html#x188-380971r971">type-error</a></b>, и обработчик может захотеть указать новое значение для <em>datum</em>
для постоянного использования.
<hr></div>
<div class="defun">
<div class="defunheader">
                                                                          

                                                                          
<a 
 id="dx181-335005"></a>
<em>
<!--l. 5284--><p class="noindent" >[Функция]</em> <b>use-value</b> <i>value</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 5286--><p class="indent" >   Данная функция передаёт управление (а также одно значение) в
перезапуск с именем <b><a 
href="symbols.html#x188-380996r996">use-value</a></b>. Если такого перезапуска нет, <b><a 
href="symbols.html#x188-380996r996">use-value</a></b>
возвращает <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5290--><p class="indent" >   Если аргумент <em>condition</em> не указан или равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются только
внешние перезапуски. Если аргумент <em>condition</em> не равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, рассматриваются
только перезапуски связанные с данным условием.
<!--l. 5294--><p class="indent" >   Перезапуск <b><a 
href="symbols.html#x188-380996r996">use-value</a></b> обычно используется обработчиками, которые
пытаются восстановить ситуацию из ошибок таких типов, как <b><a 
href="symbols.html#x188-380211r211">cell-error</a></b>, и
обработчик может захотеть указать новое значение для <em>datum</em> для
использования единожды.
<hr></div>
<!--l. 5300--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">28.4.11   </span> <a 
href="frontmatter.html#QQ2-181-380" id="x181-33600028.4.11">Отладочные утилиты</a></h4>
<!--l. 5303--><p class="noindent" >Common Lisp явно не указывает, что из себя представляет отладчик и что он
должен делать, но содержит необходимые вещи, которые передачи
выполнения в и из супервизор(а) и отладчик(а).
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-336001"></a>
<em>
<!--l. 5308--><p class="noindent" >[Функция]</em> <b>break</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>format-string</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>format-arguments</i>
</div>
<!--l. 5310--><p class="indent" >   Функция <b><a 
href="symbols.html#x188-380168r168">break</a></b> выводит сообщение с помощью форматирующей строки и
аргументов: <em>format-string</em> и <em>format-arguments</em>, и затем без возможности
обработать ошибку вызывает отладчик.
<!--l. 5314--><p class="indent" >   Если <em>format-string</em> не указана, будет использована строка по-умолчанию.
<!--l. 5316--><p class="indent" >   Если выполнение продолжится, <b><a 
href="symbols.html#x188-380168r168">break</a></b> вернёт <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<!--l. 5318--><p class="indent" >   Следует отметить, что <b><a 
href="symbols.html#x188-380168r168">break</a></b> предполагается как метод для вставки в
программу временных отладочных «точек останова», а не как способ
                                                                          

                                                                          
сигнализирования ошибок. Предполагается, что в результате продолжения
выполнения из <b><a 
href="symbols.html#x188-380168r168">break</a></b>, каких-либо необычных восстановительных действий не
будет. Поэтому, <b><a 
href="symbols.html#x188-380168r168">break</a></b> не принимает дополнительную форматирующую
строку, как это делает <b><a 
href="symbols.html#x188-380213r213">cerror</a></b> в первом аргументе.
<!--l. 5325--><p class="indent" >   Это и отсутствие возможности перехвата запрограммированных
обработчиков ошибок являются единственных видимым для программы
различием между <b><a 
href="symbols.html#x188-380168r168">break</a></b> и <b><a 
href="symbols.html#x188-380213r213">cerror</a></b>. Аспекты пользовательского интерфейса
данных функций могут отличаться более широко, например, допустимо с
помощью <b><a 
href="symbols.html#x188-380168r168">break</a></b>, а не с помощью обычного отладчика, попасть в цикл
чтение-выполнение-вывод (read-eval-print loop, REPL).
<b>
<!--l. 5332--><p class="indent" >   <a 
href="symbols.html#x188-380168r168">break</a></b> может быть определена как <div class="lisp"><tt><div class="tabbing">
(defun break (&#x0026;optional (format-string &#x0022;Break&#x0022;)
   <br>                                                      &#x0026;rest format-arguments)<br>
  (with-simple-restart (continue &#x0022;Return from BREAK.&#x0022;)<br>
    (invoke-debugger<br>                   (make-condition &#x2019;simple-condition<br>
                      :format-string format-string<br>
                      :format-arguments format-arguments)))<br>      nil)<br>
<!--l. 5342--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-336002"></a>
<em>
<!--l. 5346--><p class="noindent" >[Функция]</em> <b>invoke-debugger</b> <i>condition</i>
</div>
<!--l. 5348--><p class="indent" >   Функция делает попытку обработать условие, которое должно быть
передано в аргументе.
<!--l. 5350--><p class="indent" >   Если переменная <b><a 
href="symbols.html#x188-380021r21">*debugger-hook*</a></b> не равна <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, то она будет вызвана с
двумя аргументами: объектом условия условия <em>condition</em> и значением
                                                                          

                                                                          
<b><a 
href="symbols.html#x188-380021r21">*debugger-hook*</a></b>. Если функция-ловушка по-обычному вернула управление,
тогда запускается стандартный отладчик.
<!--l. 5355--><p class="indent" >   Стандартный отладчик никогда не возвращает управление по-обычному.
Возврат осуществляется только с помощью специальной передачи
управления, как например, перезапуск.
__________________________________
<!--l. 5360--><p class="noindent" ><b>Примечание:</b> The exact way in which the debugger interacts with users is expected to
vary considerably from system to system. For example, some systems may use a
keyboard interface, while others may use a mouse interface. Of those systems using
keyboard commands, some may use single-character commands and others may
use parsed line-at-a-time commands. The exact set of commands will vary as
well. The important properties of a debugger are that it makes information
about the error accessible and that it makes the set of apparent restarts easily
accessible.
<!--l. 5370--><p class="indent" >     It is desirable to have a mode where the debugger allows other features,
such as the ability to inspect data, stacks, etc. However, it may sometimes be
appropriate to have this kind of information hidden from users. Experience
on the Lisp Machines has shown that some users who are not programmers
develop a terrible phobia of debuggers. The reason for this usually may be
traced to the fact that the debugger is very foreign to them and provides an
overwhelming amount of information of interest only to programmers. With the
advent of restarts, there is a clear mechanism for the construction of “friendly”
debuggers. Programmers can be taught how to get to the information they need for
debugging, but it should be possible to construct user interfaces to the debugger that
are natural, convenient, intelligible, and friendly even to non-programmers.________
<hr>
</div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx181-336003"></a>
<em>
<!--l. 5387--><p class="noindent" >[Переменная]</em> <b>*debugger-hook*</b>
</div>
<!--l. 5389--><p class="indent" >    Данная переменная должна содержать или <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, или функцию двух
аргументов, в которых будет передаваться: условие и значение
                                                                          

                                                                          
<b><a 
href="symbols.html#x188-380021r21">*debugger-hook*</a></b>. Данная функция может либо обработать условие (с
помощью передачи управления) или по-обычному завершится (вернуть
управление, тем самым позволяя запустить стандартный отладчик).
<!--l. 5395--><p class="indent" >   Следует отметить, что для уменьшения ошибок рекурсии при отладке,
при вызове функции <b><a 
href="symbols.html#x188-380021r21">*debugger-hook*</a></b> связывается со значением <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. Когда
вычисляемый код вводится пользователем интерактивно, функция-ловушка
может захотеть связать <b><a 
href="symbols.html#x188-380021r21">*debugger-hook*</a></b> с функцией, которая была во
втором аргументе, так что ошибки рекурсии могут быть обработаны с
помощью того же интерактивного функционала.
<hr></div>
                                                                          

                                                                          
<!--l. 5402--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse149.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse147.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse147.html#tailclmse147.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse148.html" >В-начало</a>&#x003E;&#x003C;<a 
href="condition.html#clmse148.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse148.html"></a>
 
</body></html> 
