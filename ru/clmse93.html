<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Информация о массиве</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-01-10 13:49:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse94.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse92.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse92.html#tailclmse92.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse93.html">В-конец</a>&#x003E;&#x003C;<a 
href="array.html#clmse93.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">17.3
</span> <a 
href="clm.html#QQ2-115-186" id="x115-15500017.3">Информация о массиве</a></h3>
<!--l. 1302--><p class="noindent" >Следующие функции извлекают интересную информацию, и это не элементы
массива.
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155001"></a>
<em>
<!--l. 1306--><p class="noindent" >[Функция]</em> <b>array-element-type</b> <i>array</i>
</div>
<b>
<!--l. 1308--><p class="indent" >   <a 
href="symbols.html#x188-380114r114">array-element-type</a></b> возвращает спецификатор типа для множества
объектов, которые могут быть сохранены в массиве <em>array</em>. Это множество
может быть больше чем то, которое запрашивалось в функции <b><a 
href="symbols.html#x188-380588r588">make-array</a></b>.
Например, результат <div class="lisp"><tt><div class="tabbing">
(array-element-type (make-array 5 :element-type &#x2019;(mod 5)))
   <br>
<!--l. 1314--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1315--><p class="indent" >   может быть <b>(mod 5)</b>, <b>(mod 8)</b>, <b>ﬁxnum</b>, <b><a 
href="symbols.html#x188-380951r951">t</a></b> или любой другой тип, для
которого <b>(mod 5)</b> является подтипом. Смотрите <b><a 
href="symbols.html#x188-380938r938">subtypep</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155002"></a>
                                                                          

                                                                          
<em>
<!--l. 1320--><p class="noindent" >[Функция]</em> <b>array-rank</b> <i>array</i>
</div>
<!--l. 1322--><p class="indent" >   Эта функция возвращает количество измерений (осей) массива <em>array</em>.
Результат будет неотрицательным целым. Смотрите <b><a 
href="symbols.html#x188-380118r118">array-rank-limit</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155003"></a>
<em>
<!--l. 1328--><p class="noindent" >[Функция]</em> <b>array-dimension</b> <i>array</i> <i>axis-number</i>
</div>
<!--l. 1330--><p class="indent" >   Данная функция возвращает размер измерения <em>axis-number</em> массива <em>array</em>.
<em>array</em> может быть любым видом массива, и <em>axis-number</em> должен быть
неотрицательным целым меньшим чем ранг массива <em>array</em>. Если <em>array</em>
является вектором с указателем заполнения, <b><a 
href="symbols.html#x188-380110r110">array-dimension</a></b> возвращает
общий размер вектора, включая неактивные элементы, а не размер
ограниченный указателем заполнения. (Функция <b><a 
href="symbols.html#x188-380542r542">length</a></b> будет возвращать
размер ограниченный указателем заполнения.)
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155004"></a>
<em>
<!--l. 1342--><p class="noindent" >[Функция]</em> <b>array-dimensions</b> <i>array</i>
</div>
<b>
<!--l. 1344--><p class="indent" >   <a 
href="symbols.html#x188-380112r112">array-dimensions</a></b> возвращает список, элементы которого являются
размерами измерений массива <em>array</em>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155005"></a>
                                                                          

                                                                          
<em>
<!--l. 1349--><p class="noindent" >[Функция]</em> <b>array-total-size</b> <i>array</i>
</div>
<b>
<!--l. 1351--><p class="indent" >   <a 
href="symbols.html#x188-380120r120">array-total-size</a></b> возвращает общее количество элементов массива
<em>array</em>, которое вычислено как произведение размеров всех измерений.
<div class="lisp"><tt><div class="tabbing">
(array-total-size <em>x</em>)
   <br>                                             <span class="math"> ≡</span> (apply #&#x2019;* (array-dimensions <em>x</em>))<br>
   <span class="math"> ≡</span> (reduce #&#x2019;* (array-dimensions <em>x</em>))<br>
<!--l. 1357--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1358--><p class="indent" >   Следует отметить, что общий размер нульмерного (FIXME) массива равен
<b>1</b>. Общий размер одномерного массива вычисляется без учёта указателя
заполнения.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155006"></a>
<em>
<!--l. 1363--><p class="noindent" >[Функция]</em> <b>array-in-bounds-p</b> <i>array</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>subscripts</i>
</div>
<!--l. 1365--><p class="indent" >   Данный предикат проверяет, являются ли индексы <em>subscripts</em> для массива
<em>array</em> корректными. Если они корректны, предикат истинен, иначе ложен.
<em>subscripts</em> должен быть целыми числами. Количество индексов <em>subscripts</em>
должно равняться рангу массива. Как и <b><a 
href="symbols.html#x188-380105r105">aref</a></b>, <b><a 
href="symbols.html#x188-380116r116">array-in-bounds-p</a></b> игнорирует
указатели заполнения.
<hr></div>
<div class="defun">
<div class="defunheader">
                                                                          

                                                                          
<a 
 id="dx115-155007"></a>
<em>
<!--l. 1374--><p class="noindent" >[Функция]</em> <b>array-row-major-index</b> <i>array</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>subscripts</i>
</div>
<!--l. 1376--><p class="indent" >   Данная функция принимает массив и корректные для него индексы и
возвращает одиночное неотрицательное целое значение меньшее чем
общий размер массива, которое идентифицирует элемент, полагаясь на
построчный порядок хранения элементов. Количество указанных индексов
<em>subscripts</em> должно равняться рангу массива. Каждый индекс должен быть
неотрицательным целым числом меньшим чем соответствующий размер
измерения. Как и <b><a 
href="symbols.html#x188-380105r105">aref</a></b>, <b><a 
href="symbols.html#x188-380119r119">array-row-major-index</a></b> игнорирует указатели
заполнения.
<!--l. 1385--><p class="indent" >   Возможно определение <b><a 
href="symbols.html#x188-380119r119">array-row-major-index</a></b>, без проверки на ошибки,
может выглядеть так: <div class="lisp"><tt><div class="tabbing">
(defun array-row-major-index (a <b>&#x0026;rest</b> subscripts)
   <br>                                            (apply #&#x2019;+ (maplist #&#x2019;(lambda (x y)<br>
                          (* (car x) (apply #&#x2019;* (cdr y))))<br>
                      subscripts<br>
                      (array-dimensions a))))<br>
<!--l. 1393--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1394--><p class="indent" >   Для одномерного массива, результат <b><a 
href="symbols.html#x188-380119r119">array-row-major-index</a></b> всегда
равен переданному индексу.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155008"></a>
<em>
<!--l. 1399--><p class="noindent" >[Функция]</em> <b>row-major-aref</b> <i>array</i> <i>index</i>
</div>
<!--l. 1401--><p class="indent" >   Данная функция позволяет получить доступ к элементу, как если бы
                                                                          

                                                                          
массив был одномерный. Аргумент <em>index</em> должен быть неотрицательным
целым меньшим чем общий размер массива <em>array</em>. Данная функция
индексирует массив, как если бы он был одномерный с построчным
порядком. Эту функцию можно понять в терминах <b><a 
href="symbols.html#x188-380105r105">aref</a></b>: <div class="lisp"><tt><div class="tabbing">
(row-major-aref <em>array</em> <em>index</em>) <span class="math"> ≡</span>
   <br>                  (aref (make-array (array-total-size array))<br>
                    :displaced-to array<br>
                    :element-type (array-element-type array))<br>
        index)<br>
<!--l. 1413--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1414--><p class="indent" >   Другими словами, можно обработать массив как одномерный с помощью
создания нового одномерного массива, который <em>соединён</em> с исходным, и
получить доступ к новому массиву. И наоборот, <b><a 
href="symbols.html#x188-380105r105">aref</a></b> может быть описана в
терминах <b><a 
href="symbols.html#x188-380823r823">row-major-aref</a></b>: <div class="lisp"><tt><div class="tabbing">
(aref <em>array</em> <span class="math"><em>i</em><sub>0</sub></span> <span class="math"><em>i</em><sub>1</sub></span> ... <span class="math"><em>i</em><sub>n−1</sub></span>) <span class="math"> ≡</span>
   <br>                             (row-major-aref array<br>
                  (array-row-major-index array <span class="math"><em>i</em><sub>0</sub></span> <span class="math"><em>i</em><sub>1</sub></span> ... <span class="math"><em>i</em><sub>n−1</sub></span>)<br>
<!--l. 1422--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1424--><p class="indent" >   Как и <b><a 
href="symbols.html#x188-380105r105">aref</a></b>, <b><a 
href="symbols.html#x188-380823r823">row-major-aref</a></b> полностью игнорирует указатели
заполнения. Для изменения элемента массива, можно комбинировать вызов
<b><a 
href="symbols.html#x188-380823r823">row-major-aref</a></b> с формой <b><a 
href="symbols.html#x188-380844r844">setf</a></b>.
<!--l. 1429--><p class="indent" >   Эта операция облегчает написание кода, который обрабатывает массивы
различных рангов. Предположим, что необходимо обнулить содержимое
массива <b>tennis-scores</b>. Можно решить это так: <div class="lisp"><tt><div class="tabbing">
(ﬁll (make-array (array-total-size tennis-scores)
                                                                          

                                                                          
   <br>                     :element-type (array-element-type tennis-scores)<br>
                  :displaced-to tennis-scores)<br>                        0)<br>
<!--l. 1437--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1438--><p class="indent" >   К сожалению, так как <b><a 
href="symbols.html#x188-380409r409">ﬁll</a></b> не может принимать многомерные массивы, в
данном примере создаётся <em>соединённый</em> массив, что является лишней
операцией. Другим способом является отдельная обработка каждого
измерения многомерного массива: <div class="lisp"><tt><div class="tabbing">
(ecase (array-rank tennis-scores)
   <br>                                                      (0 (setf (aref tennis-scores) 0))<br>
  (1 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (setf (aref tennis-scores i0) 0)))<br>  (2 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (setf (aref tennis-scores i0 i1) 0))))<br>                            ...<br>
  (7 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (dotimes (i2 (array-dimension tennis-scores 1))<br>
           (dotimes (i3 (array-dimension tennis-scores 1))<br>
             (dotimes (i4 (array-dimension tennis-scores 1))<br>
               (dotimes (i5 (array-dimension tennis-scores 1))<br>
                 (dotimes (i6 (array-dimension tennis-scores 1))<br>
                   (setf (aref tennis-scores i0 i1 i2 i3 i4 i5 i6)<br>
                         0)))))))))<br>                                   )<br>
<!--l. 1461--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1462--><p class="indent" >   От такого кода быстро приходит усталость. Кроме того, данный подход
не желателен, так как некоторые реализации Common Lisp&#x2019;а будут
фактически поддерживать не более 7 измерений. Рекурсивно вложенные
циклы справляются с задачей лучше, но код всё ещё выглядит как лапша:
<div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(labels
   <br>                                                     ((grok-any-rank (&#x0026;rest indices)<br>
     (let ((d (- (array-rank tennis-scores) (length indices)))<br>
       (if (= d 0)<br>              (setf (apply #&#x2019;row-major-aref indices) 0)<br>
           (dotimes (i (array-dimension tennis-scores (- d 1)))<br>
             (apply #&#x2019;grok-any-rank i indices))))))<br>     (grok-any-rank))<br>
<!--l. 1475--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1476--><p class="indent" >   Является ли этот код эффективным зависит от многих параметров
реализации, таких как способ обработки <b>&#x0026;rest</b> аргументов и компиляции
<b><a 
href="symbols.html#x188-380101r101">apply</a></b> вызовов. Только посмотрите как просто использовать для задачи
<b><a 
href="symbols.html#x188-380823r823">row-major-aref</a></b>! <div class="lisp"><tt><div class="tabbing">
(dotimes (i (array-total-size tennis-scores))
   <br>                                         (setf (row-major-aref tennis-scores i) 0))<br>
<!--l. 1482--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1483--><p class="indent" >   Нет сомнения, что этот код, слаще любых медовых сот.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155009"></a>
<em>
<!--l. 1487--><p class="noindent" >[Функция]</em> <b>adjustable-array-p</b> <i>array</i>
</div>
<!--l. 1489--><p class="indent" >   Если аргумент, который должен быть массивом, может быть расширен,
данный предикат истинен, иначе ложен.
<div class="newer">
<!--l. 1493--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx115-155010"></a>to clarify that <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> is true of
an array if and only if <b><a 
href="symbols.html#x188-380092r92">adjust-array</a></b>, when applied to that array, will
return the same array, that is, an array <b><a 
href="symbols.html#x188-380378r378">eq</a></b> to the original array. If the
                                                                          

                                                                          
<b>:adjustable</b> argument to <b><a 
href="symbols.html#x188-380588r588">make-array</a></b> is non-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> when an array is created, then
<b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> must be true of that array. If an array is created with the
<b>:adjustable</b> argument <b><a 
href="symbols.html#x188-380670r670">nil</a></b> (or omitted), then <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> may
be true or false of that array, depending on the implementation. X3J13
further voted to <em>deﬁne</em> the terminology “adjustable array” to mean precisely
“an array of which <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> is true.” See <b><a 
href="symbols.html#x188-380588r588">make-array</a></b> and
<b><a 
href="symbols.html#x188-380092r92">adjust-array</a></b>.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx115-155011"></a>
<em>
<!--l. 1512--><p class="noindent" >[Функция]</em> <b>array-displacement</b> <i>array</i>
</div>
<!--l. 1514--><p class="indent" >   функция возвращает два значение. Первое значение является массивом
соединенным с данным, и второе значение обозначает смещение соединения.
Если массив не был соединен ни с одним массивом возвращаются значения
<b><a 
href="symbols.html#x188-380670r670">nil</a></b> и <b>0</b>.
<hr></div>
                                                                          

                                                                          
<!--l. 1519--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse94.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse92.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse92.html#tailclmse92.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse93.html" >В-начало</a>&#x003E;&#x003C;<a 
href="array.html#clmse93.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse93.html"></a>
 
</body></html> 
