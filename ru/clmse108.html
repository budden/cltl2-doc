<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-01-10 13:49:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="stream.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse107.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse107.html#tailclmse107.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse108.html">В-конец</a>&#x003E;&#x003C;<a 
href="eval.html#clmse108.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">20.2
</span> <a 
href="clm.html#QQ2-133-207" id="x133-17600020.2">Цикл взаимодействия с пользователем</a></h3>
<!--l. 597--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<b><a 
href="symbols.html#x188-380778r778">read</a></b>-<b><a 
href="symbols.html#x188-380385r385">eval</a></b>-<b><a 
href="symbols.html#x188-380750r750">print</a></b> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 602--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 608--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 613--><p class="indent" >   Для удобства работы, например в случае, если пользователь забыл
сохранить интересное введённое выражение или выведенное значение
<!--l. 616--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем,. (Следует отметить, что имена некоторых этих переменных
нарушают нотацию глобальных переменных в использовании звёздочек в
начале и конце имени.) Эти переменные в основном используются для
взаимодействия с пользователем, поэтому имеют короткие имена.
Использование этих переменных в программах следует избегать.
<div class="defun">
<div class="defunheader">
<a 
 id="dx133-176001"></a>
<em>
<!--l. 623--><p class="noindent" >[Переменная]</em> <b>+</b><br />
<a 
 id="dx133-176002"></a>
<em>
                                                                          

                                                                          
[Переменная]</em> <b>++</b><br />
<a 
 id="dx133-176003"></a>
<em>
[Переменная]</em> <b>+++</b>
</div>
<!--l. 627--><p class="indent" >   Когда форма вычисляется в цикле взаимодействия, переменная <b><a 
href="symbols.html#x188-380060r60">+</a></b>
связывается с предыдущим прочитанным выражением. Переменная <b><a 
href="symbols.html#x188-380061r61">++</a></b>
хранит предыдущее относительно значения <b><a 
href="symbols.html#x188-380060r60">+</a></b> (то есть, форма вычисленная
два шага назад), и <b><a 
href="symbols.html#x188-380062r62">+++</a></b> хранит предыдущее значение относительно
<b><a 
href="symbols.html#x188-380061r61">++</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx133-176004"></a>
<em>
<!--l. 635--><p class="noindent" >[Переменная]</em> <b>-</b>
</div>
<!--l. 637--><p class="indent" >   Когда формы выполняется в цикле взаимодействия, переменная <b><a 
href="symbols.html#x188-380064r64">-</a></b> связана
с этой формой. Это значение, которое получит переменная <b><a 
href="symbols.html#x188-380060r60">+</a></b> на следующей
итерации цикла.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx133-176005"></a>
<em>
<!--l. 643--><p class="noindent" >[Переменная]</em> <b>*</b><br />
<a 
 id="dx133-176006"></a>
<em>
[Переменная]</em> <b>**</b><br />
<a 
 id="dx133-176007"></a>
<em>
[Переменная]</em> <b>***</b>
</div>
<!--l. 647--><p class="indent" >   Во время вычисления формы в цикле взаимодействия, переменная <b><a 
href="symbols.html#x188-380011r11">*</a></b>
                                                                          

                                                                          
связана с результатом выполнения предыдущей формы, то есть значения
формы, которая хранится в <b><a 
href="symbols.html#x188-380060r60">+</a></b>. Если результат той формы содержал
несколько значений, в <b><a 
href="symbols.html#x188-380011r11">*</a></b> будет только первое. Если было возвращено ноль
значений, <b><a 
href="symbols.html#x188-380011r11">*</a></b> будет содержать <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. Переменная <b><a 
href="symbols.html#x188-380012r12">**</a></b> хранит предыдущее
значение относительно <b><a 
href="symbols.html#x188-380011r11">*</a></b>. То есть, результат вычисления формы из <b><a 
href="symbols.html#x188-380012r12">**</a></b>. <b><a 
href="symbols.html#x188-380013r13">***</a></b>
хранит предыдущее значение относительно <b><a 
href="symbols.html#x188-380013r13">***</a></b>.
<!--l. 656--><p class="indent" >   Если выполнение <b><a 
href="symbols.html#x188-380060r60">+</a></b> было по каким-то причинам прервано, тогда значения
<b><a 
href="symbols.html#x188-380011r11">*</a></b>, <b><a 
href="symbols.html#x188-380012r12">**</a></b> и <b><a 
href="symbols.html#x188-380013r13">***</a></b> не меняются. Они изменяются, если вывод значений как
минимум начался (необязательно, чтобы он закончился).
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx133-176008"></a>
<em>
<!--l. 663--><p class="noindent" >[Переменная]</em> <b>/</b><br />
<a 
 id="dx133-176009"></a>
<em>
[Переменная]</em> <b>//</b><br />
<a 
 id="dx133-176010"></a>
<em>
[Переменная]</em> <b>///</b>
</div>
<!--l. 667--><p class="indent" >   Во время вычисления формы в цикле взаимодействия, переменная <b><a 
href="symbols.html#x188-380065r65">/</a></b>
связана со списком результатов выведенных на предыдущей итерации. То
есть это список всех значений выполнения формы <b><a 
href="symbols.html#x188-380060r60">+</a></b>. Значение <b><a 
href="symbols.html#x188-380011r11">*</a></b> должно
всегда совпадать со значением <em>car</em> элемента значения <b><a 
href="symbols.html#x188-380065r65">/</a></b>. Переменная <b><a 
href="symbols.html#x188-380066r66">//</a></b>
хранит предыдущий список значений относительно <b><a 
href="symbols.html#x188-380065r65">/</a></b> (то есть, результат
вычисленный две итерации назад), и <b><a 
href="symbols.html#x188-380067r67">///</a></b> содержит предыдущий список
значений относительно <b><a 
href="symbols.html#x188-380067r67">///</a></b>. Таким образом, значение <b><a 
href="symbols.html#x188-380012r12">**</a></b> должно всегда
совпадать со значением <em>car</em> элемента списка <b><a 
href="symbols.html#x188-380066r66">//</a></b>, а <b><a 
href="symbols.html#x188-380013r13">***</a></b> с с <em>car</em> элементом
<b><a 
href="symbols.html#x188-380067r67">///</a></b>.
<!--l. 678--><p class="indent" >   Если выполнение <b><a 
href="symbols.html#x188-380060r60">+</a></b> было по каким-то причинам прервано, тогда значения
<b><a 
href="symbols.html#x188-380065r65">/</a></b>, <b><a 
href="symbols.html#x188-380066r66">//</a></b> и <b><a 
href="symbols.html#x188-380067r67">///</a></b> не меняются. Они изменяются, если вывод значений как
минимум начался (необязательно, чтобы он закончился).
<hr></div>
<!--l. 684--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
                                                                          

                                                                          
возможную работу с системой, где <b><a 
href="symbols.html#x188-380076r76">&#x003E;</a></b> приглашение ввода: <div class="lisp"><tt><div class="tabbing">
&#x003E;(cons - -)                      ;Итерация 1
   <br>                                       ((CONS - -) CONS - -)      ;Очаровашка?<br>
<br>                                  &#x003E;(values)                        ;Итерация 2<br>
                                ;Ничего не выводится<br>
&#x003E;(cons &#x2019;a &#x2019;b)                    ;Итерация 3<br>
(A . B)                           ;Это одно значение<br>
<br>                                  &#x003E;(hairy-loop)̂G               ;Итерация 4<br>
### QUIT to top level.    ;(Пользователь прервал вычисления.)<br>
<br>                                  &#x003E;(ﬂoor 13 4)                    ;Итерация 5<br>
3                                   ;Вернулось два значения<br>                    1<br>
<!--l. 702--><p class="noindent" ></div>
</tt>
</div>
<!--l. 703--><p class="indent" >   В этой точке мы имеем: <div class="lisp"><tt><div class="tabbing">
<!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
   <br>
<!--l. 710--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 645--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="stream.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse107.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse107.html#tailclmse107.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse108.html" >В-начало</a>&#x003E;&#x003C;<a 
href="eval.html#clmse108.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse108.html"></a>
 
</body></html> 
