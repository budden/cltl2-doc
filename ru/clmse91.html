<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Создание массива</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-01-10 13:49:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse92.html" >Далее</a>&#x003E;&#x003C;<a 
href="array.html" >Назад</a>&#x003E;&#x003C;<a 
href="array.html#tailarray.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse91.html">В-конец</a>&#x003E;&#x003C;<a 
href="array.html#clmse91.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">17.1
</span> <a 
href="clm.html#QQ2-113-184" id="x113-15300017.1">Создание массива</a></h3>
<!--l. 994--><p class="noindent" >Не волнуйтесь о большом количестве опций для функции <b><a 
href="symbols.html#x188-380588r588">make-array</a></b>. Все
что действительно необходимо, это список размерностей. Остальные же
опции служат для относительно эзотерических программ.
<div class="defun">
<div class="defunheader">
<a 
 id="dx113-153001"></a>
<em>
<!--l. 999--><p class="noindent" >[Функция]</em> <b>make-array</b> <i>dimensions</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:element-type</i> <i>:initial-element</i>
<i>:initial-contents</i> <i>:adjustable</i> <i>:ﬁll-pointer</i> <i>:displaced-to</i> <i>:displaced-index-oﬀset</i>
                                                                          

                                                                          
</div>
<!--l. 1001--><p class="indent" >   Это базовая функция для создания массивов. Аргумент <em>dimensions</em>
должен быть списком неотрицательных целых чисел, которые являются
измерениями массива. Длина списка является размерностью массива.
Каждое измерение должно быть меньше чем <b><a 
href="symbols.html#x188-380111r111">array-dimension-limit</a></b>, и
произведение всех измерений должно быть меньше <b><a 
href="symbols.html#x188-380121r121">array-total-size-limit</a></b>.
Следует отметить, что если <em>dimensions</em> <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, тогда создаётся массив с нулевым
количеством измерений. По соглашению, при создании одномерного массива,
размер измерений может быть указан как одиночное целое число, а не список
целых чисел.
<!--l. 1011--><p class="indent" >   Реализация Common Lisp&#x2019;а может иметь ограничение на ранг массива, но
это ограничение должно быть меньше 7. Таким образом, любая Common Lisp
программа может использовать массивы с рангом меньшим или равным
7.
<!--l. 1015--><p class="indent" >   Для <b><a 
href="symbols.html#x188-380588r588">make-array</a></b> существуют следующие именованные параметры:
<div class="flushdesc">
      <ul><li><b>
<b>:element-type</b> </b></li>Этот  аргумент  должен  быть  именем  типа  элементов
      массива. Массив создаётся с наиболее близким типом к указанному,
      и  не  может  содержать  объекты  отличные  от  этого  типа.  Тип  <b><a 
href="symbols.html#x188-380951r951">t</a></b>
      указывает на создание общего массива, элементы которого могут
      быть любыми объектами. <b><a 
href="symbols.html#x188-380951r951">t</a></b> является значением по-умолчанию.
<div class="new">
      <!--l. 1027--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx113-153002"></a>to change <b><a 
href="symbols.html#x188-380976r976">typep</a></b> and <b><a 
href="symbols.html#x188-380938r938">subtypep</a></b> so that the
      specialized <b>array</b> type speciﬁer means the same thing for discrimination
      purposes as for declaration purposes: it encompasses those arrays that can
      result by specifying <em>element-type</em> as the element type to the function
      <b><a 
href="symbols.html#x188-380588r588">make-array</a></b>. Therefore we may say that if <em>type</em> is the <b>:element-type</b>
      argument, then the result will be an array of type <b>(array <em>type</em>)</b>; put
      another way, for any type <em>A</em>, <div class="lisp"><tt><div class="tabbing">
      (typep (make-array ... :element-type &#x2019;<em>A</em> ...)
      <br>                                                                        &#x2019;(array <em>A</em>)))<br>
                                                                          

                                                                          
      <!--l. 1041--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 1042--><p class="noindent" >is always true. See <b><a 
href="symbols.html#x188-380992r992">upgraded-array-element-type</a></b>.
      </div>
      <li><b>
<b>:initial-element</b> </b></li>Этот аргумент может использоваться для инициализации
      каждого элемента массива. Значение должно принадлежать типу
      указанному в аргументе <b>:element-type</b>. Если <b>:initial-element</b> опущен,
      тогда значение по-умолчанию для элементов массива не определено
      (если только не используется <b>:initial-contents</b> или <b>:displaced-to</b>).
      Опция <b>:initial-element</b> может не использоваться, когда указана опция
      <b>:initial-contents</b> или <b>:displaced-to</b>.
      <li><b>
<b>:initial-contents</b> </b></li>Этот аргумент может использоваться для инициализации
      содержимого массива. Значением параметра является структура
      вложенных последовательностей. Если массив с нулевым количеством
      измерений, тогда значение задаёт одиночный элемент. В противном
      случае, значение должно быть последовательностью с длинной, равной
      размеру первого измерения. Каждый вложенный элемент также должен
      быть последовательностью, размером равным следующему измерению
      массива. Например: <div class="lisp"><tt><div class="tabbing">
      (make-array &#x2019;(4 2 3)
      <br>                                                                 :initial-contents<br>
                       &#x2019;(((a b c) (1 2 3))<br>
                         ((d e f) (3 1 2))<br>
                         ((g h i) (2 3 1))<br>
                         ((j k l) (0 0 0))))<br>
      <!--l. 1071--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
      <!--l. 1072--><p class="noindent" >Количество уровней в структуре должно равняться рангу массива.
      Каждый лист вложенной структуры должен иметь тип, указанный в
      опции <b>:type</b>. Если опция <b>:initial-contents</b> опущена, первоначальное
      значение элементов массива не определено (если только не используется
      опция <b>:initial-element</b> или <b>:displaced-to</b>). Опция <b>:initial-contents</b>
      может не использоваться, когда указана опция <b>:initial-element</b> или
      <b>:displaced-to</b>.
      <li><b>
<b>:adjustable</b> </b></li>Если данный аргумент указан и не является <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, тогда размер
      массива после создания может быть изменён. По-умолчанию параметр
      равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
<div class="newer">
      <!--l. 1085--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx113-153003"></a>to clarify that if this argument is non-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> then
      the predicate <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> will necessarily be true when
      applied to the resulting array; but if this argument is <b><a 
href="symbols.html#x188-380670r670">nil</a></b> (or omitted)
      then the resulting array may or may not be adjustable, depending
      on the implementation, and therefore <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> may
      be correspondingly true or false of the resulting array. Common
      Lisp provides no portable way to create a non-adjustable array,
      that is, an array for which <b><a 
href="symbols.html#x188-380093r93">adjustable-array-p</a></b> is guaranteed to be
      false.
      </div>
      <li><b>
<b>:ﬁll-pointer</b> </b></li>Данный аргумент указывает, что массив должен иметь
      указатель заполнения. Если эта опция указана и не является <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, тогда
      массив должен быть одномерным. Значение используется для
      инициализации указателя заполнения массива. Если указано
      значение <b><a 
href="symbols.html#x188-380951r951">t</a></b>, тогда используется длина массива. Иначе, значение
      должно быть целым числом между нулём (включительно) и
      длинной массива (включительно)ю Аргумент по-умолчанию равен
      <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      <li><b>
<b>:displaced-to</b> </b></li>Если данный аргумент указан и не является <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, то он
      указывает на то, что массив будет <em>соединён</em> с другим массивом.
      Значение аргумента должно быть уже созданным массивом.
                                                                          

                                                                          
      <b><a 
href="symbols.html#x188-380588r588">make-array</a></b> создаст <em>косвенный</em> или <em>разделяемый</em> массив, который имеет
      общее содержимое с указанным массивом. В таком случае опция
      <b>:displaced-index-oﬀset</b> позволяет указать смещение общей части
      массивов. Если массив, переданный в аргумент <b>:displaced-to</b>, не имеет
      такого же типа элементов (<b>:element-type</b>), как и создаваемый массив,
      то генерируется ошибка. Опция <b>:displaced-to</b> не может использоваться
      вместе с опцией <b>:initial-element</b> или <b>:initial-contents</b>. По-умолчанию
      аргумент равен <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      <li><b>
<b>:displaced-index-oﬀset</b> </b></li>Данный аргумент может использоваться только в
      сочетании с опцией <b>:displaced-to</b>. Она должна быть неотрицательным
      целым (по-умолчанию равна нулю). Она означает смещение
      создаваемого <em>разделяемого</em> массива относительно исходного.
      <!--l. 1127--><p class="noindent" >Если при создании массива B массив A передан в качестве аргумента
      <b>:displaced-to</b> в функцию <b><a 
href="symbols.html#x188-380588r588">make-array</a></b>, тогда массив B называется
      <em>соединённым</em> с массивом A. Полное количество элементов массива,
      называемое <em>полный размер</em> массива, вычисляется как произведение
      размеров всех измерений (смотрите <b><a 
href="symbols.html#x188-380120r120">array-total-size</a></b>). Необходимо,
      чтобы полный размер массива A был не меньше чем сумма <em>полного
      размера</em> массива B и смещения <em>n</em>, указанного в аргументе
      <b>:displaced-index-oﬀset</b>. Смысл соединения массивов в том, что массив
      B не имеет своих элементов и операции над ним приводят в
      действительности к операциям над массивом A. При отображении
      элементов массивов, последние рассматриваются как одномерные, с
      построчным порядком размещения элементов. Так, элемент с индексом
      <em>k</em> массива <em>B</em> отображается в элемент с индексом <em>k</em>+<em>n</em> массива
      <em>A</em>.</ul>
</div>
<!--l. 1143--><p class="indent" >   Если <b><a 
href="symbols.html#x188-380588r588">make-array</a></b> вызывается без указания аргументов <b>:adjustable</b>,
<b>:ﬁll-pointer</b> и <b>:displaced-to</b>, или указания их в <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, тогда получаемый
массив гарантированного будет <em>простым</em> (смотрите раздел <a 
href="clmse7.html#x14-270002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>).
<div class="newer">
<!--l. 1149--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx113-153004"></a>to clarify that if one or more of the <b>:adjustable</b>,
<b>:ﬁll-pointer</b>, and <b>:displaced-to</b> arguments is true, then whether the resulting
array is simple is unspeciﬁed.
</div>
                                                                          

                                                                          
<!--l. 1156--><p class="indent" >   Вот несколько примеров использования <b><a 
href="symbols.html#x188-380588r588">make-array</a></b>: <div class="lisp"><tt><div class="tabbing">
;;; Создание одномерного массива с пятью элементами.
   <br>                                      (make-array 5)<br>                                      <br>
;;; Создание двумерного массива, 3 на 4, с четырёхбитными элементами.<br>
(make-array &#x2019;(3 4) <b>:element-type</b> &#x2019;(mod 16))<br>                             <br>
;;; Создание массива чисел с плавающей точкой.<br>
(make-array 5 <b>:element-type</b> &#x2019;single-ﬂoat))<br>                               <br>
;;; Создание соединённого массива.<br>           (setq a (make-array &#x2019;(4 3)))<br>
(setq b (make-array 8 :displaced-to a<br>                      :displaced-index-oﬀset 2))<br>
;;; В таком случае:<br>                             (aref b 0) <span class="math"> ≡</span> (aref a 0 2)<br>
        (aref b 1) <span class="math"> ≡</span> (aref a 1 0)<br>              (aref b 2) <span class="math"> ≡</span> (aref a 1 1)<br>
        (aref b 3) <span class="math"> ≡</span> (aref a 1 2)<br>              (aref b 4) <span class="math"> ≡</span> (aref a 2 0)<br>
        (aref b 5) <span class="math"> ≡</span> (aref a 2 1)<br>              (aref b 6) <span class="math"> ≡</span> (aref a 2 2)<br>
        (aref b 7) <span class="math"> ≡</span> (aref a 3 0)<br>
<!--l. 1180--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1181--><p class="indent" >   Последний пример связи между массивами зависит от того факта, что
элементы массивов хранятся построчно. Другими словами, индексы элментов
массива упорядочены лексикографически.
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx113-153005"></a>
<em>
<!--l. 1187--><p class="noindent" >[Константа]</em> <b>array-rank-limit</b>
</div>
<!--l. 1189--><p class="indent" >   Значение <b><a 
href="symbols.html#x188-380118r118">array-rank-limit</a></b> является положительным целым, которое
обозначает (невключительно) наивысший возможный ранг массива. Это
значение зависит от реализации, но не может быть меньше 8. Таком образом
каждая реализация Common Lisp&#x2019;а поддерживает массивы, ранг которых
лежит между 0 и 7 (включительно). (Разработчикам предлагается сделать
это значение большим настолько, на сколько это возможно без ущерба в
                                                                          

                                                                          
производительности.)
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx113-153006"></a>
<em>
<!--l. 1199--><p class="noindent" >[Константа]</em> <b>array-dimension-limit</b>
</div>
<!--l. 1201--><p class="indent" >   Значение <b><a 
href="symbols.html#x188-380111r111">array-dimension-limit</a></b> является положительным целым,
которое обозначает (невключительно) наивысший возможный размер
измерения для массива. Это значение зависит от реализации, но не
может быть меньше 1024. (Разработчикам предлагается сделать это
значение большим настолько, на сколько это возможно без ущерба в
производительности.)
<div class="new">
<!--l. 1208--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-153007"></a>to specify that the value of <b>array-dimension-limit</b>
must be of type <b>ﬁxnum</b>. This in turn implies that all valid array indices will be
ﬁxnums.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
<a 
 id="dx113-153008"></a>
<em>
<!--l. 1217--><p class="noindent" >[Константа]</em> <b>array-total-size-limit</b>
</div>
<!--l. 1219--><p class="indent" >   Значение <b><a 
href="symbols.html#x188-380121r121">array-total-size-limit</a></b> является положительным целым, которое
обозначает (невключительно) наивысшее возможное количество элементов в
массиве. Это значение зависит от реализации, но не может быть меньше 1024.
(Разработчикам предлагается сделать это значение большим настолько, на
сколько это возможно без ущерба в производительности.)
<!--l. 1225--><p class="indent" >   На практике предельный размер массива может зависеть от типа
элемента массива, в таком случае <b><a 
href="symbols.html#x188-380121r121">array-total-size-limit</a></b> будет наименьшим
из ряда этих размеров.
<hr></div>
                                                                          

                                                                          
<div class="defun">
<div class="defunheader">
<a 
 id="dx113-153009"></a>
<em>
<!--l. 1230--><p class="noindent" >[Функция]</em> <b>vector</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>objects</i>
</div>
<!--l. 1232--><p class="indent" >   Функция <b><a 
href="symbols.html#x188-381002r1002">vector</a></b> служит для создания простых базовых векторов с
заданным содержимым. Она является аналогом для функции <b><a 
href="symbols.html#x188-380547r547">list</a></b>.
<div class="lisp"><tt><div class="tabbing">
(vector <span class="math"><em>a</em><sub>1</sub></span> <span class="math"><em>a</em><sub>2</sub></span> ... <span class="math"><em>a</em><sub>n</sub></span>)
   <br>                                          <span class="math"> ≡</span> (make-array (list <span class="math"><em>n</em></span>) :element-type t<br>
             :initial-contents (list <span class="math"><em>a</em><sub>1</sub></span> <span class="math"><em>a</em><sub>2</sub></span> ... <span class="math"><em>a</em><sub>n</sub></span>))<br>
<!--l. 1239--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
                                                                          

                                                                          
<!--l. 1242--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse92.html" >Далее</a>&#x003E;&#x003C;<a 
href="array.html" >Назад</a>&#x003E;&#x003C;<a 
href="array.html#tailarray.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse91.html" >В-начало</a>&#x003E;&#x003C;<a 
href="array.html#clmse91.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse91.html"></a>
 
</body></html> 
