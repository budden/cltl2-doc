<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Programmer Interface Concepts</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2013-01-10 13:48:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; <br> &#x003C;<a 
href="clmse144.html" >Next</a>&#x003E;&#x003C;<a 
href="clos.html" >Prev</a>&#x003E;&#x003C;<a 
href="clos.html#tailclos.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="#tailclmse143.html">Tail</a>&#x003E;&#x003C;<a 
href="clos.html#clmse143.html" >Up</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">27.1   </span> <a 
href="clm.html#QQ2-175-293" id="x175-25200027.1">Programmer Interface
Concepts</a></h3>
<!--l. 62--><p class="noindent" >The Common Lisp Object System (CLOS) is an object-oriented extension to
Common Lisp. It is based on generic functions, multiple inheritance, declarative
method combination, and a meta-object protocol.
<!--l. 66--><p class="indent" >   The ﬁrst two parts of this speciﬁcation describe the standard Programmer
Interface for the Common Lisp Object System. The ﬁrst part, Programmer
Interface Concepts, contains a description of the concepts of the Common Lisp
Object System, and the second part, Functions in the Programmer Interface,
contains a description of the functions and macros in the Common Lisp Object
System Programmer Interface. The third part, The Common Lisp Object
System Meta-Object Protocol, explains how the Common Lisp Object
System can be customized.
<!--l. 75--><p class="indent" >   The fundamental objects of the Common Lisp Object System are classes,
instances, generic functions, and methods.
<!--l. 78--><p class="indent" >   A <em>class</em> object determines the structure and behavior of a set of other objects,
which are called its <em>instances</em>. Every Common Lisp object is an <em>instance</em> of a
class. The class of an object determines the set of operations that can be
performed on the object.
<!--l. 83--><p class="indent" >   A <em>generic function</em> is a function whose behavior depends on the classes or
identities of the arguments supplied to it. A generic function object contains a set
of methods, a lambda-list, a method combination type, and other information.
The <em>methods</em> deﬁne the class-speciﬁc behavior and operations of the generic
function; a method is said to <em>specialize</em> a generic function. When invoked, a
generic function executes a subset of its methods based on the classes of its
arguments.
<!--l. 92--><p class="indent" >   A generic function can be used in the same ways as an ordinary function in
Common Lisp; in particular, a generic function can be used as an argument to
<b><a 
href="symbols.html#x188-380444r444">funcall</a></b> and <b><a 
href="symbols.html#x188-380101r101">apply</a></b> and can be given a global name.
<!--l. 97--><p class="indent" >   A <em>method</em> is an object that contains a method function, a sequence of
<em>parameter specializers</em> that specify when the given method is applicable, and a
sequence of <em>qualiﬁers</em> that is used by the <em>method combination</em> facility to
distinguish among methods. Each required formal parameter of each method has
an associated parameter specializer, and the method will be invoked only on
arguments that satisfy its parameter specializers.
<!--l. 105--><p class="indent" >   The method combination facility controls the selection of methods, the
order in which they are run, and the values that are returned by the
                                                                          

                                                                          
generic function. The Common Lisp Object System oﬀers a default method
combination type and provides a facility for declaring new types of method
combination.
<!--l. 110--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.1   </span> <a 
href="frontmatter.html#QQ2-175-294" id="x175-25300027.1.1">Error Terminology</a></h4>
<!--l. 116--><p class="noindent" >A situation is the evaluation of an expression in some speciﬁc context. For
example, a situation might be the invocation of a function on arguments that fail
to satisfy some speciﬁed constraints.
<!--l. 121--><p class="indent" >   In the speciﬁcation of the Common Lisp Object System, the behavior of
programs in all situations is described, and the options available to the
implementor are deﬁned. No implementation is allowed to extend the syntax
or semantics of the Object System except as explicitly deﬁned in the
Object System speciﬁcation. In particular, no implementation is allowed to
extend the syntax of the Object System in such a way that ambiguity
between the speciﬁed syntax of the Object System and those extensions is
possible.
<div class="flushdesc">
      <ul><li><b>
“When situation <em>S</em> occurs, an error is signaled.” </b></li>
      <!--l. 132--><p class="noindent" >This terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">If this situation occurs, an error will be signaled in the interpreter
           and in code compiled under all compiler safety optimization levels.
           </li>
           <li class="itemize">Valid programs may rely on the fact that an error will be signaled
           in the interpreter and in code compiled under all compiler safety
           optimization levels.
           </li>
           <li class="itemize">Every  implementation  is  required  to  detect  such  an  error  in
           the interpreter and in code compiled under all compiler safety
           optimization levels.
                                                                          

                                                                          
           </li></ul>
      <li><b>
“When situation <em>S</em> occurs, an error should be signaled.” </b></li>
      <!--l. 152--><p class="noindent" >This terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">If this situation occurs, an error will be signaled at least in the
           interpreter and in code compiled under the safest compiler safety
           optimization level.
           </li>
           <li class="itemize">Valid programs may not rely on the fact that an error will be
           signaled.
           </li>
           <li class="itemize">Every implementation is required to detect such an error at least
           in the interpreter and in code compiled under the safest compiler
           safety optimization level.
           </li>
           <li class="itemize">When  an  error  is  not  signaled,  the  results  are  undeﬁned  (see
           below).
           </li></ul>
      <li><b>
“When situation <em>S</em> occurs, the results are undeﬁned.” </b></li>
      <!--l. 174--><p class="noindent" >This terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">If this situation occurs, the results are unpredictable. The results
           may range from harmless to fatal.
           </li>
           <li class="itemize">Implementations are allowed to detect this situation and signal an
           error, but no implementation is required to detect the situation.
                                                                          

                                                                          
           </li>
           <li class="itemize">No valid program may depend on the eﬀects of this situation, and
           all valid programs are required to treat the eﬀects of this situation
           as unpredictable.
           </li></ul>
      <li><b>
“When situation <em>S</em> occurs, the results are unspeciﬁed.” </b></li>
      <!--l. 193--><p class="noindent" >This terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">The eﬀects of this situation are not speciﬁed in the Object System,
           but the eﬀects are harmless.
           </li>
           <li class="itemize">Implementations are allowed to specify the eﬀects of this situation.
           </li>
           <li class="itemize">No portable program can depend on the eﬀects of this situation,
           and all portable programs are required to treat the situation as
           unpredictable but harmless.
           </li></ul>
      <li><b>
“The Common Lisp Object System may be extended to cover situation <em>S</em>.” </b></li>
      <!--l. 211--><p class="noindent" >The meaning of this terminology is that an implementation is free to treat
      situation <em>S</em> in one of three ways:
           <ul class="itemize1">
           <li class="itemize">When  situation  <em>S</em> occurs,  an  error  is  signaled  at  least  in  the
           interpreter and in code compiled under the safest compiler safety
           optimization level.
           </li>
           <li class="itemize">When situation <em>S</em> occurs, the results are undeﬁned.
           </li>
           <li class="itemize">When situation <em>S</em> occurs, the results are deﬁned and speciﬁed.
           </li></ul>
                                                                          

                                                                          
      <!--l. 228--><p class="noindent" >In addition, this terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">No portable program can depend on the eﬀects of this situation,
           and all portable programs are required to treat the situation as
           undeﬁned.
           </li></ul>
      <li><b>
“Implementations are free to extend the syntax <em>S</em>.” </b></li>
      <!--l. 242--><p class="noindent" >This terminology has the following meaning:
           <ul class="itemize1">
           <li class="itemize">Implementations are allowed to deﬁne unambiguous extensions to
           syntax <em>S</em>.
           </li>
           <li class="itemize">No  portable  program  can  depend  on  this  extension,  and  all
           portable programs are required to treat the syntax as meaningless.
           </li></ul>
      </ul>
</div>
<!--l. 256--><p class="indent" >   The Common Lisp Object System speciﬁcation may disallow certain
extensions while allowing others.
<!--l. 258--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.2   </span> <a 
href="frontmatter.html#QQ2-175-295" id="x175-25400027.1.2">Classes</a></h4>
<!--l. 261--><p class="noindent" >A <em>class</em> is an object that determines the structure and behavior of a set of other
objects, which are called its <em>instances</em>.
<!--l. 264--><p class="indent" >   A class can inherit structure and behavior from other classes. A class whose
deﬁnition refers to other classes for the purpose of inheriting from them is said to
be a <em>subclass</em> of each of those classes. The classes that are designated
for purposes of inheritance are said to be <em>superclasses</em> of the inheriting
class.
                                                                          

                                                                          
<!--l. 271--><p class="indent" >   A class can have a <em>name</em>. The function <b><a 
href="symbols.html#x188-380244r244">class-name</a></b> takes a class object and
returns its name. The name of an anonymous class is <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. A symbol can <em>name</em> a
class. The function <b><a 
href="symbols.html#x188-380415r415">ﬁnd-class</a></b> takes a symbol and returns the class that the
symbol names. A class has a <em>proper name</em> if the name is a symbol and if the name
of the class names that class. That is, a class <em>C</em> has the <em>proper name</em> <em>S</em> if <em>S</em> =
<b>(class-name <em>C</em>)</b> and <em>C</em> = <b>(ﬁnd-class <em>S</em>)</b>. Notice that it is possible for
<b>(ﬁnd-class <span class="math">S<sub>1</sub></span>)</b> = <b>(ﬁnd-class <span class="math">S<sub>2</sub></span>)</b> and <span class="math">S<sub>1</sub>≠S<sub>2</sub></span>. If <em>C</em> = <b>(ﬁnd-class <em>S</em>)</b>, we say
that <em>C</em> is the <em>class named</em> <em>S</em>.
<!--l. 284--><p class="indent" >   A class <span class="math">C<sub>1</sub></span> is a <em>direct superclass</em> of a class <span class="math">C<sub>2</sub></span> if <span class="math">C<sub>2</sub></span> explicitly designates <span class="math">C<sub>1</sub></span> as
a superclass in its deﬁnition. In this case, <span class="math">C<sub>2</sub></span> is a <em>direct subclass</em> of <span class="math">C<sub>1</sub></span>. A class <span class="math">C<sub>n</sub></span>
is a <em>superclass</em> of a class <span class="math">C<sub>1</sub></span> if there exists a series of classes <span class="math">C<sub>2</sub>,…,C<sub>n−1</sub></span> such that
<span class="math">C<sub>i+1</sub></span> is a direct superclass of <span class="math">C<sub>i</sub></span> for <span class="math">1 ≤<em>i</em> &#x003C; <em>n</em></span>. In this case, <span class="math">C<sub>1</sub></span> is a <em>subclass</em> of <span class="math">C<sub>n</sub></span>.
A class is considered neither a superclass nor a subclass of itself. That is, if
<span class="math">C<sub>1</sub></span> is a superclass of <span class="math">C<sub>2</sub></span>, then <span class="math">C<sub>1</sub>≠C<sub>2</sub></span>. The set of classes consisting of
some given class <em>C</em> along with all of its superclasses is called “<em>C</em> and its
superclasses.”
<!--l. 299--><p class="indent" >   Each class has a <em>class precedence list</em>, which is a total ordering on the set of
the given class and its superclasses. The total ordering is expressed as a list
ordered from most speciﬁc to least speciﬁc. The class precedence list is used in
several ways. In general, more speciﬁc classes can <em>shadow</em>, or override, features
that would otherwise be inherited from less speciﬁc classes. The method selection
and combination process uses the class precedence list to order methods from
most speciﬁc to least speciﬁc.
<!--l. 308--><p class="indent" >   When a class is deﬁned, the order in which its direct superclasses are
mentioned in the deﬁning form is important. Each class has a <em>local precedence
order</em>, which is a list consisting of the class followed by its direct superclasses in
the order mentioned in the deﬁning form.
<!--l. 314--><p class="indent" >   A class precedence list is always consistent with the local precedence order of
each class in the list. The classes in each local precedence order appear within the
class precedence list in the same order. If the local precedence orders are
inconsistent with each other, no class precedence list can be constructed, and an
error is signaled. The class precedence list and its computation is discussed in
section <a 
href="#x175-26500027.1.5">27.1.5<!--tex4ht:ref: Determining-the-Class-Precedence-List-SECTION --></a>.
<!--l. 322--><p class="indent" >   Classes are organized into a <em>directed acyclic graph</em>. There are two
distinguished classes, named <b><a 
href="symbols.html#x188-380953r953">t</a></b> and <b>standard-object</b>. The class named <b><a 
href="symbols.html#x188-380953r953">t</a></b> has no
superclasses. It is a superclass of every class except itself. The class named
<b>standard-object</b> is an instance of the class <b>standard-class</b> and is a
superclass of every class that is an instance of <b>standard-class</b> except
                                                                          

                                                                          
itself.
<!--l. 329--><p class="indent" >   There is a mapping from the Common Lisp Object System class space into the
Common Lisp type space. Many of the standard Common Lisp types have a
corresponding class that has the same name as the type. Some Common Lisp
types do not have a corresponding class. The integration of the type and class
systems is discussed in section <a 
href="#x175-26400027.1.4">27.1.4<!--tex4ht:ref: Integrating-Types-and-Classes-SECTION --></a>.
<!--l. 336--><p class="indent" >   Classes are represented by objects that are themselves instances of classes. The
class of the class of an object is termed the <em>metaclass</em> of that object. When no
misinterpretation is possible, the term <em>metaclass</em> will be used to refer to a class
that has instances that are themselves classes. The metaclass determines the form
of inheritance used by the classes that are its instances and the representation of
the instances of those classes. The Common Lisp Object System provides a
default metaclass, <b>standard-class</b>, that is appropriate for most programs. The
meta-object protocol provides mechanisms for deﬁning and using new
metaclasses.
<!--l. 347--><p class="indent" >   Except where otherwise speciﬁed, all classes mentioned in this chapter are
instances of the class <b>standard-class</b>, all generic functions are instances of the
class <b>standard-generic-function</b>, and all methods are instances of the class
<b>standard-method</b>.
<!--l. 352--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-25500027.1.2" id="x175-25500027.1.2">Deﬁning Classes</a></h5>
<!--l. 354--><p class="noindent" >The macro <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> is used to deﬁne a new named class. The deﬁnition of a class
includes the following:
      <ul class="itemize1">
      <li class="itemize">The name of the new class. For newly deﬁned classes this is a proper
      name.
      </li>
      <li class="itemize">The list of the direct superclasses of the new class.
      </li>
      <li class="itemize">A set of <em>slot speciﬁers</em>. Each slot speciﬁer includes the name of the
      slot and zero or more <em>slot options</em>. A slot option pertains only to a
      single slot. If a class deﬁnition contains two slot speciﬁers with the same
      name, an error is signaled.
                                                                          

                                                                          
      </li>
      <li class="itemize">A set of <em>class options</em>. Each class option pertains to the class as a whole.</li></ul>
<!--l. 373--><p class="indent" >   The slot options and class options of the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form provide mechanisms
for the following:
      <ul class="itemize1">
      <li class="itemize">Supplying a default initial value form for a given slot.
      </li>
      <li class="itemize">Requesting  that  methods  for  generic  functions  be  automatically
      generated for reading or writing slots.
      </li>
      <li class="itemize">Controlling whether a given slot is shared by instances of the class or
      whether each instance of the class has its own slot.
      </li>
      <li class="itemize">Supplying a set of initialization arguments and initialization argument
      defaults to be used in instance creation.
      </li>
      <li class="itemize">Indicating that the metaclass is to be other than the default.
      </li>
      <li class="itemize">Indicating the expected type for the value stored in the slot.
      </li>
      <li class="itemize">Indicating the documentation string for the slot.</li></ul>
<!--l. 398--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-25600027.1.2" id="x175-25600027.1.2">Creating Instances of Classes</a></h5>
<!--l. 400--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> creates and returns a new instance of a
class. The Object System provides several mechanisms for specifying how a new
instance is to be initialized. For example, it is possible to specify the initial values
for slots in newly created instances either by giving arguments to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>
or by providing default initial values.
                                                                          

                                                                          
<!--l. 407--><p class="indent" >   Further initialization activities can be performed by methods written for
generic functions that are part of the initialization protocol. The complete
initialization protocol is described in section <a 
href="#x175-28300027.1.9">27.1.9<!--tex4ht:ref: Object-Creation-and-Initialization-SECTION --></a>.
<!--l. 413--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-25700027.1.2" id="x175-25700027.1.2">Slots</a></h5>
<!--l. 415--><p class="noindent" >An object that has <b>standard-class</b> as its metaclass has zero or more named slots.
The slots of an object are determined by the class of the object. Each slot can
hold one value. The name of a slot is a symbol that is syntactically valid for use as
a variable name.
<!--l. 421--><p class="indent" >   When a slot does not have a value, the slot is said to be <em>unbound</em>.
When an unbound slot is read, the generic function <b><a 
href="symbols.html#x188-380887r887">slot-unbound</a></b> is
invoked. The system-supplied primary method for <b><a 
href="symbols.html#x188-380887r887">slot-unbound</a></b> signals an
error.
<!--l. 425--><p class="indent" >   The default initial value form for a slot is deﬁned by the <b>:initform</b> slot option.
When the <b>:initform</b> form is used to supply a value, it is evaluated in the lexical
environment in which the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form was evaluated. The <b>:initform</b> along with
the lexical environment in which the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form was evaluated is called a
<em>captured</em> <b>:initform</b>. See section <a 
href="#x175-28300027.1.9">27.1.9<!--tex4ht:ref: Object-Creation-and-Initialization-SECTION --></a>.
<!--l. 433--><p class="indent" >   A <em>local slot</em> is deﬁned to be a slot that is visible to exactly one instance,
namely the one in which the slot is allocated. A <em>shared slot</em> is deﬁned to be
a slot that is visible to more than one instance of a given class and its
subclasses.
<!--l. 438--><p class="indent" >   A class is said to <em>deﬁne</em> a slot with a given name when the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form for
that class contains a slot speciﬁer with that name. Deﬁning a local slot does not
immediately create a slot; it causes a slot to be created each time an
instance of the class is created. Deﬁning a shared slot immediately creates a
slot.
<!--l. 444--><p class="indent" >   The <b>:allocation</b> slot option to <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> controls the kind of slot that is
deﬁned. If the value of the <b>:allocation</b> slot option is <b>:instance</b>, a local slot is
created. If the value of <b>:allocation</b> is <b>:class</b>, a shared slot is created.
<!--l. 449--><p class="indent" >   A slot is said to be <em>accessible</em> in an instance of a class if the slot is deﬁned by
the class of the instance or is inherited from a superclass of that class. At most
one slot of a given name can be accessible in an instance. A shared slot deﬁned by
a class is accessible in all instances of that class. A detailed explanation of the
inheritance of slots is given in section <a 
href="#x175-26100027.1.3">27.1.3<!--tex4ht:ref: Inheritance-of-Slots-and-Slot-Options-SECTION --></a>.
                                                                          

                                                                          
<!--l. 457--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-25800027.1.2" id="x175-25800027.1.2">Accessing Slots</a></h5>
<!--l. 459--><p class="noindent" >Slots can be accessed in two ways: by use of the primitive function <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> and
by use of generic functions generated by the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form.
<!--l. 463--><p class="indent" >   The function <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> can be used with any slot name speciﬁed in the
<b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form to access a speciﬁc slot accessible in an instance of the given
class.
<!--l. 467--><p class="indent" >   The macro <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> provides syntax for generating methods to read and write
slots. If a <em>reader</em> is requested, a method is automatically generated for reading the
value of the slot, but no method for storing a value into it is generated. If a <em>writer</em>
is requested, a method is automatically generated for storing a value into the slot,
but no method for reading its value is generated. If an <em>accessor</em> is requested, a
method for reading the value of the slot and a method for storing a value into the
slot are automatically generated. Reader and writer methods are implemented
using <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b>.
<!--l. 478--><p class="indent" >   When a reader or writer is speciﬁed for a slot, the name of the generic
function to which the generated method belongs is directly speciﬁed. If the
name speciﬁed for the writer option is the symbol <em>name</em>, the name of the
generic function for writing the slot is the symbol <em>name</em>, and the generic
function takes two arguments: the new value and the instance, in that order.
If the name speciﬁed for the accessor option is the symbol <em>name</em>, the
name of the generic function for reading the slot is the symbol <em>name</em>,
and the name of the generic function for writing the slot is the list <b>(setf
<em>name</em>)</b>.
<!--l. 489--><p class="indent" >   A generic function created or modiﬁed by supplying reader, writer,
or accessor slot options can be treated exactly as an ordinary generic
function.
<!--l. 493--><p class="indent" >   Note that <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> can be used to read or write the value of a slot whether
or not reader or writer methods exist for that slot. When <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> is used, no
reader or writer methods are invoked.
<!--l. 498--><p class="indent" >   The macro <b><a 
href="symbols.html#x188-381025r1025">with-slots</a></b> can be used to establish a lexical environment in
which speciﬁed slots are lexically available as if they were variables. The
macro <b><a 
href="symbols.html#x188-381025r1025">with-slots</a></b> invokes the function <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> to access the speciﬁed
slots.
<!--l. 503--><p class="indent" >   The macro <b><a 
href="symbols.html#x188-381015r1015">with-accessors</a></b> can be used to establish a lexical environment in
                                                                          

                                                                          
which speciﬁed slots are lexically available through their accessors as if they were
variables. The macro <b><a 
href="symbols.html#x188-381015r1015">with-accessors</a></b> invokes the appropriate accessors to access
the speciﬁed slots. Any accessors speciﬁed by <b><a 
href="symbols.html#x188-381015r1015">with-accessors</a></b> must already have
been deﬁned before they are used.
<!--l. 510--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.3   </span> <a 
href="frontmatter.html#QQ2-175-300" id="x175-25900027.1.3">Inheritance</a></h4>
<!--l. 513--><p class="noindent" >A class can inherit methods, slots, and some <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> options from its
superclasses. The following sections describe the inheritance of methods, the
inheritance of slots and slot options, and the inheritance of class options.
<!--l. 518--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26000027.1.3" id="x175-26000027.1.3">Inheritance of Methods</a></h5>
<!--l. 521--><p class="noindent" >A subclass inherits methods in the sense that any method applicable to all
instances of a class is also applicable to all instances of any subclass of that
class.
<!--l. 525--><p class="indent" >   The inheritance of methods acts the same way regardless of whether the
method was created by using one of the method-deﬁning forms or by
using one of the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> options that causes methods to be generated
automatically.
<!--l. 530--><p class="indent" >   The inheritance of methods is described in detail in section <a 
href="#x175-27400027.1.7">27.1.7<!--tex4ht:ref: Method-Selection-and-Combination-SECTION --></a>.
<!--l. 533--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26100027.1.3" id="x175-26100027.1.3">Inheritance of Slots and Slot Options</a></h5>
<!--l. 536--><p class="noindent" >The set of names of all slots accessible in an instance of a class <em>C</em> is the
union of the sets of names of slots deﬁned by <em>C</em> and its superclasses.
The <em>structure</em> of an instance is the set of names of local slots in that
instance.
<!--l. 541--><p class="indent" >   In the simplest case, only one class among <em>C</em> and its superclasses deﬁnes a slot
with a given slot name. If a slot is deﬁned by a superclass of <em>C</em>, the slot is said to
be <em>inherited</em>. The characteristics of the slot are determined by the slot speciﬁer of
the deﬁning class. Consider the deﬁning class for a slot <em>S</em>. If the value of
the <b>:allocation</b> slot option is <b>:instance</b>, then <em>S</em> is a local slot and each
instance of <em>C</em> has its own slot named <em>S</em> that stores its own value. If the
                                                                          

                                                                          
value of the <b>:allocation</b> slot option is <b>:class</b>, then <em>S</em> is a shared slot, the
class that deﬁned <em>S</em> stores the value, and all instances of <em>C</em> can access
that single slot. If the <b>:allocation</b> slot option is omitted, <b>:instance</b> is
used.
<!--l. 554--><p class="indent" >   In general, more than one class among <em>C</em> and its superclasses can
deﬁne a slot with a given name. In such cases, only one slot with the
given name is accessible in an instance of <em>C</em>, and the characteristics of
that slot are a combination of the several slot speciﬁers, computed as
follows:
      <ul class="itemize1">
      <li class="itemize">All the slot speciﬁers for a given slot name are ordered from most
      speciﬁc to least speciﬁc, according to the order in <em>C</em>&#x2019;s class precedence
      list of the classes that deﬁne them. All references to the speciﬁcity of
      slot speciﬁers immediately following refer to this ordering.
      </li>
      <li class="itemize">The allocation of a slot is controlled by the most speciﬁc slot speciﬁer.
      If the most speciﬁc slot speciﬁer does not contain an <b>:allocation</b> slot
      option, <b>:instance</b> is used. Less speciﬁc slot speciﬁers do not aﬀect the
      allocation.
      </li>
      <li class="itemize">The default initial value form for a slot is the value of the <b>:initform</b>
      slot option in the most speciﬁc slot speciﬁer that contains one. If no
      slot speciﬁer contains an <b>:initform</b> slot option, the slot has no default
      initial value form.
      </li>
      <li class="itemize">The contents of a slot will always be of type <b>(and <span class="math">T<sub>1</sub></span>  <span class="math">…</span> <span class="math">T<sub>n</sub></span>)</b> where
      <span class="math">T<sub>1</sub>,…,T<sub>n</sub></span> are the values of the <b>:type</b> slot options contained in all of the
      slot speciﬁers. If no slot speciﬁer contains the <b>:type</b> slot option, the
      contents of the slot will always be of type <b><a 
href="symbols.html#x188-380953r953">t</a></b>. The result of attempting
      to store in a slot a value that does not satisfy the type of the slot is
      undeﬁned.
      </li>
      <li class="itemize">The set of initialization arguments that initialize a given slot is the
                                                                          

                                                                          
      union  of  the  initialization  arguments  declared  in  the  <b>:initarg</b> slot
      options in all the slot speciﬁers.
      </li>
      <li class="itemize">The   documentation   string   for   a   slot   is   the   value   of   the
      <b>:documentation</b> slot option in the most speciﬁc slot speciﬁer that
      contains  one.  If  no  slot  speciﬁer  contains  a  <b>:documentation</b> slot
      option, the slot has no documentation string.</li></ul>
<!--l. 598--><p class="indent" >   A consequence of the allocation rule is that a shared slot can be shadowed. For
example, if a class <span class="math">C<sub>1</sub></span> deﬁnes a slot named <em>S</em> whose value for the <b>:allocation</b> slot
option is <b>:class</b>, that slot is accessible in instances of <span class="math">C<sub>1</sub></span> and all of its subclasses.
However, if <span class="math">C<sub>2</sub></span> is a subclass of <span class="math">C<sub>1</sub></span> and also deﬁnes a slot named <em>S</em>, <span class="math">C<sub>1</sub></span>&#x2019;s slot is not
shared by instances of <span class="math">C<sub>2</sub></span> and its subclasses. When a class <span class="math">C<sub>1</sub></span> deﬁnes a shared
slot, any subclass <span class="math">C<sub>2</sub></span> of <span class="math">C<sub>1</sub></span> will share this single slot unless the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form for
<span class="math">C<sub>2</sub></span> speciﬁes a slot of the same name or there is a superclass of <span class="math">C<sub>2</sub></span> that
precedes <span class="math">C<sub>1</sub></span> in the class precedence list of <span class="math">C<sub>2</sub></span> that deﬁnes a slot of the same
name.
<!--l. 611--><p class="indent" >   A consequence of the type rule is that the value of a slot satisﬁes the type
constraint of each slot speciﬁer that contributes to that slot. Because the result of
attempting to store in a slot a value that does not satisfy the type constraint
for the slot is undeﬁned, the value in a slot might fail to satisfy its type
constraint.
<!--l. 617--><p class="indent" >   The <b>:reader</b>, <b>:writer</b>, and <b>:accessor</b> slot options create methods rather than
deﬁne the characteristics of a slot. Reader and writer methods are inherited in the
sense described in section <a 
href="#x175-26000027.1.3">27.1.3<!--tex4ht:ref: Inheritance-of-Methods-SECTION --></a>.
<!--l. 622--><p class="indent" >   Methods that access slots use only the name of the slot and the type of the
slot&#x2019;s value. Suppose a superclass provides a method that expects to access a
shared slot of a given name, and a subclass deﬁnes a local slot with the same
name. If the method provided by the superclass is used on an instance of the
subclass, the method accesses the local slot.
<!--l. 629--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26200027.1.3" id="x175-26200027.1.3">Inheritance of Class Options</a></h5>
<!--l. 631--><p class="noindent" >The <b>:default-initargs</b> class option is inherited. The set of defaulted initialization
arguments for a class is the union of the sets of initialization arguments speciﬁed
in the <b>:default-initargs</b> class options of the class and its superclasses.
                                                                          

                                                                          
When more than one default initial value form is supplied for a given
initialization argument, the default initial value form that is used is the one
supplied by the class that is most speciﬁc according to the class precedence
list.
<!--l. 640--><p class="indent" >   If a given <b>:default-initargs</b> class option speciﬁes an initialization argument of
the same name more than once, an error is signaled.
<!--l. 644--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26300027.1.3" id="x175-26300027.1.3">Examples</a></h5>
<div class="lisp">
<tt>
<!--l. 646--><p class="noindent" ><div class="tabbing">
(defclass C1 ()
   <br>         ((S1 :initform 5.4 :type number)<br>          (S2 :allocation :class)))<br>
<br>                                                         (defclass C2 (C1)<br>
  ((S1 :initform 5 :type integer)<br>                  (S2 :allocation :instance)<br>
   (S3 :accessor C2-S3)))<br>
<!--l. 655--><p class="noindent" ></div>
</tt>
</div>
<!--l. 657--><p class="noindent" >Instances of the class <b>C1</b> have a local slot named <b>S1</b>, whose default initial value is
5.4 and whose value should always be a number. The class <b>C1</b> also has a shared
slot named <b>S2</b>.
<!--l. 661--><p class="indent" >   There is a local slot named <b>S1</b> in instances of <b>C2</b>. The default initial value of
<b>S1</b> is 5. The value of <b>S1</b> will be of type <b>(and integer number)</b>. There are also
local slots named <b>S2</b> and <b>S3</b> in instances of <b>C2</b>. The class <b>C2</b> has a method for
<b>C2-S3</b> for reading the value of slot <b>S3</b>; there is also a method for <b>(setf C2-S3)</b>
that writes the value of <b>S3</b>.
<!--l. 669--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.4   </span> <a 
href="frontmatter.html#QQ2-175-305" id="x175-26400027.1.4">Integrating Types and Classes</a></h4>
                                                                          

                                                                          
<!--l. 672--><p class="noindent" >The Common Lisp Object System maps the space of classes into the Common
Lisp type space. Every class that has a proper name has a corresponding type
with the same name.
<!--l. 676--><p class="indent" >   The proper name of every class is a valid type speciﬁer. In addition, every class
object is a valid type speciﬁer. Thus the expression <b>(typep <em>object class</em>)</b>
evaluates to true if the class of <em>object</em> is <em>class</em> itself or a subclass of <em>class</em>. The
evaluation of the expression <b>(subtypep <em>class1 class2</em>)</b> returns the values
<b><a 
href="symbols.html#x188-380953r953">t</a></b> and <b><a 
href="symbols.html#x188-380953r953">t</a></b> if <em>class1</em> is a subclass of <em>class2</em> or if they are the same class;
otherwise it returns the values <b><a 
href="symbols.html#x188-380670r670">nil</a></b> and <b><a 
href="symbols.html#x188-380953r953">t</a></b>. If <em>I</em> is an instance of some class <em>C</em>
named <em>S</em> and <em>C</em> is an instance of <b>standard-class</b>, the evaluation of the
expression <b>(type-of <em>I</em>)</b> will return <em>S</em> if <em>S</em> is the proper name of <em>C</em>; if
<em>S</em> is not the proper name of <em>C</em>, the expression <b>(type-of <em>I</em>)</b> will return
<em>C</em>.
<!--l. 690--><p class="indent" >   Because the names of classes and class objects are type speciﬁers, they may be
used in the special operator <b><a 
href="symbols.html#x188-380960r960">the</a></b> and in type declarations.
<!--l. 693--><p class="indent" >   Many but not all of the predeﬁned Common Lisp type speciﬁers have a
corresponding class with the same proper name as the type. These type speciﬁers
are listed in table <a 
href="#x175-2640021">27.1<!--tex4ht:ref: CLOS-PRECEDENCE-TABLE --></a>. For example, the type <b>array</b> has a corresponding class
named <b>array</b>. No type speciﬁer that is a list, such as <b>(vector double-ﬂoat
100)</b>, has a corresponding class. The form <b><a 
href="symbols.html#x188-380326r326">deftype</a></b> does not create any
classes.
<!--l. 700--><p class="indent" >   Each class that corresponds to a predeﬁned Common Lisp type speciﬁer can
be implemented in one of three ways, at the discretion of each implementation. It
can be a <em>standard class</em> (of the kind deﬁned by <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>), a <em>structure class</em>
(deﬁned by <b><a 
href="symbols.html#x188-380325r325">defstruct</a></b>), or a <em>built-in class</em> (implemented in a special,
non-extensible way).
<!--l. 707--><p class="indent" >   A built-in class is one whose instances have restricted capabilities or special
representations. Attempting to use <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> to deﬁne subclasses of a built-in class
signals an error. Calling <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> to create an instance of a built-in
class signals an error. Calling <b><a 
href="symbols.html#x188-380888r888">slot-value</a></b> on an instance of a built-in
class signals an error. Redeﬁning a built-in class or using <b><a 
href="symbols.html#x188-380214r214">change-class</a></b>
to change the class of an instance to or from a built-in class signals an
error. However, built-in classes can be used as parameter specializers in
methods.
<!--l. 717--><p class="indent" >   It is possible to determine whether a class is a built-in class by checking the
metaclass. A standard class is an instance of <b>standard-class</b>, a built-in class
is an instance of <b>built-in-class</b>, and a structure class is an instance of
<b>structure-class</b>.
                                                                          

                                                                          
<!--l. 723--><p class="indent" >   Each structure type created by <b><a 
href="symbols.html#x188-380325r325">defstruct</a></b> without using the <b>:type</b> option has
a corresponding class. This class is an instance of <b>structure-class</b>.
<!--l. 727--><p class="indent" >   The <b>:include</b> option of <b><a 
href="symbols.html#x188-380325r325">defstruct</a></b> creates a direct subclass of the class that
corresponds to the included structure.
<!--l. 730--><p class="indent" >   The purpose of specifying that many of the standard Common Lisp type
speciﬁers have a corresponding class is to enable users to write methods that
discriminate on these types. Method selection requires that a class precedence list
can be determined for each class.
<!--l. 736--><p class="indent" >   The hierarchical relationships among the Common Lisp type speciﬁers are
mirrored by relationships among the classes corresponding to those types. The
existing type hierarchy is used for determining the class precedence list for each
class that corresponds to a predeﬁned Common Lisp type.
<!--l. 750--><p class="indent" >   Table <a 
href="#x175-2640021">27.1<!--tex4ht:ref: CLOS-PRECEDENCE-TABLE --></a> lists the set of classes required by the Object System that
correspond to predeﬁned Common Lisp type speciﬁers. The superclasses of each
such class are presented in order from most speciﬁc to most general, thereby
deﬁning the class precedence list for the class. The local precedence order for each
class that corresponds to a Common Lisp type speciﬁer can be derived from this
table.
<!--l. 758--><p class="indent" >   Individual implementations may be extended to deﬁne other type speciﬁers to
have a corresponding class. Individual implementations can be extended to
add other subclass relationships and to add other elements to the class
precedence lists in the above table as long as they do not violate the type
relationships and disjointness requirements speciﬁed in section <a 
href="clmse17.html#x24-400002.15">2.15<!--tex4ht:ref: DATA-TYPE-RELATIONSHIPS --></a>. A
standard class deﬁned with no direct superclasses is guaranteed to be
disjoint from all of the classes in the table, except for the class named
<b><a 
href="symbols.html#x188-380953r953">t</a></b>.
<!--l. 768--><p class="indent" >   [At this point the original CLOS report speciﬁed that certain Common Lisp
types were to appear in table <a 
href="#x175-2640021">27.1<!--tex4ht:ref: CLOS-PRECEDENCE-TABLE --></a> if and only if X3J13 voted to make them
disjoint from <b>cons</b>, <b>symbol</b>, <b>array</b>, <b>number</b>, and <b><a 
href="symbols.html#x188-380234r234">character</a></b>. X3J13 voted to do
so in June 1988 <a 
 id="dx175-264001"></a>. I have added these types and their class precedence lists to the
table; the new types are indicated by asterisks.—GLS]
   <div class="table">
                                                                          

                                                                          
<!--l. 777--><p class="indent" >   <a 
 id="x175-2640021"></a><hr class="float"><div class="float" 
>
                                                                          

                                                                          
 <div class="caption" 
><span class="id">Table 27.1: </span><span  
class="content">Class Precedence Lists for Predeﬁned Types</span></div><!--tex4ht:label?: x175-2640021 -->
<div class="flushleft" 
>
<!--l. 780--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >Predeﬁned Common Lisp Type</td><td align="left" >Class Precedence List for Corresponding Class</td>
</tr><tr><td align="left" >array                                  </td><td align="left" >(array t)                                                  </td>
</tr><tr><td align="left" >bit-vector                            </td><td align="left" >(bit-vector vector array sequence t)               </td>
</tr><tr><td align="left" >character                             </td><td align="left" >(character t)                                            </td>
</tr><tr><td align="left" >complex                              </td><td align="left" >(complex number t)                                   </td>
</tr><tr><td align="left" >cons                                   </td><td align="left" >(cons list sequence t)                                 </td>
</tr><tr><td align="left" >ﬂoat                                   </td><td align="left" >(ﬂoat number t)                                        </td>
</tr><tr><td align="left" >function *                            </td><td align="left" >(function t)                                              </td>
</tr><tr><td align="left" >hash-table *                         </td><td align="left" >(hash-table t)                                           </td>
</tr><tr><td align="left" >integer                                </td><td align="left" >(integer rational number t)                          </td>
</tr><tr><td align="left" >list                                     </td><td align="left" >(list sequence t)                                        </td>
</tr><tr><td align="left" >null                                    </td><td align="left" >(null symbol list sequence t)                        </td>
</tr><tr><td align="left" >number                               </td><td align="left" >(number t)                                               </td>
</tr><tr><td align="left" >package *                            </td><td align="left" >(package t)                                              </td>
</tr><tr><td align="left" >pathname *                          </td><td align="left" >(pathname t)                                            </td>
</tr><tr><td align="left" >random-state *                     </td><td align="left" >(random-state t)                                       </td>
</tr><tr><td align="left" >ratio                                   </td><td align="left" >(ratio rational number t)                            </td>
</tr><tr><td align="left" >rational                               </td><td align="left" >(rational number t)                                   </td>
</tr><tr><td align="left" >readtable *                          </td><td align="left" >(readtable t)                                            </td>
</tr><tr><td align="left" >sequence                              </td><td align="left" >(sequence t)                                             </td>
</tr><tr><td align="left" >stream *                              </td><td align="left" >(stream t)                                                </td>
</tr><tr><td align="left" >string                                 </td><td align="left" >(string vector array sequence t)                    </td>
</tr><tr><td align="left" >symbol                                </td><td align="left" >(symbol t)                                               </td>
</tr><tr><td align="left" >t                                        </td><td align="left" >(t)                                                          </td>
</tr><tr><td align="left" >vector                                 </td><td align="left" >(vector array sequence t)                            </td></tr></table>
</div></div>
<!--l. 811--><p class="noindent" >[An asterisk indicates a type added to this table as a consequence of a portion of
the CLOS speciﬁcation that was conditional on X3J13 voting to make that type
disjoint from certain other built-in types <a 
 id="dx175-264003"></a>.—GLS]
                                                                          

                                                                          
   </div><hr class="endfloat" />
   </div>
   <h4 class="subsectionHead"><span class="titlemark">27.1.5   </span> <a 
href="frontmatter.html#QQ2-175-307" id="x175-26500027.1.5">Determining the Class Precedence List</a></h4>
<!--l. 820--><p class="noindent" >The <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form for a class provides a total ordering on that class and its direct
superclasses. This ordering is called the <em>local precedence order</em>. It is an ordered list
of the class and its direct superclasses. The <em>class precedence list</em> for a class <em>C</em> is a
total ordering on <em>C</em> and its superclasses that is consistent with the local
precedence orders for <em>C</em> and its superclasses.
<!--l. 827--><p class="indent" >   A class precedes its direct superclasses, and a direct superclass precedes all
other direct superclasses speciﬁed to its right in the superclasses list of the
<b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form. For every class <em>C</em>, deﬁne
<span class="math">
                  R<sub>C</sub> = {(C,C<sub>1</sub>), (C<sub>1</sub>,C<sub>2</sub>),…, (C<sub>n−1</sub>,C<sub>n</sub>)}
</span> where <span class="math">C<sub>1</sub>,…,C<sub>n</sub></span> are the direct superclasses of <em>C</em> in the order in which they are
mentioned in the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form. These ordered pairs generate the total ordering
on the class <em>C</em> and its direct superclasses.
<!--l. 838--><p class="indent" >   Let <span class="math">S<sub>C</sub></span> be the set of <em>C</em> and its superclasses. Let <em>R</em> be
<span class="math">
                                                                          

                                                                          
                             R = ⋃
  <sub>c ∈ S<sub>
C</sub></sub>R<sub>c</sub>
</span>
<!--l. 841--><p class="indent" >   The set <em>R</em> may or may not generate a partial ordering, depending on whether
the <span class="math">R<sub>c</sub></span>, <span class="math">c ∈ S<sub>C</sub></span>, are consistent; it is assumed that they are consistent and that <em>R</em>
generates a partial ordering. When the <span class="math">R<sub>c</sub></span> are not consistent, it is said that <em>R</em> is
inconsistent.
<!--l. 847--><p class="indent" >   To compute the class precedence list for <em>C</em>, topologically sort the elements
of <span class="math">S<sub>C</sub></span> with respect to the partial ordering generated by <em>R</em>. When the
topological sort must select a class from a set of two or more classes, none of
which are preceded by other classes with respect to <em>R</em>, the class selected is
chosen deterministically, as described below. If <em>R</em> is inconsistent, an error is
signaled.
<!--l. 855--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26600027.1.5" id="x175-26600027.1.5">Topological Sorting</a></h5>
<!--l. 858--><p class="noindent" ><a 
href="http://ru.wikipedia.org/wiki/\protect \T2A\CYRT \protect \T2A\cyro \protect \T2A\cyrp \protect \T2A\cyro \protect \T2A\cyrl \protect \T2A\cyro \protect \T2A\cyrg \protect \T2A\cyri \protect \T2A\cyrch \protect \T2A\cyre \protect \T2A\cyrs \protect \T2A\cyrk \protect \T2A\cyra \protect \T2A\cyrya _\protect \T2A\cyrs \protect \T2A\cyro \protect \T2A\cyrr \protect \T2A\cyrt \protect \T2A\cyri \protect \T2A\cyrr \protect \T2A\cyro \protect \T2A\cyrv \protect \T2A\cyrk \protect \T2A\cyra " >Топологическая сортировка</a>
<!--l. 860--><p class="indent" >   Topological sorting proceeds by ﬁnding a class <em>C</em> in <span class="math">S<sub>C</sub></span> such that no other
class precedes that element according to the elements in <em>R</em>. The class <em>C</em> is placed
ﬁrst in the result. Remove <em>C</em> from <span class="math">S<sub>C</sub></span>, and remove all pairs of the form <span class="math">(C,D)</span>,
<span class="math">D ∈ S<sub>C</sub></span>, from <em>R</em>. Repeat the process, adding classes with no predecessors to
the end of the result. Stop when no element can be found that has no
predecessor.
<!--l. 869--><p class="indent" >   If <span class="math">S<sub>C</sub></span> is not empty and the process has stopped, the set <em>R</em> is inconsistent. If
every class in the ﬁnite set of classes is preceded by another, then <em>R</em> contains a
loop. That is, there is a chain of classes <span class="math">C<sub>1</sub>,…,C<sub>n</sub></span> such that <span class="math">C<sub>i</sub></span> precedes <span class="math">C<sub>i+1</sub></span>,
<span class="math">1 ≤ i &#x003C; n</span>, and <span class="math">C<sub>n</sub></span> precedes <span class="math">C<sub>1</sub></span>.
<!--l. 877--><p class="indent" >   Sometimes there are several classes from <span class="math">S<sub>C</sub></span> with no predecessors. In this case
select the one that has a direct subclass rightmost in the class precedence list
computed so far. If there is no such candidate class, <em>R</em> does not generate a partial
ordering — the <span class="math">R<sub>c</sub></span>, <span class="math">c ∈ S<sub>C</sub></span>, are inconsistent.
<!--l. 887--><p class="indent" >   In more precise terms, let <span class="math">{N<sub>1</sub>,…,N<sub>m</sub>}</span>, <span class="math">m ≥ 2</span>, be the classes from <span class="math">S<sub>C</sub></span> with no
predecessors. Let <span class="math">(C<sub>1</sub>…C<sub>n</sub>)</span>, <span class="math">n ≥ 1</span>, be the class precedence list constructed so far.
<span class="math">C<sub>1</sub></span> is the most speciﬁc class, and <span class="math">C<sub>n</sub></span> is the least speciﬁc. Let <span class="math">1 ≤ j ≤ n</span> be the
largest number such that there exists an <em>i</em> where <span class="math">1 ≤ i ≤ m</span> and <span class="math">N<sub>i</sub></span> is a direct
                                                                          

                                                                          
superclass of <span class="math">C<sub>j</sub></span>; <span class="math">N<sub>i</sub></span> is placed next.
<!--l. 898--><p class="indent" >   The eﬀect of this rule for selecting from a set of classes with no predecessors is
that classes in a simple superclass chain are adjacent in the class precedence
list and that classes in each relatively separated subgraph are adjacent
in the class precedence list. For example, let <span class="math">T<sub>1</sub></span> and <span class="math">T<sub>2</sub></span> be subgraphs
whose only element in common is the class <em>J</em>. Suppose that no superclass
of <em>J</em> appears in either <span class="math">T<sub>1</sub></span> or <span class="math">T<sub>2</sub></span>. Let <span class="math">C<sub>1</sub></span> be the bottom of <span class="math">T<sub>1</sub></span>; and let
<span class="math">C<sub>2</sub></span> be the bottom of <span class="math">T<sub>2</sub></span>. Suppose <em>C</em> is a class whose direct superclasses
are <span class="math">C<sub>1</sub></span> and <span class="math">C<sub>2</sub></span> in that order; then the class precedence list for <em>C</em> will
start with <em>C</em> and will be followed by all classes in <span class="math">T<sub>1</sub></span> except <em>J</em>. All the
classes of <span class="math">T<sub>2</sub></span> will be next. The class <em>J</em> and its superclasses will appear
last.
<!--l. 912--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26700027.1.5" id="x175-26700027.1.5">Examples</a></h5>
<!--l. 914--><p class="noindent" >This example determines a class precedence list for the class <b>pie</b>. The following
classes are deﬁned:
<div class="lisp">
<tt>
<!--l. 917--><p class="indent" >   <div class="tabbing">
(defclass pie (apple cinnamon) ())
   <br>            (defclass apple (fruit) ())<br>            (defclass cinnamon (spice) ())<br>
(defclass fruit (food) ())<br>                           (defclass spice (food) ())<br>
(defclass food () ())<br>
<!--l. 924--><p class="noindent" ></div>
</tt>
</div>
<div class="flushleft" 
>
<!--l. 926--><p class="noindent" >
<!--l. 928--><p class="noindent" >The set S={<b>pie</b>, <b>apple</b>, <b>cinnamon</b>, <b>fruit</b>, <b>spice</b>, <b>food</b>, <b>standard-object</b>,
<b><a 
href="symbols.html#x188-380953r953">t</a></b>}. The set R={(<b>pie</b>, <b>apple</b>), (<b>apple</b>, <b>cinnamon</b>), (<b>cinnamon</b>,
                                                                          

                                                                          
<b>standard-object</b>), (<b>apple</b>, <b>fruit</b>), (<b>fruit</b>, <b>standard-object</b>),
(<b>cinnamon</b>, <b>spice</b>), (<b>spice</b>, <b>standard-object</b>), (<b>fruit</b>, <b>food</b>), (<b>food</b>,
<b>standard-object</b>), (<b>spice</b>, <b>food</b>), (<b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>)}.
<!--l. 960--><p class="noindent" >The class <b>pie</b> is not preceded by anything, so it comes ﬁrst; the result so far
is <b>(pie)</b>. Remove <b>pie</b> from <em>S</em> and pairs mentioning <b>pie</b> from <em>R</em> to get
S={<b>apple</b>, <b>cinnamon</b>, <b>fruit</b>, <b>spice</b>, <b>food</b>, <b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>} and R={
(<b>apple</b>, <b>cinnamon</b>), (<b>cinnamon</b>, <b>standard-object</b>), (<b>apple</b>, <b>fruit</b>),
(<b>fruit</b>, <b>standard-object</b>), (<b>cinnamon</b>, <b>spice</b>), (<b>spice</b>,
<b>standard-object</b>), (<b>fruit</b>, <b>food</b>), (<b>food</b>, <b>standard-object</b>), (<b>spice</b>,
<b>food</b>), (<b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>)}.
<!--l. 991--><p class="noindent" >The class <b>apple</b> is not preceded by anything, so it is next; the result is
<b>(pie apple)</b>. Removing <b>apple</b> and the relevant pairs results in
S={<b>cinnamon</b>, <b>fruit</b>, <b>spice</b>, <b>food</b>, <b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>} and
R={(<b>cinnamon</b>, <b>standard-object</b>), (<b>fruit</b>, <b>standard-object</b>),
(<b>cinnamon</b>, <b>spice</b>), (<b>spice</b>, <b>standard-object</b>), (<b>fruit</b>, <b>food</b>), (<b>food</b>,
<b>standard-object</b>), (<b>spice</b>, <b>food</b>), (<b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>)}.
<!--l. 1015--><p class="noindent" >The classes <b>cinnamon</b> and <b>fruit</b> are not preceded by anything, so the one
with a direct subclass rightmost in the class precedence list computed so far
goes next. The class <b>apple</b> is a direct subclass of <b>fruit</b>, and the class <b>pie</b> is
a direct subclass of <b>cinnamon</b>. Because <b>apple</b> appears to the right of <b>pie</b>
in the precedence list, <b>fruit</b> goes next, and the result so far is <b>(pie apple
fruit)</b>. S={<b>cinnamon</b>, <b>spice</b>, <b>food</b>, <b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>};
R={(<b>cinnamon</b>, <b>standard-object</b>), (<b>cinnamon</b>, <b>spice</b>), (<b>spice</b>,
<b>standard-object</b>), (<b>food</b>, <b>standard-object</b>), (<b>spice</b>, <b>food</b>),
(<b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>)}.
<!--l. 1038--><p class="noindent" >The class <b>cinnamon</b> is next, giving the result so far as <b>(pie apple fruit
cinnamon)</b>. At this point S={<b>spice</b>, <b>food</b>, <b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>};
R={(<b>spice</b>, <b>standard-object</b>), (<b>food</b>, <b>standard-object</b>), (<b>spice</b>, <b>food</b>),
(<b>standard-object</b>, <b><a 
href="symbols.html#x188-380953r953">t</a></b>)}.</div>
<!--l. 1052--><p class="indent" >   The classes <b>spice</b>, <b>food</b>, <b>standard-object</b>, and <b><a 
href="symbols.html#x188-380953r953">t</a></b> are then added in that
order, and the ﬁnal class precedence list for <b>pie</b> is <div class="lisp"><tt><div class="tabbing">
(pie apple fruit cinnamon spice food standard-object t)
   <br>
<!--l. 1056--><p class="noindent" ></div>
                                                                          

                                                                          
</tt>
</div>
<!--l. 1058--><p class="indent" >   It is possible to write a set of class deﬁnitions that cannot be ordered. For
example: <div class="lisp"><tt><div class="tabbing">
(defclass new-class (fruit apple) ())
   <br>                                                              (defclass apple (fruit) ())<br>
<!--l. 1063--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1065--><p class="indent" >   The class <b>fruit</b> must precede <b>apple</b> because the local ordering of
superclasses must be preserved. The class <b>apple</b> must precede <b>fruit</b> because a
class always precedes its own superclasses. When this situation occurs, an
error is signaled when the system tries to compute the class precedence
list.
<!--l. 1071--><p class="indent" >   The following might appear to be a conﬂicting set of deﬁnitions: <div class="lisp"><tt><div class="tabbing">
(defclass pie (apple cinnamon) ())
   <br>          (defclass pastry (cinnamon apple) ())<br>          (defclass apple () ())<br>
(defclass cinnamon () ())<br>
<!--l. 1077--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1079--><p class="indent" >   The class precedence list for <b>pie</b> is <div class="lisp"><tt><div class="tabbing">
(pie apple cinnamon standard-object t)
   <br>
<!--l. 1082--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1084--><p class="indent" >   The class precedence list for <b>pastry</b> is <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(pastry cinnamon apple standard-object t)
   <br>
<!--l. 1087--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1089--><p class="indent" >   It is not a problem for <b>apple</b> to precede <b>cinnamon</b> in the ordering of
the superclasses of <b>pie</b> but not in the ordering for <b>pastry</b>. However, it
is not possible to build a new class that has both <b>pie</b> and <b>pastry</b> as
superclasses.
<!--l. 1094--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.6   </span> <a 
href="frontmatter.html#QQ2-175-310" id="x175-26800027.1.6">Generic Functions and Methods</a></h4>
<!--l. 1096--><p class="noindent" >A <em>generic function</em> is a function whose behavior depends on the classes or
identities of the arguments supplied to it. The <em>methods</em> deﬁne the class-speciﬁc
behavior and operations of the generic function. The following sections describe
generic functions and methods.
<!--l. 1102--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-26900027.1.6" id="x175-26900027.1.6">Introduction to Generic Functions</a></h5>
<!--l. 1104--><p class="noindent" >A generic function object contains a set of methods, a lambda-list, a method
combination type, and other information.
<!--l. 1107--><p class="indent" >   Like an ordinary Lisp function, a generic function takes arguments, performs a
series of operations, and perhaps returns useful values. An ordinary function
has a single body of code that is always executed when the function is
called. A generic function has a set of bodies of code of which a subset is
selected for execution. The selected bodies of code and the manner of their
combination are determined by the classes or identities of one or more of
the arguments to the generic function and by its method combination
type.
<!--l. 1116--><p class="indent" >   Ordinary functions and generic functions are called with identical function-call
syntax.
<!--l. 1119--><p class="indent" >   Generic functions are true functions that can be passed as arguments, returned
                                                                          

                                                                          
as values, used as the ﬁrst argument to <b><a 
href="symbols.html#x188-380444r444">funcall</a></b> and <b><a 
href="symbols.html#x188-380101r101">apply</a></b>, and otherwise used in
all the ways an ordinary function may be used.
<!--l. 1155--><p class="indent" >   The <b><a 
href="symbols.html#x188-380452r452">generic-function</a></b> macro creates an anonymous generic function with the
set of methods speciﬁed by the method deﬁnitions that appear in the
<b>generic-function</b> form.
<!--l. 1159--><p class="indent" >   When a <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> form is evaluated, one of three actions is taken:
      <ul class="itemize1">
      <li class="itemize">If a generic function of the given name already exists, the existing
      generic function object is modiﬁed. Methods speciﬁed by the current
      <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> form are added, and any methods in the existing generic
      function that were deﬁned by a previous <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> form are removed.
      Methods added by the current <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> form might replace methods
      deﬁned by <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b> or <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>. No other methods in the generic
      function are aﬀected or replaced.
      </li>
      <li class="itemize">If the given name names a non-generic function, a macro, or a special
      operator, an error is signaled.
      </li>
      <li class="itemize">Otherwise a generic function is created with the methods speciﬁed by
      the method deﬁnitions in the <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> form.</li></ul>
<!--l. 1181--><p class="indent" >   Some forms specify the options of a generic function, such as the type of
method combination it uses or its argument precedence order. They will be
referred to as “forms that specify generic function options.” These forms are
<b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b>, <b><a 
href="symbols.html#x188-380452r452">generic-function</a></b>.
<!--l. 1188--><p class="indent" >   Some forms deﬁne methods for a generic function. They will be referred to
as “method-deﬁning forms.” These forms are <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b>, <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b>,
<b><a 
href="symbols.html#x188-380452r452">generic-function</a></b>, and <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>. Note that all the method-deﬁning forms except
<b><a 
href="symbols.html#x188-380310r310">defclass</a></b> and <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b> are also forms that specify generic function
options.
<!--l. 1196--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27000027.1.6" id="x175-27000027.1.6">Introduction to Methods</a></h5>
                                                                          

                                                                          
<!--l. 1199--><p class="noindent" >A method object contains a method function, a sequence of <em>parameter specializers</em>
that specify when the given method is applicable, a lambda-list, and a sequence of
<em>qualiﬁers</em> that are used by the method combination facility to distinguish among
methods.
<!--l. 1205--><p class="indent" >   A method object is not a function and cannot be invoked as a function.
Various mechanisms in the Object System take a method object and invoke its
method function, as is the case when a generic function is invoked. When this
occurs it is said that the method is invoked or called.
<!--l. 1210--><p class="indent" >   A method-deﬁning form contains the code that is to be run when the
arguments to the generic function cause the method that it deﬁnes to be invoked.
When a method-deﬁning form is evaluated, a method object is created and one of
four actions is taken:
      <ul class="itemize1">
      <li class="itemize">If a generic function of the given name already exists and if a method
      object  already  exists  that  agrees  with  the  new  one  on  parameter
      specializers and qualiﬁers, the new method object replaces the old one.
      For a deﬁnition of one method agreeing with another on parameter
      specializers and qualiﬁers, see section <a 
href="#x175-27100027.1.6">27.1.6<!--tex4ht:ref: Agreement-on-Parameter-Specializers-and-Qualifiers-SECTION --></a>.
      </li>
      <li class="itemize">If a generic function of the given name already exists and if there is no
      method object that agrees with the new one on parameter specializers
      and qualiﬁers, the existing generic function object is modiﬁed to contain
      the new method object.
      </li>
      <li class="itemize">If the given name names a non-generic function, a macro, or a special
      operator, an error is signaled.
      </li>
      <li class="itemize">Otherwise a generic function is created with the methods speciﬁed by
      the method-deﬁning form.
      </li></ul>
<!--l. 1237--><p class="indent" >   If the lambda-list of a new method is not congruent with the lambda-list of the
generic function, an error is signaled. If a method-deﬁning form that cannot
specify generic function options creates a new generic function, a lambda-list for
                                                                          

                                                                          
that generic function is derived from the lambda-lists of the methods in the
method-deﬁning form in such a way as to be congruent with them. For a
discussion of <em>congruence</em>, see section <a 
href="#x175-27200027.1.6">27.1.6<!--tex4ht:ref: Congruent-Lambda-Lists-for-All-Methods-of-a-Generic-Function-SECTION --></a>.
<!--l. 1246--><p class="indent" >   Each method has a <em>specialized lambda-list</em>, which determines when that
method can be applied. A specialized lambda-list is like an ordinary lambda-list
except that a <em>specialized parameter</em> may occur instead of the name of a
required parameter. A specialized parameter is a list <b>(<em>variable-name
parameter-specializer-name</em>)</b>, where <em>parameter-specializer-name</em> is either a
name that names a class or a list <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>form</em>)</b>. A parameter specializer name
denotes a parameter specializer as follows:
      <ul class="itemize1">
      <li class="itemize">A name that names a class denotes that class.
      </li>
      <li class="itemize">The list <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>form</em>)</b> denotes the type speciﬁer <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>object</em>)</b>, where
      <em>object</em> is the result of evaluating <em>form</em>. The form <em>form</em> is evaluated in
      the lexical environment in which the method-deﬁning form is evaluated.
      Note  that  <em>form</em> is  evaluated  only  once,  at  the  time  the  method  is
      deﬁned, not each time the generic function is called.</li></ul>
<!--l. 1266--><p class="indent" >   Parameter specializer names are used in macros intended as the user-level
interface (<b><a 
href="symbols.html#x188-380321r321">defmethod</a></b>), while parameter specializers are used in the functional
interface.
<!--l. 1270--><p class="indent" >   [It is very important to understand clearly the distinction made in the
preceding paragraph. A parameter specializer name has the form of a type
speciﬁer but is semantically quite diﬀerent from a type speciﬁer: a parameter
specializer name of the form <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>form</em>)</b> is not a type speciﬁer, for it contains a
<em>form</em> to be evaluated. Type speciﬁers never contain forms to be evaluated.
All parameter specializers (as opposed to parameter specializer names)
are valid type speciﬁers, but not all type speciﬁers are valid parameter
specializers. Macros such as <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b> take parameter specializer names
and treat them as speciﬁcations for constructing certain type speciﬁers
(parameter specializers) that may then be used with such functions as
<b><a 
href="symbols.html#x188-380418r418">ﬁnd-method</a></b>.—GLS]
<!--l. 1283--><p class="indent" >   Only required parameters may be specialized, and there must be a parameter
specializer for each required parameter. For notational simplicity, if some required
parameter in a specialized lambda-list in a method-deﬁning form is simply
                                                                          

                                                                          
a variable name, its parameter specializer defaults to the class named
<b><a 
href="symbols.html#x188-380953r953">t</a></b>.
<!--l. 1289--><p class="indent" >   Given a generic function and a set of arguments, an <em>applicable method</em> is a
method for that generic function whose parameter specializers are satisﬁed by
their corresponding arguments. The following deﬁnition speciﬁes what it means
for a method to be applicable and for an argument to satisfy a parameter
specializer.
<!--l. 1295--><p class="indent" >   Let <span class="math">⟨A<sub>1</sub>,…,A<sub>n</sub>⟩</span> be the required arguments to a generic function in order. Let
<span class="math">⟨P<sub>1</sub>,…,P<sub>n</sub>⟩</span> be the parameter specializers corresponding to the required
parameters of the method <em>M</em> in order. The method <em>M</em> is <em>applicable</em> when each <span class="math">A<sub>i</sub></span>
<em>satisﬁes</em> <span class="math">P<sub>i</sub></span>. If <span class="math">P<sub>i</sub></span> is a class, and if <span class="math">A<sub>i</sub></span> is an instance of a class <em>C</em>, then it is said
that <span class="math">A<sub>i</sub></span> <em>satisﬁes</em> <span class="math">P<sub>i</sub></span> when <span class="math">C = P<sub>i</sub></span> or when <em>C</em> is a subclass of <span class="math">P<sub>i</sub></span>. If <span class="math">P<sub>i</sub></span> is of the
form <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>object</em>)</b>, then it is said that <span class="math">A<sub>i</sub></span> satisﬁes <span class="math">P<sub>i</sub></span> when the function <b><a 
href="symbols.html#x188-380379r379">eql</a></b>
applied to <span class="math">A<sub>i</sub></span> and <em>object</em> is true.
<!--l. 1311--><p class="indent" >   Because a parameter specializer is a type speciﬁer, the function <b><a 
href="symbols.html#x188-380978r978">typep</a></b> can be
used during method selection to determine whether an argument satisﬁes a
parameter specializer. In general a parameter specializer cannot be a type speciﬁer
list, such as <b>(<b>vector single-ﬂoat</b>)</b>. The only parameter specializer that can be a
list is <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>object</em>)</b>. This requires that Common Lisp deﬁne the type speciﬁer <b><a 
href="symbols.html#x188-380379r379">eql</a></b>
as if the following were evaluated:
<div class="lisp">
<tt>
<!--l. 1320--><p class="indent" >   <div class="tabbing">
(deftype eql (<em>object</em>) ‘(member ,<em>object</em>))
   <br>
<!--l. 1322--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1323--><p class="indent" >   [See section <a 
href="clmse20.html#x29-450004.3">4.3<!--tex4ht:ref: PREDICATING-TYPE-SPECIFIERS-SECTION --></a>.—GLS]
<!--l. 1325--><p class="indent" >   A method all of whose parameter specializers are the class named <b><a 
href="symbols.html#x188-380953r953">t</a></b> is called a
<em>default method</em>; it is always applicable but may be shadowed by a more speciﬁc
method.
<!--l. 1329--><p class="indent" >   Methods can have <em>qualiﬁers</em>, which give the method combination procedure a
way to distinguish among methods. A method that has one or more qualiﬁers is
                                                                          

                                                                          
called a <em>qualiﬁed</em> method. A method with no qualiﬁers is called an <em>unqualiﬁed
method</em>. A qualiﬁer is any object other than a list, that is, any non-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> atom. The
qualiﬁers deﬁned by standard method combination and by the built-in method
combination types are symbols.
<!--l. 1337--><p class="indent" >   In this speciﬁcation, the terms <em>primary method</em> and <em>auxiliary method</em> are used
to partition methods within a method combination type according to their
intended use. In standard method combination, primary methods are unqualiﬁed
methods, and auxiliary methods are methods with a single qualiﬁer that is one of
<b>:around</b>, <b>:before</b>, or <b>:after</b>. When a method combination type is deﬁned using
the short form of <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b>, primary methods are methods
qualiﬁed with the name of the type of method combination, and auxiliary
methods have the qualiﬁer <b>:around</b>. Thus the terms <em>primary method</em> and
<em>auxiliary method</em> have only a relative deﬁnition within a given method
combination type.
<!--l. 1350--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27100027.1.6" id="x175-27100027.1.6">Agreement on Parameter Specializers and Qualiﬁers</a></h5>
<!--l. 1353--><p class="noindent" >Two methods are said to agree with each other on parameter specializers and
qualiﬁers if the following conditions hold:
      <ul class="itemize1">
      <li class="itemize">Both methods have the same number of required parameters. Suppose
      the  parameter  specializers  of  the  two  methods  are  <span class="math">P<sub>1,1</sub>…P<sub>1,n</sub></span>  and
      <span class="math">P<sub>2,1</sub>…P<sub>2,n</sub></span>.
      </li>
      <li class="itemize">For each <span class="math">1 ≤ i ≤ n</span>, <span class="math">P<sub>1,i</sub></span> agrees with <span class="math">P<sub>2,i</sub></span>. The parameter specializer
      <span class="math">P<sub>1,i</sub></span>  agrees with <span class="math">P<sub>2,i</sub></span>  if <span class="math">P<sub>1,i</sub></span>  and <span class="math">P<sub>2,i</sub></span>  are the same class or if <span class="math">P<sub>1,i</sub>  =
      (<b><a 
href="symbols.html#x188-380379r379">eql</a></b>object<sub>1</sub>)</span>, <span class="math">P<sub>2,i</sub> = (<b><a 
href="symbols.html#x188-380379r379">eql</a></b>object<sub>2</sub>)</span>, and <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <span class="math">object<sub>1</sub></span> <span class="math">object<sub>2</sub></span>)</b>. Otherwise
      <span class="math">P<sub>1,i</sub></span> and <span class="math">P<sub>2,i</sub></span> do not agree.
      </li>
      <li class="itemize">The lists of qualiﬁers of both methods contain the same non-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> atoms
      in the same order. That is, the lists are <b><a 
href="symbols.html#x188-380381r381">equal</a></b>.</li></ul>
                                                                          

                                                                          
<!--l. 1377--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27200027.1.6" id="x175-27200027.1.6">Congruent Lambda-Lists for All Methods of a Generic Function</a></h5>
<!--l. 1380--><p class="noindent" >These rules deﬁne the congruence of a set of lambda-lists, including the
lambda-list of each method for a given generic function and the lambda-list
speciﬁed for the generic function itself, if given.
      <ul class="itemize1">
      <li class="itemize">Each lambda-list must have the same number of required parameters.
      </li>
      <li class="itemize">Each lambda-list must have the same number of optional parameters.
      Each method can supply its own default for an optional parameter.
      </li>
      <li class="itemize">If any lambda-list mentions <b>&#x0026;rest</b> or <b>&#x0026;key</b>, each lambda-list must
      mention one or both of them.
      </li>
      <li class="itemize">If the generic function lambda-list mentions <b>&#x0026;key</b>, each method must
      accept  all  of  the  keyword  names  mentioned  after  <b>&#x0026;key</b>,  either  by
      accepting  them  explicitly,  by  specifying  <b>&#x0026;allow-other-keys</b>,  or  by
      specifying <b>&#x0026;rest</b> but not <b>&#x0026;key</b>. Each method can accept additional
      keyword arguments of its own. The checking of the validity of keyword
      names  is  done  in  the  generic  function,  not  in  each  method.  A
      method is invoked as if the keyword argument pair whose keyword is
      <b>:allow-other-keys</b> and whose value is <b><a 
href="symbols.html#x188-380953r953">t</a></b> were supplied, though no such
      argument pair will be passed.
      </li>
      <li class="itemize">The  use  of  <b>&#x0026;allow-other-keys</b>  need  not  be  consistent  across
      lambda-lists. If <b>&#x0026;allow-other-keys</b> is mentioned in the lambda-list
      of  any  applicable  method  or  of  the  generic  function,  any  keyword
      arguments may be mentioned in the call to the generic function.
      </li>
      <li class="itemize">The use of <b>&#x0026;aux</b> need not be consistent across methods.</li></ul>
<!--l. 1415--><p class="indent" >   If a method-deﬁning form that cannot specify generic function options creates
a generic function, and if the lambda-list for the method mentions keyword
                                                                          

                                                                          
arguments, the lambda-list of the generic function will mention <b>&#x0026;key</b> (but no
keyword arguments).
<!--l. 1420--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27300027.1.6" id="x175-27300027.1.6">Keyword Arguments in Generic Functions and Methods</a></h5>
<!--l. 1422--><p class="noindent" >When a generic function or any of its methods mentions <b>&#x0026;key</b> in a lambda-list,
the speciﬁc set of keyword arguments accepted by the generic function varies
according to the applicable methods. The set of keyword arguments accepted by
the generic function for a particular call is the union of the keyword arguments
accepted by all applicable methods and the keyword arguments mentioned after
<b>&#x0026;key</b> in the generic function deﬁnition, if any. A method that has <b>&#x0026;rest</b> but not
<b>&#x0026;key</b> does not aﬀect the set of acceptable keyword arguments. If the lambda-list
of any applicable method or of the generic function deﬁnition contains
<b>&#x0026;allow-other-keys</b>, all keyword arguments are accepted by the generic
function.
<!--l. 1434--><p class="indent" >   The lambda-list congruence rules require that each method accept all of the
keyword arguments mentioned after <b>&#x0026;key</b> in the generic function deﬁnition, by
accepting them explicitly, by specifying <b>&#x0026;allow-other-keys</b>, or by specifying
<b>&#x0026;rest</b> but not <b>&#x0026;key</b>. Each method can accept additional keyword arguments of
its own, in addition to the keyword arguments mentioned in the generic function
deﬁnition.
<!--l. 1442--><p class="indent" >   If a generic function is passed a keyword argument that no applicable method
accepts, an error is signaled.
<!--l. 1445--><p class="indent" >   For example, suppose there are two methods deﬁned for <b>width</b> as
follows:
<div class="lisp">
<tt>
<!--l. 1448--><p class="indent" >   <div class="tabbing">
(defmethod width ((c character-class) &#x0026;key font) ...)
   <br>                                                                                               <br>
(defmethod width ((p picture-class) &#x0026;key pixel-size) ...)<br>
<!--l. 1452--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<!--l. 1454--><p class="indent" >   Assume that there are no other methods and no generic function deﬁnition for
<b>width</b>. The evaluation of the following form will signal an error because the
keyword argument <b>:pixel-size</b> is not accepted by the applicable method.
<div class="lisp">
<tt>
<!--l. 1459--><p class="indent" >   <div class="tabbing">
(width (make-instance &#x2019;character-class :char #\Q)
   <br>                                                  :font &#x2019;baskerville :pixel-size 10)<br>
<!--l. 1462--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1464--><p class="indent" >   The evaluation of the following form will signal an error.
<div class="lisp">
<tt>
<!--l. 1466--><p class="indent" >   <div class="tabbing">
(width (make-instance &#x2019;picture-class :glyph (glyph #\Q))
   <br>                                                  :font &#x2019;baskerville :pixel-size 10)<br>
<!--l. 1469--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1471--><p class="indent" >   The evaluation of the following form will not signal an error if the class
named <b>character-picture-class</b> is a subclass of both <b>picture-class</b> and
<b>character-class</b>.
<div class="lisp">
<tt>
<!--l. 1475--><p class="indent" >   <div class="tabbing">
(width (make-instance &#x2019;character-picture-class :char #\Q)
   <br>                                                  :font &#x2019;baskerville :pixel-size 10)<br>
                                                                          

                                                                          
<!--l. 1478--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1481--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.7   </span> <a 
href="frontmatter.html#QQ2-175-316" id="x175-27400027.1.7">Method Selection and Combination</a></h4>
<!--l. 1484--><p class="noindent" >When a generic function is called with particular arguments, it must determine
the code to execute. This code is called the <em>eﬀective method</em> for those arguments.
The eﬀective method is a <em>combination</em> of the applicable methods in the
generic function. A combination of methods is a Lisp expression that
contains calls to some or all of the methods. If a generic function is called
and no methods apply, the generic function <b><a 
href="symbols.html#x188-380673r673">no-applicable-method</a></b> is
invoked.
<!--l. 1493--><p class="indent" >   When the eﬀective method has been determined, it is invoked with the same
arguments that were passed to the generic function. Whatever values it returns
are returned as the values of the generic function.
<!--l. 1497--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27500027.1.7" id="x175-27500027.1.7">Determining the Eﬀective Method</a></h5>
<!--l. 1500--><p class="noindent" >The eﬀective method for a set of arguments is determined by the following
three-step procedure:
<!--l. 1503--><p class="indent" >
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x175-275002x1">Select the applicable methods.
      </li>
      <li 
  class="enumerate" id="x175-275004x2">Sort the applicable methods by precedence order, putting the most
      speciﬁc method ﬁrst.
      </li>
      <li 
  class="enumerate" id="x175-275006x3">Apply method combination to the sorted list of applicable methods,
      producing the eﬀective method.
      </li></ol>
                                                                          

                                                                          
<b>
<!--l. 1515--><p class="indent" >   Selecting the Applicable Methods.</b> This step is described in
section <a 
href="#x175-27000027.1.6">27.1.6<!--tex4ht:ref: Introduction-to-Methods-SECTION --></a>.
<b>
<!--l. 1518--><p class="indent" >   Sorting the Applicable Methods by Precedence Order.</b> To compare the
precedence of two methods, their parameter specializers are examined in order.
The default examination order is from left to right, but an alternative
order may be speciﬁed by the <b>:argument-precedence-order</b> option to
<b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> or to any of the other forms that specify generic function
options.
<!--l. 1525--><p class="indent" >   The corresponding parameter specializers from each method are compared.
When a pair of parameter specializers are equal, the next pair are compared for
equality. If all corresponding parameter specializers are equal, the two methods
must have diﬀerent qualiﬁers; in this case, either method can be selected to
precede the other.
<!--l. 1532--><p class="indent" >   If some corresponding parameter specializers are not equal, the ﬁrst pair of
parameter specializers that are not equal determines the precedence. If both
parameter specializers are classes, the more speciﬁc of the two methods
is the method whose parameter specializer appears earlier in the class
precedence list of the corresponding argument. Because of the way in which
the set of applicable methods is chosen, the parameter specializers are
guaranteed to be present in the class precedence list of the class of the
argument.
<!--l. 1541--><p class="indent" >   If just one parameter specializer is <b>(<b><a 
href="symbols.html#x188-380379r379">eql</a></b> <em>object</em>)</b>, the method with that
parameter specializer precedes the other method. If both parameter specializers
are <b><a 
href="symbols.html#x188-380379r379">eql</a></b> forms, the specializers must be the same (otherwise the two methods
would not both have been applicable to this argument).
<!--l. 1548--><p class="indent" >   The resulting list of applicable methods has the most speciﬁc method ﬁrst and
the least speciﬁc method last.
<b>
<!--l. 1551--><p class="indent" >   Applying Method Combination to the Sorted List of Applicable
Methods.</b>
<!--l. 1553--><p class="indent" >   In the simple case—if standard method combination is used and all applicable
methods are primary methods—the eﬀective method is the most speciﬁc
method. That method can call the next most speciﬁc method by using the
function <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b>. The method that <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> will call
is referred to as the <em>next method</em>. The predicate <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b> tests
whether a next method exists. If <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is called and there is no
                                                                          

                                                                          
next most speciﬁc method, the generic function <b><a 
href="symbols.html#x188-380674r674">no-next-method</a></b> is
invoked.
<!--l. 1563--><p class="indent" >   In general, the eﬀective method is some combination of the applicable
methods. It is deﬁned by a Lisp form that contains calls to some or all of the
applicable methods, returns the value or values that will be returned as the value
or values of the generic function, and optionally makes some of the methods
accessible by means of <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b>. This Lisp form is the body of the
eﬀective method; it is augmented with an appropriate lambda-list to make it a
function.
<!--l. 1571--><p class="indent" >   The role of each method in the eﬀective method is determined by its method
qualiﬁers and the speciﬁcity of the method. A qualiﬁer serves to mark a method,
and the meaning of a qualiﬁer is determined by the way that these marks are used
by this step of the procedure. If an applicable method has an unrecognized
qualiﬁer, this step signals an error and does not include that method in the
eﬀective method.
<!--l. 1579--><p class="indent" >   When standard method combination is used together with qualiﬁed methods,
the eﬀective method is produced as described in section <a 
href="#x175-27600027.1.7">27.1.7<!--tex4ht:ref: Standard-Method-Combination-SECTION --></a>.
<!--l. 1583--><p class="indent" >   Another type of method combination can be speciﬁed by using the
<b>:method-combination</b> option of <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> or of any of the other forms that
specify generic function options. In this way this step of the procedure can be
customized.
<!--l. 1588--><p class="indent" >   New types of method combination can be deﬁned by using the
<b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b> macro.
<!--l. 1591--><p class="indent" >   The meta-object level also oﬀers a mechanism for deﬁning new types of
method combination. The generic function <b><a 
href="symbols.html#x188-380275r275">compute-eﬀective-method</a></b> receives
as arguments the generic function, the method combination object, and the sorted
list of applicable methods. It returns the Lisp form that deﬁnes the eﬀective
method. A method for <b><a 
href="symbols.html#x188-380275r275">compute-eﬀective-method</a></b> can be deﬁned directly by
using <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b> or indirectly by using <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b>. A
<em>method combination object</em> is an object that encapsulates the method combination
type and options speciﬁed by the <b>:method-combination</b> option to forms that
specify generic function options.
___________________________________________<div class="implementation">
<!--l. 1605--><p class="noindent" ><b>Implementation note:</b> In the simplest implementation, the generic function would
compute the eﬀective method each time it was called. In practice, this will be too
ineﬃcient for some implementations. Instead, these implementations might employ a
variety of optimizations of the three-step procedure. Some illustrative examples of such
optimizations are the following:
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">Use a hash table keyed by the class of the arguments to store the eﬀective
      method.
      </li>
      <li class="itemize">Compile the eﬀective method and save the resulting compiled function in a
      table.
      </li>
      <li class="itemize">Recognize the Lisp form as an instance of a pattern of control structure and
      substitute a closure that implements that structure.
      </li>
      <li class="itemize">Examine the parameter specializers of all methods for the generic function
      and enumerate all possible eﬀective methods. Combine the eﬀective methods,
      together with code to select from among them, into a single function and
      compile that function. Call that function whenever the generic function is
      called.</li></ul>
</div>
__________________________________________________________________________
<!--l. 1634--><p class="noindent" >
     <h5 class="subsubsectionHead"><a 
href="#x175-27600027.1.7" id="x175-27600027.1.7">Standard Method Combination</a></h5>
<!--l. 1637--><p class="noindent" >Standard method combination is supported by the class <b>standard-generic-function</b>.
It is used if no other type of method combination is speciﬁed or if the built-in
method combination type <b>standard</b> is speciﬁed.
<em>
<!--l. 1643--><p class="indent" >     Primary methods</em> deﬁne the main action of the eﬀective method, while
<em>auxiliary methods</em> modify that action in one of three ways. A primary method has
no method qualiﬁers.
<!--l. 1647--><p class="indent" >     An auxiliary method is a method whose method qualiﬁer is <b>:before</b>, <b>:after</b>, or
<b>:around</b>. Standard method combination allows no more than one qualiﬁer per
method; if a method deﬁnition speciﬁes more than one qualiﬁer per method, an
error is signaled.
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">A <b>:before</b> method has the keyword <b>:before</b> as its only qualiﬁer. A
      <b>:before</b> method speciﬁes code that is to be run before any primary
      method.
      </li>
      <li class="itemize">An <b>:after</b> method has the keyword <b>:after</b> as its only qualiﬁer. An
      <b>:after</b> method speciﬁes code that is to be run after primary methods.
      </li>
      <li class="itemize">An <b>:around</b> method has the keyword <b>:around</b> as its only qualiﬁer.
      An <b>:around</b> method speciﬁes code that is to be run instead of other
      applicable methods but that is able to cause some of them to be run.</li></ul>
<!--l. 1670--><p class="indent" >   The semantics of standard method combination are as follows:
      <ul class="itemize1">
      <li class="itemize">If there are any <b>:around</b> methods, the most speciﬁc <b>:around</b> method
      is called. It supplies the value or values of the generic function.
      </li>
      <li class="itemize">Inside the body of an <b>:around</b> method, <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> can be
      used to call the next method. When the next method returns, the
      <b>:around</b> method can execute more code, perhaps based on the returned
      value or values. The generic function <b><a 
href="symbols.html#x188-380674r674">no-next-method</a></b> is invoked if
      <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is used and there is no applicable method to call.
      The function <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b> may be used to determine whether a
      next method exists.
      </li>
      <li class="itemize">If  an  <b>:around</b> method  invokes  <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b>,  the  next  most
      speciﬁc <b>:around</b> method is called, if one is applicable. If there are no
      <b>:around</b> methods or if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is called by the least speciﬁc
      <b>:around</b> method, the other methods are called as follows:
           <ul class="itemize2">
           <li class="itemize">All   the   <b>:before</b>  methods   are   called,   in   most-speciﬁc-ﬁrst
           order.   Their   values   are   ignored.   An   error   is   signaled   if
           <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is used in a <b>:before</b> method.
                                                                          

                                                                          
           </li>
           <li class="itemize">The most speciﬁc primary method is called. Inside the body of
           a primary method, <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> may be used to call the
           next most speciﬁc primary method. When that method returns,
           the  previous  primary  method  can  execute  more  code,  perhaps
           based  on  the  returned  value  or  values.  The  generic  function
           <b><a 
href="symbols.html#x188-380674r674">no-next-method</a></b> is invoked if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is used and
           there  are  no  more  applicable  primary  methods.  The  function
           <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b>  may  be  used  to  determine  whether  a  next
           method exists. If <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is not used, only the most
           speciﬁc primary method is called.
           </li>
           <li class="itemize">All the <b>:after</b> methods are called in most-speciﬁc-last order. Their
           values are ignored. An error is signaled if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is
           used in an <b>:after</b> method.</li></ul>
      </li>
      <li class="itemize">If no <b>:around</b> methods were invoked, the most speciﬁc primary method
      supplies the value or values returned by the generic function. The value or
      values returned by the invocation of <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> in the least speciﬁc
      <b>:around</b> method are those returned by the most speciﬁc primary
      method.</li></ul>
<!--l. 1723--><p class="indent" >   In standard method combination, if there is an applicable method but no
applicable primary method, an error is signaled.
<!--l. 1726--><p class="indent" >   The <b>:before</b> methods are run in most-speciﬁc-ﬁrst order and the <b>:after</b>
methods are run in least-speciﬁc-ﬁrst order. The design rationale for this
diﬀerence can be illustrated with an example. Suppose class <span class="math">C<sub>1</sub></span> modiﬁes the
behavior of its superclass, <span class="math">C<sub>2</sub></span>, by adding <b>:before</b> and <b>:after</b> methods. Whether
the behavior of the class <span class="math">C<sub>2</sub></span> is deﬁned directly by methods on <span class="math">C<sub>2</sub></span> or is inherited
from its superclasses does not aﬀect the relative order of invocation of methods on
instances of the class <span class="math">C<sub>1</sub></span>. Class <span class="math">C<sub>1</sub></span>&#x2019;s <b>:before</b> method runs before all of
class <span class="math">C<sub>2</sub></span>&#x2019;s methods. Class <span class="math">C<sub>1</sub></span>&#x2019;s <b>:after</b> method runs after all of class <span class="math">C<sub>2</sub></span>&#x2019;s
methods.
<!--l. 1738--><p class="indent" >   By contrast, all <b>:around</b> methods run before any other methods run.
Thus a less speciﬁc <b>:around</b> method runs before a more speciﬁc primary
method.
<!--l. 1742--><p class="indent" >   If only primary methods are used and if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is not used, only
                                                                          

                                                                          
the most speciﬁc method is invoked; that is, more speciﬁc methods shadow more
general ones.
<!--l. 1746--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27700027.1.7" id="x175-27700027.1.7">Declarative Method Combination</a></h5>
<!--l. 1748--><p class="noindent" >The macro <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b> deﬁnes new forms of method
combination. It provides a mechanism for customizing the production of the eﬀective
method. The default procedure for producing an eﬀective method is described in
section <a 
href="#x175-27500027.1.7">27.1.7<!--tex4ht:ref: Determining-the-Effective-Method-SECTION --></a>. There are two forms of <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b>. The short
form is a simple facility; the long form is more powerful and more verbose. The
long form resembles <b><a 
href="symbols.html#x188-380320r320">defmacro</a></b> in that the body is an expression that computes a
Lisp form; it provides mechanisms for implementing arbitrary control structures
within method combination and for arbitrary processing of method qualiﬁers. The
syntax and use of both forms of <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b> are explained in
section <a 
href="clmse144.html#x176-30200027.2">27.2<!--tex4ht:ref: Functions-in-the-Programmer-Interface-SECTION --></a>.
<!--l. 1763--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-27800027.1.7" id="x175-27800027.1.7">Built-in Method Combination Types</a></h5>
<!--l. 1766--><p class="noindent" >The Common Lisp Object System provides a set of built-in method combination
types. To specify that a generic function is to use one of these method
combination types, the name of the method combination type is given as the
argument to the <b>:method-combination</b> option to <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b> or to the
<b>:method-combination</b> option to any of the other forms that specify generic
function options.
<!--l. 1773--><p class="indent" >   The names of the built-in method combination types are <b><a 
href="symbols.html#x188-380060r60">+</a></b>, <b><a 
href="symbols.html#x188-380098r98">and</a></b>, <b><a 
href="symbols.html#x188-380099r99">append</a></b>,
<b><a 
href="symbols.html#x188-380547r547">list</a></b>, <b><a 
href="symbols.html#x188-380624r624">max</a></b>, <b><a 
href="symbols.html#x188-380638r638">min</a></b>, <b><a 
href="symbols.html#x188-380666r666">nconc</a></b>, <b><a 
href="symbols.html#x188-380703r703">or</a></b>, <b><a 
href="symbols.html#x188-380762r762">progn</a></b>, and <b>standard</b>.
<!--l. 1777--><p class="indent" >   The semantics of the <b>standard</b> built-in method combination type were
described in section <a 
href="#x175-27600027.1.7">27.1.7<!--tex4ht:ref: Standard-Method-Combination-SECTION --></a>. The other built-in method combination types are
called <em>simple built-in method combination types.</em>
<!--l. 1782--><p class="indent" >   The simple built-in method combination types act as though they were deﬁned
by the short form of <b><a 
href="symbols.html#x188-380316r316">deﬁne-method-combination</a></b>. They recognize two roles for
methods:
      <ul class="itemize1">
      <li class="itemize">An  <b>:around</b> method  has  the  keyword  symbol  <b>:around</b> as  its  sole
                                                                          

                                                                          
      qualiﬁer. The meaning of <b>:around</b> methods is the same as in standard
      method  combination.  Use  of  the  functions  <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> and
      <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b> is supported in <b>:around</b> methods.
      </li>
      <li class="itemize">A  primary  method  has  the  name  of  the  method  combination  type
      as  its  sole  qualiﬁer.  For  example,  the  built-in  method  combination
      type  <b>and</b>  recognizes  methods  whose  sole  qualiﬁer  is  <b>and</b>;  these
      are  primary  methods.  Use  of  the  functions  <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> and
      <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b> is not supported in primary methods.
      </li></ul>
<!--l. 1803--><p class="indent" >   The semantics of the simple built-in method combination types are as
follows:
      <ul class="itemize1">
      <li class="itemize">If there are any <b>:around</b> methods, the most speciﬁc <b>:around</b> method
      is called. It supplies the value or values of the generic function.
      </li>
      <li class="itemize">Inside                 the                 body                 of                 an
      <b>:around</b> method, the function <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> can be used to call
      the next method. The generic function <b><a 
href="symbols.html#x188-380674r674">no-next-method</a></b> is invoked
      if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is used and there is no applicable method to
      call. The function <b><a 
href="symbols.html#x188-380669r669">next-method-p</a></b> may be used to determine whether
      a next method exists. When the next method returns, the <b>:around</b>
      method can execute more code, perhaps based on the returned value
      or values.
      </li>
      <li class="itemize">If an <b>:around</b> method invokes <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b>, the next most speciﬁc
      <b>:around</b> method is called, if one is applicable. If there are no <b>:around</b>
      methods or if <b><a 
href="symbols.html#x188-380190r190">call-next-method</a></b> is called by the least speciﬁc <b>:around</b>
      method, a Lisp form derived from the name of the built-in method
      combination type and from the list of applicable primary methods is
      evaluated to produce the value of the generic function. Suppose the name of
      the method combination type is <em>operator</em> and the call to the generic function
      is of the form <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
      (<em>generic-function</em> <span class="math">a<sub>1</sub></span> ... <span class="math">a<sub>n</sub></span>)
      <br>
      <!--l. 1831--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 1832--><p class="noindent" >Let <span class="math">M<sub>1</sub>,…,M<sub>k</sub></span> be the applicable primary methods in order; then the derived
      Lisp form is <div class="lisp"><tt><div class="tabbing">
      (<em>operator</em> <span class="math">⟨M<sub>1</sub> a<sub>1</sub>…a<sub>n</sub>⟩</span> ... <span class="math">⟨M<sub>k</sub> a<sub>1</sub>…a<sub>n</sub>⟩</span>)
      <br>
      <!--l. 1837--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 1838--><p class="noindent" >If the expression <span class="math">⟨M<sub>i</sub> a<sub>1</sub>…a<sub>n</sub>⟩</span> is evaluated, the method <span class="math">M<sub>i</sub></span> will be applied to
      the arguments <span class="math">a<sub>1</sub>…a<sub>n</sub></span>. For example, if <em>operator</em> is <b><a 
href="symbols.html#x188-380703r703">or</a></b>, the expression
      <span class="math">⟨M<sub>i</sub> a<sub>1</sub>…a<sub>n</sub>⟩</span> is evaluated only if <span class="math">⟨M<sub>j</sub> a<sub>1</sub>…a<sub>n</sub>⟩</span>, <span class="math">1 ≤ j &#x003C; i</span>, returned
      <b><a 
href="symbols.html#x188-380670r670">nil</a></b>.
      <!--l. 1848--><p class="noindent" >The default order for the primary methods is <b>:most-speciﬁc-ﬁrst</b>.
      However, the order can be reversed by supplying <b>:most-speciﬁc-last</b> as the
      second argument to the <b>:method-combination</b> option.</li></ul>
<!--l. 1854--><p class="indent" >   The simple built-in method combination types require exactly one qualiﬁer per
method. An error is signaled if there are applicable methods with no qualiﬁers or
with qualiﬁers that are not supported by the method combination type. An error
is signaled if there are applicable <b>:around</b> methods and no applicable primary
methods.
                                                                          

                                                                          
<!--l. 1860--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.8   </span> <a 
href="frontmatter.html#QQ2-175-321" id="x175-27900027.1.8">Meta-objects</a></h4>
<!--l. 1862--><p class="noindent" >The implementation of the Object System manipulates classes, methods, and
generic functions. The meta-object protocol speciﬁes a set of generic functions
deﬁned by methods on classes; the behavior of those generic functions deﬁnes the
behavior of the Object System. The instances of the classes on which those
methods are deﬁned are called <em>meta-objects</em>. Programming at the meta-object
protocol level involves deﬁning new classes of meta-objects along with methods
specialized on these classes.
<!--l. 1870--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28000027.1.8" id="x175-28000027.1.8">Metaclasses</a></h5>
<!--l. 1872--><p class="noindent" >The <em>metaclass</em> of an object is the class of its class. The metaclass determines the
representation of instances of its instances and the forms of inheritance used by its
instances for slot descriptions and method inheritance. The metaclass mechanism
can be used to provide particular forms of optimization or to tailor the Common
Lisp Object System for particular uses. The protocol for deﬁning metaclasses is
discussed in the third part of the CLOS speciﬁcation, The Common Lisp Object
System Meta-Object Protocol <a 
href="amop.html#x183-33800029">29<!--tex4ht:ref: METAOBJECT-PROTOCOL --></a>.
<!--l. 1881--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28100027.1.8" id="x175-28100027.1.8">Standard Metaclasses</a></h5>
<!--l. 1883--><p class="noindent" >The Common Lisp Object System provides a number of predeﬁned metaclasses.
These include the classes <b>standard-class</b>, <b>built-in-class</b>, and <b>structure-class</b>:
      <ul class="itemize1">
      <li class="itemize">The class <b>standard-class</b> is the default class of classes deﬁned by
      <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.
      </li>
      <li class="itemize">The  class  <b>built-in-class</b>  is  the  class  whose  instances  are  classes
      that  have  special  implementations  with  restricted  capabilities.  Any
      class  that  corresponds  to  a  standard  Common  Lisp  type  might  be
      an  instance  of  <b>built-in-class</b>.  The  predeﬁned  Common  Lisp  type
      speciﬁers  that  are  required  to  have  corresponding  classes  are  listed
                                                                          

                                                                          
      in table <a 
href="#x175-2640021">27.1<!--tex4ht:ref: CLOS-PRECEDENCE-TABLE --></a>. It is implementation-dependent whether each of these
      classes is implemented as a built-in class.
      </li>
      <li class="itemize">All   classes   deﬁned   by   means   of   <b><a 
href="symbols.html#x188-380325r325">defstruct</a></b>  are   instances   of
      <b>structure-class</b>.</li></ul>
<!--l. 1907--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28200027.1.8" id="x175-28200027.1.8">Standard Meta-objects</a></h5>
<!--l. 1909--><p class="noindent" >The Object System supplies a standard set of meta-objects, called <em>standard
meta-objects</em>. These include the class <b>standard-object</b> and instances
of the classes <b>standard-method</b>, <b>standard-generic-function</b>, and
<b>method-combination</b>.
      <ul class="itemize1">
      <li class="itemize">The class <b>standard-method</b> is the default class of methods that are
      deﬁned by the forms <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b>, <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b>, <b><a 
href="symbols.html#x188-380452r452">generic-function</a></b>.
      </li>
      <li class="itemize">The   class   <b>standard-generic-function</b>  is   the   default   class   of
      generic  functions  deﬁned  by  the  forms  <b><a 
href="symbols.html#x188-380321r321">defmethod</a></b>,  <b><a 
href="symbols.html#x188-380312r312">defgeneric</a></b>,
      <b><a 
href="symbols.html#x188-380452r452">generic-function</a></b>, and <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.
      </li>
      <li class="itemize">The  class  named  <b>standard-object</b>  is  an  instance  of  the  class
      <b>standard-class</b> and is a superclass of every class that is an instance
      of <b>standard-class</b> except itself.
      </li>
      <li class="itemize">Every method combination object is an instance of a subclass of the
      class <b>method-combination</b>.</li></ul>
                                                                          

                                                                          
<!--l. 1937--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.9   </span> <a 
href="frontmatter.html#QQ2-175-325" id="x175-28300027.1.9">Object Creation and Initialization</a></h4>
<!--l. 1940--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> creates and returns a new instance of a
class. The ﬁrst argument is a class or the name of a class, and the remaining
arguments form an <em>initialization argument</em> list.
<!--l. 1945--><p class="indent" >   The initialization of a new instance consists of several distinct steps, including
the following: combining the explicitly supplied initialization arguments with
default values for the unsupplied initialization arguments, checking the
validity of the initialization arguments, allocating storage for the instance,
ﬁlling slots with values, and executing user-supplied methods that perform
additional initialization. Each step of <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> is implemented by a
generic function to provide a mechanism for customizing that step. In
addition, <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> is itself a generic function and thus also can be
customized.
<!--l. 1956--><p class="indent" >   The Object System speciﬁes system-supplied primary methods for each step
and thus speciﬁes a well-deﬁned standard behavior for the entire initialization
process. The standard behavior provides four simple mechanisms for controlling
initialization:
      <ul class="itemize1">
      <li class="itemize">Declaring  a  symbol  to  be  an  initialization  argument  for  a  slot.  An
      initialization argument is declared by using the <b>:initarg</b> slot option to
      <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>. This provides a mechanism for supplying a value for a slot in
      a call to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>.
      </li>
      <li class="itemize">Supplying  a  default  value  form  for  an  initialization  argument.
      Default value forms for initialization arguments are deﬁned by using
      the  <b>:default-initargs</b> class  option  to  <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.  If  an  initialization
      argument is not explicitly provided as an argument to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>,
      the default value form is evaluated in the lexical environment of the
      <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form that deﬁned it, and the resulting value is used as the
      value of the initialization argument.
      </li>
      <li class="itemize">Supplying a default initial value form for a slot. A default initial value
      form for a slot is deﬁned by using the <b>:initform</b> slot option to <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.
      If no initialization argument associated with that slot is given as an
                                                                          

                                                                          
      argument to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> or is defaulted by <b>:default-initargs</b>, this
      default initial value form is evaluated in the lexical environment of the
      <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form that deﬁned it, and the resulting value is stored in the
      slot. The <b>:initform</b> form for a local slot may be used when creating an
      instance, when updating an instance to conform to a redeﬁned class, or
      when updating an instance to conform to the deﬁnition of a diﬀerent
      class. The <b>:initform</b> form for a shared slot may be used when deﬁning
      or re-deﬁning the class.
      </li>
      <li class="itemize">Deﬁning  methods  for  <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>  and  <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
      The  slot-ﬁlling  behavior  described  above  is  implemented  by  a
      system-supplied primary method for <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> which invokes
      <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>. The generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> implements
      the parts of initialization shared by these four situations: when making
      an instance, when re-initializing an instance, when updating an instance
      to conform to a redeﬁned class, and when updating an instance to
      conform  to  the  deﬁnition  of  a  diﬀerent  class.  The  system-supplied
      primary   method   for   <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>  directly   implements   the
      slot-ﬁlling behavior described above, and <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> simply
      invokes <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
      </li></ul>
<!--l. 2005--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28400027.1.9" id="x175-28400027.1.9">Initialization Arguments</a></h5>
<!--l. 2007--><p class="noindent" >An initialization argument controls object creation and initialization. It is often
convenient to use keyword symbols to name initialization arguments, but the
name of an initialization argument can be any symbol, including <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. An
initialization argument can be used in two ways: to ﬁll a slot with a value or to
provide an argument for an initialization method. A single initialization argument
can be used for both purposes.
<!--l. 2015--><p class="indent" >   An <em>initialization argument list</em> is a list of alternating initialization argument
names and values. Its structure is identical to a property list and also to the
portion of an argument list processed for <b>&#x0026;key</b> parameters. As in those lists, if an
initialization argument name appears more than once in an initialization
argument list, the leftmost occurrence supplies the value and the remaining
                                                                          

                                                                          
occurrences are ignored. The arguments to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> (after the ﬁrst
argument) form an initialization argument list. Error checking of initialization
argument names is disabled if the keyword argument pair whose keyword is
<b>:allow-other-keys</b> and whose value is non-<b><a 
href="symbols.html#x188-380670r670">nil</a></b> appears in the initialization
argument list.
<!--l. 2028--><p class="indent" >   An initialization argument can be associated with a slot. If the initialization
argument has a value in the initialization argument list, the value is stored into
the slot of the newly created object, overriding any <b>:initform</b> form associated
with the slot. A single initialization argument can initialize more than one slot.
An initialization argument that initializes a shared slot stores its value into the
shared slot, replacing any previous value.
<!--l. 2036--><p class="indent" >   An initialization argument can be associated with a method. When an object
is created and a particular initialization argument is supplied, the generic
functions <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>, <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>, and <b><a 
href="symbols.html#x188-380094r94">allocate-instance</a></b> are
called with that initialization argument&#x2019;s name and value as a keyword
argument pair. If a value for the initialization argument is not supplied in the
initialization argument list, the method&#x2019;s lambda-list supplies a default
value.
<!--l. 2045--><p class="indent" >   Initialization arguments are used in four situations: when making an instance,
when re-initializing an instance, when updating an instance to conform to a
redeﬁned class, and when updating an instance to conform to the deﬁnition of a
diﬀerent class.
<!--l. 2050--><p class="indent" >   Because initialization arguments are used to control the creation and
initialization of an instance of some particular class, we say that an initialization
argument is “an initialization argument for” that class.
<!--l. 2055--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28500027.1.9" id="x175-28500027.1.9">Declaring the Validity of Initialization Arguments</a></h5>
<!--l. 2058--><p class="noindent" >Initialization arguments are checked for validity in each of the four situations that
use them. An initialization argument may be valid in one situation and not
another. For example, the system-supplied primary method for <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>
deﬁned for the class <b>standard-class</b> checks the validity of its initialization
arguments and signals an error if an initialization argument is supplied that is not
declared valid in that situation.
<!--l. 2066--><p class="indent" >   There are two means of declaring initialization arguments valid.
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">Initialization arguments that ﬁll slots are declared valid by the <b>:initarg</b>
      slot  option  to  <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>.  The  <b>:initarg</b> slot  option  is  inherited  from
      superclasses.  Thus  the  set  of  valid  initialization  arguments  that  ﬁll
      slots for a class is the union of the initialization arguments that ﬁll
      slots declared valid by that class and its superclasses. Initialization
      arguments that ﬁll slots are valid in all four contexts.
      </li>
      <li class="itemize">Initialization  arguments  that  supply  arguments  to  methods  are
      declared valid by deﬁning those methods. The keyword name of each
      keyword  parameter  speciﬁed  in  the  method&#x2019;s  lambda-list  becomes
      an  initialization  argument  for  all  classes  for  which  the  method
      is  applicable.  Thus  method  inheritance  controls  the  set  of  valid
      initialization arguments that supply arguments to methods. The generic
      functions for which method deﬁnitions serve to declare initialization
      arguments valid are as follows:
           <ul class="itemize2">
           <li class="itemize">Making          an          instance          of          a          class:
           <b><a 
href="symbols.html#x188-380094r94">allocate-instance</a></b>, <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>, and <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
           Initialization arguments declared valid by these methods are valid
           when making an instance of a class.
           </li>
           <li class="itemize">Re-initializing an instance: the functions <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b>
           and <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>. Initialization arguments declared valid by
           these methods are valid when re-initializing an instance.
           </li>
           <li class="itemize">Updating   an   instance   to   conform   to   a   redeﬁned   class:
           <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>  and  <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
           Initialization arguments declared valid by these methods are valid
           when updating an instance to conform to a redeﬁned class.
           </li>
           <li class="itemize">Updating   an   instance   to   conform   to   the   deﬁnition   of
           a   diﬀerent   class:   <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>  and
           <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.  Initialization  arguments  declared  valid  by
                                                                          

                                                                          
           these methods are valid when updating an instance to conform to
           the deﬁnition of a diﬀerent class.</li></ul>
      </li></ul>
<!--l. 2113--><p class="indent" >   The set of valid initialization arguments for a class is the set of valid
initialization arguments that either ﬁll slots or supply arguments to methods,
along with the predeﬁned initialization argument <b>:allow-other-keys</b>. The default
value for <b>:allow-other-keys</b> is <b><a 
href="symbols.html#x188-380670r670">nil</a></b>. The meaning of <b>:allow-other-keys</b> is the
same here as when it is passed to an ordinary function.
<!--l. 2121--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28600027.1.9" id="x175-28600027.1.9">Defaulting of Initialization Arguments</a></h5>
<!--l. 2124--><p class="noindent" >A <em>default value form</em> can be supplied for an initialization argument by using the
<b>:default-initargs</b> class option. If an initialization argument is declared valid by
some particular class, its default value form might be speciﬁed by a diﬀerent class.
In this case <b>:default-initargs</b> is used to supply a default value for an inherited
initialization argument.
<!--l. 2131--><p class="indent" >   The <b>:default-initargs</b> option is used only to provide default values for
initialization arguments; it does not declare a symbol as a valid initialization
argument name. Furthermore, the <b>:default-initargs</b> option is used only
to provide default values for initialization arguments when making an
instance.
<!--l. 2137--><p class="indent" >   The argument to the <b>:default-initargs</b> class option is a list of alternating
initialization argument names and forms. Each form is the default value form for
the corresponding initialization argument. The default value form of an
initialization argument is used and evaluated only if that initialization argument
does not appear in the arguments to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> and is not defaulted by a
more speciﬁc class. The default value form is evaluated in the lexical environment
of the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form that supplied it; the result is used as the initialization
argument&#x2019;s value.
<!--l. 2148--><p class="indent" >   The initialization arguments supplied to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> are combined with
defaulted initialization arguments to produce a <em>defaulted initialization argument
list</em>. A defaulted initialization argument list is a list of alternating initialization
argument names and values in which unsupplied initialization arguments are
defaulted and in which the explicitly supplied initialization arguments appear
earlier in the list than the defaulted initialization arguments. Defaulted
initialization arguments are ordered according to the order in the class precedence
                                                                          

                                                                          
list of the classes that supplied the default values.
<!--l. 2158--><p class="indent" >   There is a distinction between the purposes of the <b>:default-initargs</b>
and the <b>:initform</b> options with respect to the initialization of slots. The
<b>:default-initargs</b> class option provides a mechanism for the user to give a default
value form for an initialization argument without knowing whether the
initialization argument initializes a slot or is passed to a method. If that
initialization argument is not explicitly supplied in a call to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, the
default value form is used, just as if it had been supplied in the call. In contrast,
the <b>:initform</b> slot option provides a mechanism for the user to give a default
initial value form for a slot. An <b>:initform</b> form is used to initialize a slot only if
no initialization argument associated with that slot is given as an argument to
<b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> or is defaulted by <b>:default-initargs</b>.
<!--l. 2173--><p class="indent" >   The order of evaluation of default value forms for initialization arguments and
the order of evaluation of <b>:initform</b> forms are undeﬁned. If the order of
evaluation matters, use <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> or <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> methods.
<!--l. 2178--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28700027.1.9" id="x175-28700027.1.9">Rules for Initialization Arguments</a></h5>
<!--l. 2181--><p class="noindent" >The <b>:initarg</b> slot option may be speciﬁed more than once for a given slot. The
following rules specify when initialization arguments may be multiply
deﬁned:
      <ul class="itemize1">
      <li class="itemize">A given initialization argument can be used to initialize more than one
      slot if the same initialization argument name appears in more than one
      <b>:initarg</b> slot option.
      </li>
      <li class="itemize">A given initialization argument name can appear in the lambda-list of
      more than one initialization method.
      </li>
      <li class="itemize">A given initialization argument name can appear both in an <b>:initarg</b>
      slot option and in the lambda-list of an initialization method.</li></ul>
<!--l. 2199--><p class="indent" >   If two or more initialization arguments that initialize the same slot are given in
the arguments to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, the leftmost of these initialization arguments
                                                                          

                                                                          
in the initialization argument list supplies the value, even if the initialization
arguments have diﬀerent names.
<!--l. 2205--><p class="indent" >   If two or more diﬀerent initialization arguments that initialize the same
slot have default values and none is given explicitly in the arguments to
<b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, the initialization argument that appears in a <b>:default-initargs</b>
class option in the most speciﬁc of the classes supplies the value. If a single
<b>:default-initargs</b> class option speciﬁes two or more initialization arguments that
initialize the same slot and none is given explicitly in the arguments to
<b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, the leftmost argument in the <b>:default-initargs</b> class option
supplies the value, and the values of the remaining default value forms are
ignored.
<!--l. 2216--><p class="indent" >   Initialization arguments given explicitly in the arguments to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>
appear to the left of defaulted initialization arguments. Suppose that the classes
<span class="math">C<sub>1</sub></span> and <span class="math">C<sub>2</sub></span> supply the values of defaulted initialization arguments for diﬀerent
slots, and suppose that <span class="math">C<sub>1</sub></span> is more speciﬁc than <span class="math">C<sub>2</sub></span>; then the defaulted
initialization argument whose value is supplied by <span class="math">C<sub>1</sub></span> is to the left of the defaulted
initialization argument whose value is supplied by <span class="math">C<sub>2</sub></span> in the defaulted
initialization argument list. If a single <b>:default-initargs</b> class option supplies the
values of initialization arguments for two diﬀerent slots, the initialization
argument whose value is speciﬁed farther to the left in the <b>default-initargs</b> class
option appears farther to the left in the defaulted initialization argument
list.
<!--l. 2230--><p class="indent" >   If a slot has both an <b>:initform</b> form and an <b>:initarg</b> slot option, and
the initialization argument is defaulted using <b>:default-initargs</b> or is
supplied to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, the captured <b>:initform</b> form is neither used nor
evaluated.
<!--l. 2235--><p class="indent" >   The following is an example of the preceding rules:
<div class="lisp">
<tt>
<!--l. 2237--><p class="indent" >   <div class="tabbing">
(defclass q () ((x :initarg a)))
   <br>                            <br>                            (defclass r (q) ((x :initarg b))<br>
  (:default-initargs a 1 b 2))<br>
<!--l. 2242--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<div class="flushleft" 
>
<!--l. 2244--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >                                          </td><td align="left" >Defaulted Initialization</td><td align="left" >Contents</td></tr><tr><td align="left" >Form  </td> <td align="left" >Argument List </td> <td align="left" >of Slot</td>
</tr><tr><td align="left" ><b>(make-instance &#x2019;r)</b>             </td><td align="left" ><b>(a 1 b 2)</b>               </td><td align="left" ><b>1</b>         </td>
</tr><tr><td align="left" ><b>(make-instance &#x2019;r &#x2019;a 3)</b>       </td><td align="left" ><b>(a 3 b 2)</b>               </td><td align="left" ><b>3</b>         </td>
</tr><tr><td align="left" ><b>(make-instance &#x2019;r &#x2019;b 4)</b>       </td><td align="left" ><b>(b 4 a 1)</b>               </td><td align="left" ><b>4</b>         </td>
</tr><tr><td align="left" ><b>(make-instance &#x2019;r &#x2019;a 1 &#x2019;a 2)</b> </td><td align="left" ><b>(a 1 a 2 b 2)</b>          </td><td align="left" ><b>1</b>         </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td></tr></table>
</div></div>
<!--l. 2257--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28800027.1.9" id="x175-28800027.1.9">Shared-Initialize</a></h5>
<!--l. 2260--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> is used to ﬁll the slots of an instance
using initialization arguments and <b>:initform</b> forms when an instance is created,
when an instance is re-initialized, when an instance is updated to conform to a
redeﬁned class, and when an instance is updated to conform to a diﬀerent class. It
uses standard method combination. It takes the following arguments:
the instance to be initialized, a speciﬁcation of a set of names of slots
accessible in that instance, and any number of initialization arguments.
The arguments after the ﬁrst two must form an initialization argument
list.
<!--l. 2271--><p class="indent" >   The second argument to <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> may be one of the following:
      <ul class="itemize1">
      <li class="itemize">It can be a list of slot names, which speciﬁes the set of those slot names.
      </li>
      <li class="itemize">It can be <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, which speciﬁes the empty set of slot names.
      </li>
      <li class="itemize">It can be the symbol <b><a 
href="symbols.html#x188-380953r953">t</a></b>, which speciﬁes the set of all of the slots.
      </li></ul>
<!--l. 2286--><p class="indent" >   There is a system-supplied primary method for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> whose ﬁrst
parameter specializer is the class <b>standard-object</b>. This method behaves as
follows on each slot, whether shared or local:
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">If an initialization argument in the initialization argument list speciﬁes
      a value for that slot, that value is stored into the slot, even if a value
      has  already  been  stored  in  the  slot  before  the  method  is  run.  The
      aﬀected slots are independent of which slots are indicated by the second
      argument to <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
      </li>
      <li class="itemize">Any slots indicated by the second argument that are still unbound at
      this point are initialized according to their <b>:initform</b> forms. For any
      such slot that has an <b>:initform</b> form, that form is evaluated in the
      lexical environment of its deﬁning <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form and the result is stored
      into the slot. For example, if a <b>:before</b> method stores a value in the
      slot, the <b>:initform</b> form will not be used to supply a value for the slot.
      If the second argument speciﬁes a name that does not correspond to
      any slots accessible in the instance, the results are unspeciﬁed.
      </li>
      <li class="itemize">The rules mentioned in section <a 
href="#x175-28700027.1.9">27.1.9<!--tex4ht:ref: Rules-for-Initialization-Arguments-SECTION --></a> are obeyed.
      </li></ul>
<!--l. 2312--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> is called by the system-supplied primary
methods for the generic functions <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>, <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b>,
<b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>, and <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>.
Thus methods can be written for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> to specify actions that should
be taken in all of these contexts.
<!--l. 2322--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-28900027.1.9" id="x175-28900027.1.9">Initialize-Instance</a></h5>
<!--l. 2324--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> is called by <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> to initialize
a newly created instance. It uses standard method combination. Methods for
<b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> can be deﬁned in order to perform any initialization that
cannot be achieved with the simple slot-ﬁlling mechanisms.
<!--l. 2331--><p class="indent" >   During initialization, <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> is invoked after the following actions
have been taken:
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">The  defaulted  initialization  argument  list  has  been  computed  by
      combining the supplied initialization argument list with any default
      initialization arguments for the class.
      </li>
      <li class="itemize">The  validity  of  the  defaulted  initialization  argument  list  has  been
      checked. If any of the initialization arguments has not been declared
      valid, an error is signaled.
      </li>
      <li class="itemize">A new instance whose slots are unbound has been created.
      </li></ul>
<!--l. 2348--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> is called with the new instance and
the defaulted initialization arguments. There is a system-supplied primary
method for <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> whose parameter specializer is the class
<b>standard-object</b>. This method calls the generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> to
ﬁll in the slots according to the initialization arguments and the <b>:initform</b>
forms for the slots; the generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> is called with
the following arguments: the instance, <b><a 
href="symbols.html#x188-380953r953">t</a></b>, and the defaulted initialization
arguments.
<!--l. 2358--><p class="indent" >   Note that <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> provides the defaulted initialization argument
list in its call to <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>, so the ﬁrst step performed by the
system-supplied primary method for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> takes into account both
the initialization arguments provided in the call to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> and the
defaulted initialization argument list.
<!--l. 2365--><p class="indent" >   Methods for <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> can be deﬁned to specify actions to be taken
when an instance is initialized. If only <b>:after</b> methods for <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> are
deﬁned, they will be run after the system-supplied primary method for
initialization and therefore they will not interfere with the default behavior of
<b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>.
<!--l. 2372--><p class="indent" >   The Object System provides two functions that are useful in the bodies of
<b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> methods. The function <b><a 
href="symbols.html#x188-380872r872">slot-boundp</a></b> returns a boolean value
that indicates whether a speciﬁed slot has a value; this provides a mechanism for
writing <b>:after</b> methods for <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> that initialize slots only if they
have not already been initialized. The function <b><a 
href="symbols.html#x188-380884r884">slot-makunbound</a></b> causes the slot
to have no value.
                                                                          

                                                                          
<!--l. 2380--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29000027.1.9" id="x175-29000027.1.9">Deﬁnitions of Make-Instance and Initialize-Instance</a></h5>
<!--l. 2382--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> behaves as if it were deﬁned as follows,
except that certain optimizations are permitted:
<div class="lisp">
<tt>
<!--l. 2385--><p class="indent" >   <div class="tabbing">
(defmethod make-instance ((class standard-class) &#x0026;rest initargs)
   <br>                                  (setq initargs (default-initargs class initargs))<br>
  ...<br>             (let ((instance (apply #&#x2019;allocate-instance class initargs)))<br>
    (apply #&#x2019;initialize-instance instance initargs)<br>               instance))<br>
<br>            (defmethod make-instance ((class-name symbol) &#x0026;rest initargs)<br>
  (apply #&#x2019;make-instance (ﬁnd-class class-name) initargs))<br>
<!--l. 2395--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2420--><p class="indent" >   The elided code in the deﬁnition of <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> checks the supplied
initialization arguments to determine whether an initialization argument was
supplied that neither ﬁlled a slot nor supplied an argument to an applicable
method. This check could be implemented using the generic functions
<b><a 
href="symbols.html#x188-380247r247">class-prototype</a></b>, <b><a 
href="symbols.html#x188-380270r270">compute-applicable-methods</a></b>, <b><a 
href="symbols.html#x188-380448r448">function-keywords</a></b>,
and <b>class-slot-initargs</b>. See the third part of the Common Lisp Object
System speciﬁcation for a description of this initialization argument check.
<!--l. 2429--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> behaves as if it were deﬁned as
follows, except that certain optimizations are permitted:
<div class="lisp">
<tt>
<!--l. 2432--><p class="indent" >   <div class="tabbing">
(defmethod initialize-instance
   <br>                                 ((instance standard-object) &#x0026;rest initargs)<br>
  (apply #&#x2019;shared-initialize instance t initargs)))<br>
                                                                          

                                                                          
<!--l. 2436--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2438--><p class="indent" >   These procedures can be customized at either the Programmer Interface level,
the meta-object level, or both.
<!--l. 2441--><p class="indent" >   Customizing at the Programmer Interface level includes using the <b>:initform</b>,
<b>:initarg</b>, and <b>:default-initargs</b> options to <b><a 
href="symbols.html#x188-380310r310">defclass</a></b>, as well as deﬁning methods
for <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> and <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>. It is also possible to deﬁne
methods for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>, which would be invoked by the generic
functions <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b>, <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>,
<b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>, and <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>. The
meta-object level supports additional customization by allowing methods to be
deﬁned on <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b>, <b>default-initargs</b>, and <b><a 
href="symbols.html#x188-380094r94">allocate-instance</a></b>. Parts 2
and 3 of the Common Lisp Object System speciﬁcation document each of these
generic functions and the system-supplied primary methods. [The third part has
not yet been approved by X3J13 for inclusion in the forthcoming Common Lisp
standard and is not included in this book.—GLS]
<!--l. 2458--><p class="indent" >   Implementations are permitted to make certain optimizations to
<b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b> and <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>. The description of <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>
in section <a 
href="clmse144.html#x176-30200027.2">27.2<!--tex4ht:ref: Functions-in-the-Programmer-Interface-SECTION --></a> mentions the possible optimizations.
<!--l. 2465--><p class="indent" >   Because of optimization, the check for valid initialization arguments
might not be implemented using the generic functions <b><a 
href="symbols.html#x188-380247r247">class-prototype</a></b>,
<b>compute-applicable-methods</b>, <b><a 
href="symbols.html#x188-380448r448">function-keywords</a></b>, and <b>class-slot-initargs</b>.
In addition, methods for the generic function <b>default-initargs</b> and the
system-supplied primary methods for <b><a 
href="symbols.html#x188-380094r94">allocate-instance</a></b>, <b><a 
href="symbols.html#x188-380495r495">initialize-instance</a></b>,
and <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> might not be called on every call to <b><a 
href="symbols.html#x188-380595r595">make-instance</a></b> or
might not receive exactly the arguments that would be expected.
<!--l. 2476--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.10   </span> <a 
href="frontmatter.html#QQ2-175-333" id="x175-29100027.1.10">Redeﬁning Classes</a></h4>
<!--l. 2479--><p class="noindent" >A class that is an instance of <b>standard-class</b> can be redeﬁned if the new class
will also be an instance of <b>standard-class</b>. Redeﬁning a class modiﬁes the
existing class object to reﬂect the new class deﬁnition; it does not create a new
class object for the class. Any method object created by a <b>:reader</b>, <b>:writer</b>, or
<b>:accessor</b> option speciﬁed by the old <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form is removed from the
corresponding generic function. Methods speciﬁed by the new <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form are
                                                                          

                                                                          
added.
<!--l. 2492--><p class="indent" >   When the class <em>C</em> is redeﬁned, changes are propagated to its instances and to
instances of any of its subclasses. Updating such an instance occurs at an
implementation-dependent time, but no later than the next time a slot of that
instance is read or written. Updating an instance does not change its identity as
deﬁned by the <b><a 
href="symbols.html#x188-380378r378">eq</a></b> function. The updating process may change the slots of that
particular instance, but it does not create a new instance. Whether updating an
instance consumes storage is implementation-dependent.
<!--l. 2501--><p class="indent" >   Note that redeﬁning a class may cause slots to be added or deleted. If a class is
redeﬁned in a way that changes the set of local slots accessible in instances, the
instances will be updated. It is implementation-dependent whether instances are
updated if a class is redeﬁned in a way that does not change the set of local slots
accessible in instances.
<!--l. 2508--><p class="indent" >   The value of a slot that is speciﬁed as shared both in the old class and in the
new class is retained. If such a shared slot was unbound in the old class, it will be
unbound in the new class. Slots that were local in the old class and that
are shared in the new class are initialized. Newly added shared slots are
initialized.
<!--l. 2514--><p class="indent" >   Each newly added shared slot is set to the result of evaluating the captured
<b>:initform</b> form for the slot that was speciﬁed in the <b><a 
href="symbols.html#x188-380310r310">defclass</a></b> form for the new
class. If there is no <b>:initform</b> form, the slot is unbound.
<!--l. 2519--><p class="indent" >   If a class is redeﬁned in such a way that the set of local slots accessible in an
instance of the class is changed, a two-step process of updating the instances of
the class takes place. The process may be explicitly started by invoking the
generic function <b><a 
href="symbols.html#x188-380596r596">make-instances-obsolete</a></b>. This two-step process can happen
in other circumstances in some implementations. For example, in some
implementations this two-step process will be triggered if the order of slots in
storage is changed.
<!--l. 2528--><p class="indent" >   The ﬁrst step modiﬁes the structure of the instance by adding new local slots
and discarding local slots that are not deﬁned in the new version of the class. The
second step initializes the newly added local slots and performs any other
user-deﬁned actions. These steps are further speciﬁed in the next two
sections.
<!--l. 2535--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29200027.1.10" id="x175-29200027.1.10">Modifying the Structure of Instances</a></h5>
                                                                          

                                                                          
<!--l. 2537--><p class="noindent" >The ﬁrst step modiﬁes the structure of instances of the redeﬁned class
to conform to its new class deﬁnition. Local slots speciﬁed by the new
class deﬁnition that are not speciﬁed as either local or shared by the
old class are added, and slots not speciﬁed as either local or shared by
the new class deﬁnition that are speciﬁed as local by the old class are
discarded. The names of these added and discarded slots are passed as
arguments to <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> as described in the next
section.
<!--l. 2546--><p class="indent" >   The values of local slots speciﬁed by both the new and old classes are retained.
If such a local slot was unbound, it remains unbound.
<!--l. 2549--><p class="indent" >   The value of a slot that is speciﬁed as shared in the old class and as local in
the new class is retained. If such a shared slot was unbound, the local slot will be
unbound.
<!--l. 2553--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29300027.1.10" id="x175-29300027.1.10">Initializing Newly Added Local Slots</a></h5>
<!--l. 2555--><p class="noindent" >The second step initializes the newly added local slots and performs any other
user-deﬁned actions. This step is implemented by the generic function
<b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>, which is called after completion of the
ﬁrst step of modifying the structure of the instance.
<!--l. 2561--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> takes four
required arguments: the instance being updated after it has undergone the ﬁrst
step, a list of the names of local slots that were added, a list of the names of local
slots that were discarded, and a property list containing the slot names and values
of slots that were discarded and had values. Included among the discarded slots
are slots that were local in the old class and that are shared in the new
class.
<!--l. 2570--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> also takes any
number of initialization arguments. When it is called by the system to update an
instance whose class has been redeﬁned, no initialization arguments are
provided.
<!--l. 2575--><p class="indent" >   There is a system-supplied primary method for the generic function
<b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> whose parameter specializer for its
instance argument is the class <b>standard-object</b>. First this method checks the
validity of initialization arguments and signals an error if an initialization
argument is supplied that is not declared valid (see section <a 
href="#x175-28500027.1.9">27.1.9<!--tex4ht:ref: Declaring-the-Validity-of-Initialization-Arguments-SECTION --></a>.) Then it calls
                                                                          

                                                                          
the generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> with the following arguments: the
instance, the list of names of the newly added slots, and the initialization
arguments it received.
<!--l. 2587--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29400027.1.10" id="x175-29400027.1.10">Customizing Class Redeﬁnition</a></h5>
<!--l. 2589--><p class="noindent" >Methods for <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> may be deﬁned to specify
actions to be taken when an instance is updated. If only <b>:after</b> methods for
<b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> are deﬁned, they will be run after the
system-supplied primary method for initialization and therefore will not interfere
with the default behavior of <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>. Because no
initialization arguments are passed to <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b>
when it is called by the system, the <b>:initform</b> forms for slots that are ﬁlled by
<b>:before</b> methods for <b><a 
href="symbols.html#x188-380993r993">update-instance-for-redeﬁned-class</a></b> will not be
evaluated by <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
<!--l. 2601--><p class="indent" >   Methods for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> may be deﬁned to customize class redeﬁnition
(see section <a 
href="#x175-28800027.1.9">27.1.9<!--tex4ht:ref: Shared-Initialize-SECTION --></a>).
<!--l. 2604--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29500027.1.10" id="x175-29500027.1.10">Extensions</a></h5>
<!--l. 2606--><p class="noindent" >There are two allowed extensions to class redeﬁnition:
      <ul class="itemize1">
      <li class="itemize">The Object System may be extended to permit the new class to be an
      instance of a metaclass other than the metaclass of the old class.
      </li>
      <li class="itemize">The Object System may be extended to support an updating process
      when either the old or the new class is an instance of a class other than
      <b>standard-class</b> that is not a built-in class.</li></ul>
<!--l. 2619--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.11   </span> <a 
href="frontmatter.html#QQ2-175-338" id="x175-29600027.1.11">Changing the Class of an Instance</a></h4>
                                                                          

                                                                          
<!--l. 2622--><p class="noindent" >The function <b><a 
href="symbols.html#x188-380214r214">change-class</a></b> can be used to change the class of an instance from its
current class, <span class="math">C<sub>from</sub></span>, to a diﬀerent class, <span class="math">C<sub>to</sub></span>; it changes the structure of the
instance to conform to the deﬁnition of the class <span class="math">C<sub>to</sub></span>.
<!--l. 2628--><p class="indent" >   Note that changing the class of an instance may cause slots to be added or
deleted.
<!--l. 2631--><p class="indent" >   When <b><a 
href="symbols.html#x188-380214r214">change-class</a></b> is invoked on an instance, a two-step updating process
takes place. The ﬁrst step modiﬁes the structure of the instance by adding new
local slots and discarding local slots that are not speciﬁed in the new version of
the instance. The second step initializes the newly added local slots and performs
any other user-deﬁned actions. These steps are further described in the following
two sections.
<!--l. 2639--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29700027.1.11" id="x175-29700027.1.11">Modifying the Structure of an Instance</a></h5>
<!--l. 2641--><p class="noindent" >In order to make an instance conform to the class <span class="math">C<sub>to</sub></span>, local slots speciﬁed by the
class <span class="math">C<sub>to</sub></span> that are not speciﬁed by the class <span class="math">C<sub>from</sub></span> are added, and local slots
not speciﬁed by the class <span class="math">C<sub>to</sub></span> that are speciﬁed by the class <span class="math">C<sub>from</sub></span> are
discarded.
<!--l. 2647--><p class="indent" >   The values of local slots speciﬁed by both the class <span class="math">C<sub>to</sub></span> and the class <span class="math">C<sub>from</sub></span> are
retained. If such a local slot was unbound, it remains unbound.
<!--l. 2651--><p class="indent" >   The values of slots speciﬁed as shared in the class <span class="math">C<sub>from</sub></span> and as local in the
class <span class="math">C<sub>to</sub></span> are retained.
<!--l. 2654--><p class="indent" >   This ﬁrst step of the update does not aﬀect the values of any shared
slots.
<!--l. 2657--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29800027.1.11" id="x175-29800027.1.11">Initializing Newly Added Local Slots</a></h5>
<!--l. 2659--><p class="noindent" >The second step of the update initializes the newly added slots and performs
any other user-deﬁned actions. This step is implemented by the generic
function <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>. The generic function
<b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> is invoked by <b><a 
href="symbols.html#x188-380214r214">change-class</a></b> after the ﬁrst
step of the update has been completed.
<!--l. 2666--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> is invoked on two
arguments computed by <b><a 
href="symbols.html#x188-380214r214">change-class</a></b>. The ﬁrst argument passed is a copy of the
instance being updated and is an instance of the class <span class="math">C<sub>from</sub></span>; this copy has
                                                                          

                                                                          
dynamic extent within the generic function <b><a 
href="symbols.html#x188-380214r214">change-class</a></b>. The second argument
is the instance as updated so far by <b><a 
href="symbols.html#x188-380214r214">change-class</a></b> and is an instance of the class
<span class="math">C<sub>to</sub></span>.
<!--l. 2674--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> also takes any
number of initialization arguments. When it is called by <b><a 
href="symbols.html#x188-380214r214">change-class</a></b>, no
initialization arguments are provided.
<!--l. 2678--><p class="indent" >   There is a system-supplied primary method for the generic function
<b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> that has two parameter specializers, each
of which is the class <b>standard-object</b>. First this method checks the validity of
initialization arguments and signals an error if an initialization argument is
supplied that is not declared valid (see section <a 
href="#x175-28500027.1.9">27.1.9<!--tex4ht:ref: Declaring-the-Validity-of-Initialization-Arguments-SECTION --></a>). Then it calls the generic
function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> with the following arguments: the instance, a list
of names of the newly added slots, and the initialization arguments it
received.
<!--l. 2689--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-29900027.1.11" id="x175-29900027.1.11">Customizing the Change of Class of an Instance</a></h5>
<!--l. 2691--><p class="noindent" >Methods for <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> may be deﬁned to specify
actions to be taken when an instance is updated. If only <b>:after</b> methods for
<b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> are deﬁned, they will be run after the
system-supplied primary method for initialization and will not interfere with the
default behavior of <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>. Because no
initialization arguments are passed to <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b>
when it is called by <b><a 
href="symbols.html#x188-380214r214">change-class</a></b>, the <b>:initform</b> forms for slots that are ﬁlled by
<b>:before</b> methods for <b><a 
href="symbols.html#x188-380992r992">update-instance-for-diﬀerent-class</a></b> will not be evaluated
by <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>.
<!--l. 2703--><p class="indent" >   Methods for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> may be deﬁned to customize class redeﬁnition
(see section <a 
href="#x175-28800027.1.9">27.1.9<!--tex4ht:ref: Shared-Initialize-SECTION --></a>).
<!--l. 2706--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">27.1.12   </span> <a 
href="frontmatter.html#QQ2-175-342" id="x175-30000027.1.12">Reinitializing an Instance</a></h4>
<!--l. 2709--><p class="noindent" >The generic function <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b> may be used to change the values of
slots according to initialization arguments.
<!--l. 2712--><p class="indent" >   The process of reinitialization changes the values of some slots and performs
any user-deﬁned actions.
                                                                          

                                                                          
<!--l. 2715--><p class="indent" >   Reinitialization does not modify the structure of an instance to add or delete
slots, and it does not use any <b>:initform</b> forms to initialize slots.
<!--l. 2719--><p class="indent" >   The generic function <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b> may be called directly. It
takes one required argument, the instance. It also takes any number of
initialization arguments to be used by methods for <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b> or for
<b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b>. The arguments after the required instance must form an
initialization argument list.
<!--l. 2726--><p class="indent" >   There is a system-supplied primary method for <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b>
whose parameter specializer is the class <b>standard-object</b>. First this
method checks the validity of initialization arguments and signals an error
if an initialization argument is supplied that is not declared valid (see
section <a 
href="#x175-28500027.1.9">27.1.9<!--tex4ht:ref: Declaring-the-Validity-of-Initialization-Arguments-SECTION --></a>). Then it calls the generic function <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> with the
following arguments: the instance, <b><a 
href="symbols.html#x188-380670r670">nil</a></b>, and the initialization arguments it
received.
<!--l. 2736--><p class="noindent" >
   <h5 class="subsubsectionHead"><a 
href="#x175-30100027.1.12" id="x175-30100027.1.12">Customizing Reinitialization</a></h5>
<!--l. 2738--><p class="noindent" >Methods for the generic function <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b> may be deﬁned to specify
actions to be taken when an instance is updated. If only <b>:after</b> methods for
<b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b> are deﬁned, they will be run after the system-supplied
primary method for initialization and therefore will not interfere with the default
behavior of <b><a 
href="symbols.html#x188-380795r795">reinitialize-instance</a></b>.
<!--l. 2745--><p class="indent" >   Methods for <b><a 
href="symbols.html#x188-380850r850">shared-initialize</a></b> may be deﬁned to customize class redeﬁnition
(see section <a 
href="#x175-28800027.1.9">27.1.9<!--tex4ht:ref: Shared-Initialize-SECTION --></a>).
                                                                          

                                                                          
<!--l. 2748--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse144.html" >Next</a>&#x003E;&#x003C;<a 
href="clos.html" >Prev</a>&#x003E;&#x003C;<a 
href="clos.html#tailclos.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="clmse143.html" >Front</a>&#x003E;&#x003C;<a 
href="clos.html#clmse143.html" >Up</a>&#x003E;<br>&lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; </div><a 
 id="tailclmse143.html"></a>    
</body></html> 
